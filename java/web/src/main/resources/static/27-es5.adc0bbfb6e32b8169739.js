(function(){function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&_setPrototypeOf(e,t)}function _setPrototypeOf(e,t){return(_setPrototypeOf=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function _createSuper(e){var t=_isNativeReflectConstruct();return function(){var a,i=_getPrototypeOf(e);if(t){var n=_getPrototypeOf(this).constructor;a=Reflect.construct(i,arguments,n)}else a=i.apply(this,arguments);return _possibleConstructorReturn(this,a)}}function _possibleConstructorReturn(e,t){return!t||"object"!=typeof t&&"function"!=typeof t?_assertThisInitialized(e):t}function _assertThisInitialized(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}function _getPrototypeOf(e){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function _toConsumableArray(e){return _arrayWithoutHoles(e)||_iterableToArray(e)||_unsupportedIterableToArray(e)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);return"Object"===a&&e.constructor&&(a=e.constructor.name),"Map"===a||"Set"===a?Array.from(e):"Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a)?_arrayLikeToArray(e,t):void 0}}function _iterableToArray(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}function _arrayWithoutHoles(e){if(Array.isArray(e))return _arrayLikeToArray(e)}function _arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,i=new Array(t);a<t;a++)i[a]=e[a];return i}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var a=0;a<t.length;a++){var i=t[a];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function _createClass(e,t,a){return t&&_defineProperties(e.prototype,t),a&&_defineProperties(e,a),e}(window.webpackJsonp=window.webpackJsonp||[]).push([[27],{bwiJ:function bwiJ(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"a",(function(){return AddsampleComponent}));var _angular_core__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("fXoL"),src_services_sample_service__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("GTjD"),src_main_qualification_qualification_service__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("M3sX"),src_share_utilclass__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("BzWU"),_businessproject_businessproject_service__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("x2e1"),src_main_qualification_qualification_component__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__("OROO"),_ng_nest_ui__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__("qMpK"),_ng_nest_ui__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__("l5Yv"),_ng_nest_ui__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__("SfH5"),_ng_nest_ui__WEBPACK_IMPORTED_MODULE_9__=__webpack_require__("GvSL"),_ng_nest_ui__WEBPACK_IMPORTED_MODULE_10__=__webpack_require__("P0lq"),_ng_nest_ui__WEBPACK_IMPORTED_MODULE_11__=__webpack_require__("oJeN"),_ng_nest_ui_inner__WEBPACK_IMPORTED_MODULE_12__=__webpack_require__("1uEr"),_angular_forms__WEBPACK_IMPORTED_MODULE_13__=__webpack_require__("3Pt+"),_ng_nest_ui_table__WEBPACK_IMPORTED_MODULE_14__=__webpack_require__("yO6f"),_ng_nest_ui_link__WEBPACK_IMPORTED_MODULE_15__=__webpack_require__("kXfN"),_c0=["inputsamplename"],_c1=["inputsamplequality"],_c2=["inputsampleprice"],_c3=["inputexternice"],_c4=["selqual"],_c5=["externselqual"];function AddsampleComponent_ng_template_63_Template(e,t){if(1&e){var a=_angular_core__WEBPACK_IMPORTED_MODULE_0__.Pb();_angular_core__WEBPACK_IMPORTED_MODULE_0__.Ob(0,"div",35),_angular_core__WEBPACK_IMPORTED_MODULE_0__.Ob(1,"x-link",36),_angular_core__WEBPACK_IMPORTED_MODULE_0__.Vb("click",(function(){_angular_core__WEBPACK_IMPORTED_MODULE_0__.lc(a);var e=t.$row,i=_angular_core__WEBPACK_IMPORTED_MODULE_0__.Yb();return!i.disabled&&!i.methodInvalid&&i.projectaction("delete",e)})),_angular_core__WEBPACK_IMPORTED_MODULE_0__.Nb(),_angular_core__WEBPACK_IMPORTED_MODULE_0__.Nb()}if(2&e){var i=_angular_core__WEBPACK_IMPORTED_MODULE_0__.Yb();_angular_core__WEBPACK_IMPORTED_MODULE_0__.yb(1),_angular_core__WEBPACK_IMPORTED_MODULE_0__.ec("disabled",i.formInvalid||i.disabled)}}function AddsampleComponent_ng_template_65_Template(e,t){if(1&e){var a=_angular_core__WEBPACK_IMPORTED_MODULE_0__.Pb();_angular_core__WEBPACK_IMPORTED_MODULE_0__.Ob(0,"div",35),_angular_core__WEBPACK_IMPORTED_MODULE_0__.Ob(1,"x-link",36),_angular_core__WEBPACK_IMPORTED_MODULE_0__.Vb("click",(function(){_angular_core__WEBPACK_IMPORTED_MODULE_0__.lc(a);var e=t.$row,i=_angular_core__WEBPACK_IMPORTED_MODULE_0__.Yb();return!i.disabled&&!i.methodInvalid&&i.externprojectaction("delete",e)})),_angular_core__WEBPACK_IMPORTED_MODULE_0__.Nb(),_angular_core__WEBPACK_IMPORTED_MODULE_0__.Nb()}if(2&e){var i=_angular_core__WEBPACK_IMPORTED_MODULE_0__.Yb();_angular_core__WEBPACK_IMPORTED_MODULE_0__.yb(1),_angular_core__WEBPACK_IMPORTED_MODULE_0__.ec("disabled",i.formInvalid||i.disabled)}}var _c6=function(e){return{actions:e}},AddsampleComponent=function(){var AddsampleComponent=function(){function AddsampleComponent(e,t,a,i){_classCallCheck(this,AddsampleComponent),this.service=e,this.commonservice=t,this.message=a,this.domainservice=i,this.currentcontact={},this.sendaddsample=new _angular_core__WEBPACK_IMPORTED_MODULE_0__.n,this.qualitreeheight="300px",this.producthidden="inline",this.invalidstring="",this.projectdata=[],this.projecttotal=0,this.projectsize=20,this.projectindex=1,this.projectquery={filter:[]},this.projectcolumns=[{id:"actions",label:"\u64cd\u4f5c",width:80},{id:"testproject",label:"\u9879\u76ee",width:200,sort:!0},{id:"standardname",label:"\u68c0\u6d4b\u6807\u51c6",width:200,sort:!0},{id:"price",label:"\u6807\u51c6\u4ef7\u683c",width:200,sort:!0},{id:"realprice",label:"\u5b9e\u9645\u4ef7\u683c",width:200,sort:!0}],this.externprojectcolumns=[{id:"actions",label:"\u64cd\u4f5c",width:80},{id:"testproject",label:"\u68c0\u6d4b\u9879\u76ee",width:200,sort:!0}],this.process=[],this.processid=1,this.externprojectdata=[],this.qexternvisible=!1,this.externtotal=0,this.externprojecttotal=0,this.externprojectsize=20,this.externprojectindex=1,this.externprojectquery={filter:[]},this.qvisible=!1,this.samplemethod=[],this.showTableBoolean=!1,this.showdivBoolean=!1}return _createClass(AddsampleComponent,[{key:"quaconfirm",value:function quaconfirm(){for(var _this=this,_a,tempdata=[],i=0;i<this.qualificationcomponent.selquali.length;i++)tempdata.push({id:src_share_utilclass__WEBPACK_IMPORTED_MODULE_3__.a.JsNewGuid(),sampleid:(null===(_a=this.currentsample)||void 0===_a?void 0:_a.id)+"",qualificationid:this.qualificationcomponent.selquali[i].id+"",testproject:this.qualificationcomponent.selquali[i].testproject,methodname:this.qualificationcomponent.selquali[i].methodname,price:this.qualificationcomponent.selquali[i].price,realprice:this.qualificationcomponent.selquali[i].price,testcount:this.qualificationcomponent.selquali[i].testcount,isextern:0});this.service.getsamplestandardprice(tempdata).subscribe((function(x){_this.projectdata=[],_this.currentsample.standardfee=x.price,x.formulars.map((function(y){var formularprice=eval(y.formular),limitprice=0==y.limitprice?formularprice:y.limitprice;_this.currentsample.standardfee=_this.currentsample.standardfee+(formularprice<=limitprice?formularprice:limitprice)})),tempdata.map((function(e){return _this.projectdata.push(e)}))}))}},{key:"getproject",value:function(){var e,t,a=this;this.projectdata=[],this.externprojectdata=[],this.processid=null!=this.currentsample.process?Number(null===(e=this.currentsample.process)||void 0===e?void 0:e.id):2,null===(t=this.currentsample.testprojects)||void 0===t||t.map((function(e){0==e.isextern?a.projectdata.push(e):1==e.isextern&&a.externprojectdata.push(e)})),this.projecttotal=Number(this.projectdata.length),this.externtotal=Number(this.externprojectdata.length),this.projectdata=_toConsumableArray(this.projectdata),this.externprojectdata=_toConsumableArray(this.externprojectdata)}},{key:"exterquaconfirm",value:function(){var e;this.externprojectdata=[];for(var t=0;t<this.externselqual.selquali.length;t++)this.externprojectdata.push({id:src_share_utilclass__WEBPACK_IMPORTED_MODULE_3__.a.JsNewGuid(),sampleid:(null===(e=this.currentsample)||void 0===e?void 0:e.id)+"",qualificationid:this.externselqual.selquali[t].id+"",testproject:this.externselqual.selquali[t].testproject,isextern:1});this.externtotal=this.externprojectdata.length}},{key:"externprojectaction",value:function(e,t){var a=this;switch(this.externselqual.getData(!0),e){case"add":"add"!=this.type&&"edit"!=this.type||(this.qexternvisible=!0),this.externselqual.selquali=[],this.externprojectdata.forEach((function(e){a.externselqual.selquali.push({id:Number(e.qualificationid),testproject:e.testproject,testcount:e.testcount})})),this.externselqual.refreshdata();break;case"delete":this.deleteprojectmethod((null==t?void 0:t.id)+"",this.externprojectdata),this.externprojectdata=_toConsumableArray(this.externprojectdata)}}},{key:"ngDoCheck",value:function(){}},{key:"projectaction",value:function(e,t){var a=this;switch(this.qualificationcomponent.getData(!1),e){case"add":"add"!=this.type&&"edit"!=this.type||(this.qvisible=!0),this.qualificationcomponent.selquali=[],this.projectdata.forEach((function(e){a.qualificationcomponent.selquali.push({id:Number(e.qualificationid),testproject:e.testproject,testcount:e.testcount})})),this.qualificationcomponent.refreshdata();break;case"delete":this.deleteprojectmethod((null==t?void 0:t.id)+"",this.projectdata),this.projectdata=_toConsumableArray(this.projectdata)}}},{key:"deleteprojectmethod",value:function(e,t){var a=null==t?void 0:t.findIndex((function(t){return t.id===e}));null==t||t.splice(Number(a),1)}},{key:"setcurrent",value:function(e,t){this.currentsample=t,this.type=e,this.action(e),this.getproject()}},{key:"ngOnInit",value:function(){var e=this;this.domainservice.getList(1,20,{}).subscribe((function(t){e.domaindata=t.list,e.currentsample.domainid=Number(e.domaindata[0].id)})),setTimeout((function(){e.showTableBoolean=!0}),3e3),setTimeout((function(){e.showdivBoolean=!0}),0),this.commonservice.getsampleprocess().subscribe((function(t){e.process=t.list}))}},{key:"ngAfterViewInit",value:function(){}},{key:"setsavedata",value:function(){var e=this;this.currentsample.testproject="",this.currentsample.methodname="",this.currentsample.testprojects=[];for(var t=this.projectdata.concat(this.externprojectdata),a=0;a<t.length;a++)this.currentsample.testproject+=t[a].testproject,this.currentsample.methodname+=t[a].standardname,a!=t.length-1&&(this.currentsample.testproject+=",",this.currentsample.methodname+=","),this.currentsample.testprojects.push(t[a]);var i=this.process.findIndex((function(t){return t.id==e.processid}));-1!=i&&(this.currentsample.process=this.process[i])}},{key:"action",value:function(e){if(null!=this.currentsample)switch(e){case"info":this.getproject();break;case"edit":this.action("info");break;case"save":this.setsavedata(),"add"===this.type?this.sendaddsample.emit("add"):"edit"===this.type&&this.sendaddsample.emit("edit");break;case"cancel":this.sendaddsample.emit("cancel")}this.qvisible=!1}},{key:"formInvalid",get:function(){return!!this.methodInvalid||0==this.projectdata.length&&(this.invalidstring="\u6837\u54c1\u68c0\u6d4b\u9879\u76ee\u4e3a\u7a7a!",!0)}},{key:"methodInvalid",get:function(){return this.invalidstring="",null==this.inputsamplename||null!=this.inputsamplename.value&&""!=this.inputsamplename.value?null==this.inputsamplequality||null!=this.inputsamplequality.value&&""!=this.inputsamplequality.value?null==this.inputsamplequality||null==this.inputsamplequality.value||/^[0-9]{1,10}$/.test(this.inputsamplequality.value)?null==this.inputsampleprice||null!=this.inputsampleprice.value&&""!=this.inputsampleprice.value?(null!=this.inputsampleprice&&null!=this.inputsampleprice.value&&isNaN(this.inputsampleprice.value)||!(null==this.inputexternice||null==this.inputexternice.value||!isNaN(this.inputexternice.value)))&&(this.invalidstring="\u6837\u54c1\u4ef7\u683c\u53ea\u80fd\u662f\u6570\u5b57!",!0):(this.invalidstring="\u6837\u54c1\u4ef7\u683c\u4e3a\u7a7a!",!0):(this.invalidstring="\u6837\u54c1\u6570\u91cf\u53ea\u80fd\u662f\u6570\u5b57!",!0):(this.invalidstring="\u6837\u54c1\u6570\u91cf\u4e3a\u7a7a!",!0):(this.invalidstring="\u6837\u54c1\u540d\u79f0\u4e3a\u7a7a!",!0)}},{key:"disabled",get:function(){return"info"===this.type}}]),AddsampleComponent}();return AddsampleComponent.\u0275fac=function(e){return new(e||AddsampleComponent)(_angular_core__WEBPACK_IMPORTED_MODULE_0__.Ib(src_services_sample_service__WEBPACK_IMPORTED_MODULE_1__.a),_angular_core__WEBPACK_IMPORTED_MODULE_0__.Ib(_businessproject_businessproject_service__WEBPACK_IMPORTED_MODULE_4__.c),_angular_core__WEBPACK_IMPORTED_MODULE_0__.Ib(_ng_nest_ui__WEBPACK_IMPORTED_MODULE_6__.c),_angular_core__WEBPACK_IMPORTED_MODULE_0__.Ib(src_main_qualification_qualification_service__WEBPACK_IMPORTED_MODULE_2__.d))},AddsampleComponent.\u0275cmp=_angular_core__WEBPACK_IMPORTED_MODULE_0__.Cb({type:AddsampleComponent,selectors:[["app-addsample"]],viewQuery:function(e,t){var a;1&e&&(_angular_core__WEBPACK_IMPORTED_MODULE_0__.Bc(_c0,!0),_angular_core__WEBPACK_IMPORTED_MODULE_0__.Bc(_c1,!0),_angular_core__WEBPACK_IMPORTED_MODULE_0__.Bc(_c2,!0),_angular_core__WEBPACK_IMPORTED_MODULE_0__.Bc(_c3,!0),_angular_core__WEBPACK_IMPORTED_MODULE_0__.Bc(_c4,!0),_angular_core__WEBPACK_IMPORTED_MODULE_0__.Bc(_c5,!0)),2&e&&(_angular_core__WEBPACK_IMPORTED_MODULE_0__.ic(a=_angular_core__WEBPACK_IMPORTED_MODULE_0__.Wb())&&(t.inputsamplename=a.first),_angular_core__WEBPACK_IMPORTED_MODULE_0__.ic(a=_angular_core__WEBPACK_IMPORTED_MODULE_0__.Wb())&&(t.inputsamplequality=a.first),_angular_core__WEBPACK_IMPORTED_MODULE_0__.ic(a=_angular_core__WEBPACK_IMPORTED_MODULE_0__.Wb())&&(t.inputsampleprice=a.first),_angular_core__WEBPACK_IMPORTED_MODULE_0__.ic(a=_angular_core__WEBPACK_IMPORTED_MODULE_0__.Wb())&&(t.inputexternice=a.first),_angular_core__WEBPACK_IMPORTED_MODULE_0__.ic(a=_angular_core__WEBPACK_IMPORTED_MODULE_0__.Wb())&&(t.qualificationcomponent=a.first),_angular_core__WEBPACK_IMPORTED_MODULE_0__.ic(a=_angular_core__WEBPACK_IMPORTED_MODULE_0__.Wb())&&(t.externselqual=a.first))},inputs:{currentsample:"currentsample",domaindisabled:"domaindisabled"},outputs:{sendaddsample:"sendaddsample"},decls:67,vars:47,consts:[["width","80%","height","50%","placement","top",3,"visible","backdropClose","hasBackdrop","visibleChange","confirm"],["dialogqulification",""],[2,"width","100%","height","100%",3,"tablespan","modify","treespan","producthidden","qualitreeheight"],["selqual",""],["width","35%","height","50%","placement","top",3,"visible","backdropClose","hasBackdrop","visibleChange","confirm"],["dialogexterqulification",""],[2,"width","100%","height","100%",3,"modify","tablespan","treespan"],["externselqual",""],[1,"au-inner","au-column"],["span","4"],["plain","","size","small","icon","fto-chevron-left",3,"click"],["icon","fto-save","type","primary","plain","","size","small",3,"disabled","click"],["span","16"],["id","displaytag",2,"color","crimson","font-size","10pt"],[2,"height","20px"],["span","8"],["label","\u6837\u54c1\u540d\u79f0","required","","direction","row",3,"disabled","ngModel","ngModelChange"],["inputsamplename",""],["span","2"],["span","6"],[3,"disabled","data","ngModel","ngModelChange"],["label","\u6837\u54c1\u5904\u7406","direction","row",3,"data","ngModel","ngModelChange"],["label","\u6837\u54c1\u4ef7\u683c","required","","direction","row",3,"disabled","ngModel","ngModelChange"],["inputsampleprice",""],["readonly","true","label","\u6807\u51c6\u68c0\u6d4b\u8d39","direction","row",3,"disabled","ngModel","ngModelChange"],["inputexternice",""],[2,"text-align","center","font-weight","bolder","font-size","12pt"],[2,"height","20"],["icon","ado-search","plain","","size","small","type","primary",3,"disabled","click"],["adaptionHeight","600","virtualScroll","","loading","",1,"x-table.x-pagination",3,"data","columns","index","size","total","query","bodyColumnTpl","indexChange","sizeChange"],["projecttable",""],["plain","","size","small","icon","ado-search","type","primary",3,"disabled","click"],["adaptionHeight","600","virtualScroll","","loading","",3,"data","columns","index","size","total","query","bodyColumnTpl","indexChange","sizeChange"],["projectTpl",""],["exprojectTpl",""],[1,"au-table-actions"],["icon","fto-trash-2","title","\u5220\u9664",3,"disabled","click"]],template:function(e,t){if(1&e&&(_angular_core__WEBPACK_IMPORTED_MODULE_0__.Ob(0,"x-dialog",0,1),_angular_core__WEBPACK_IMPORTED_MODULE_0__.Vb("visibleChange",(function(e){return t.qvisible=e}))("confirm",(function(){return t.quaconfirm()})),_angular_core__WEBPACK_IMPORTED_MODULE_0__.Jb(2,"app-qualification",2,3),_angular_core__WEBPACK_IMPORTED_MODULE_0__.Nb(),_angular_core__WEBPACK_IMPORTED_MODULE_0__.Ob(4,"x-dialog",4,5),_angular_core__WEBPACK_IMPORTED_MODULE_0__.Vb("visibleChange",(function(e){return t.qexternvisible=e}))("confirm",(function(){return t.exterquaconfirm()})),_angular_core__WEBPACK_IMPORTED_MODULE_0__.Jb(6,"app-qualification",6,7),_angular_core__WEBPACK_IMPORTED_MODULE_0__.Nb(),_angular_core__WEBPACK_IMPORTED_MODULE_0__.Ob(8,"x-inner",8),_angular_core__WEBPACK_IMPORTED_MODULE_0__.Ob(9,"x-row"),_angular_core__WEBPACK_IMPORTED_MODULE_0__.Ob(10,"x-col",9),_angular_core__WEBPACK_IMPORTED_MODULE_0__.Ob(11,"x-button",10),_angular_core__WEBPACK_IMPORTED_MODULE_0__.Vb("click",(function(){return t.action("cancel")})),_angular_core__WEBPACK_IMPORTED_MODULE_0__.wc(12,"\u8fd4\u56de"),_angular_core__WEBPACK_IMPORTED_MODULE_0__.Nb(),_angular_core__WEBPACK_IMPORTED_MODULE_0__.Nb(),_angular_core__WEBPACK_IMPORTED_MODULE_0__.Ob(13,"x-col",9),_angular_core__WEBPACK_IMPORTED_MODULE_0__.Ob(14,"x-button",11),_angular_core__WEBPACK_IMPORTED_MODULE_0__.Vb("click",(function(){return!t.formInvalid&&t.action("save")})),_angular_core__WEBPACK_IMPORTED_MODULE_0__.wc(15," \u4fdd\u5b58 "),_angular_core__WEBPACK_IMPORTED_MODULE_0__.Nb(),_angular_core__WEBPACK_IMPORTED_MODULE_0__.Nb(),_angular_core__WEBPACK_IMPORTED_MODULE_0__.Ob(16,"x-col",12),_angular_core__WEBPACK_IMPORTED_MODULE_0__.Ob(17,"div",13),_angular_core__WEBPACK_IMPORTED_MODULE_0__.wc(18),_angular_core__WEBPACK_IMPORTED_MODULE_0__.Nb(),_angular_core__WEBPACK_IMPORTED_MODULE_0__.Nb(),_angular_core__WEBPACK_IMPORTED_MODULE_0__.Nb(),_angular_core__WEBPACK_IMPORTED_MODULE_0__.Jb(19,"x-row",14),_angular_core__WEBPACK_IMPORTED_MODULE_0__.Ob(20,"x-row"),_angular_core__WEBPACK_IMPORTED_MODULE_0__.Ob(21,"x-col",15),_angular_core__WEBPACK_IMPORTED_MODULE_0__.Ob(22,"x-input",16,17),_angular_core__WEBPACK_IMPORTED_MODULE_0__.Vb("ngModelChange",(function(e){return t.currentsample.samplename=e})),_angular_core__WEBPACK_IMPORTED_MODULE_0__.Nb(),_angular_core__WEBPACK_IMPORTED_MODULE_0__.Nb(),_angular_core__WEBPACK_IMPORTED_MODULE_0__.Ob(24,"x-col",18),_angular_core__WEBPACK_IMPORTED_MODULE_0__.wc(25," \u9886\u57df "),_angular_core__WEBPACK_IMPORTED_MODULE_0__.Nb(),_angular_core__WEBPACK_IMPORTED_MODULE_0__.Ob(26,"x-col",19),_angular_core__WEBPACK_IMPORTED_MODULE_0__.Ob(27,"x-select",20),_angular_core__WEBPACK_IMPORTED_MODULE_0__.Vb("ngModelChange",(function(e){return t.currentsample.domainid=e})),_angular_core__WEBPACK_IMPORTED_MODULE_0__.Nb(),_angular_core__WEBPACK_IMPORTED_MODULE_0__.Nb(),_angular_core__WEBPACK_IMPORTED_MODULE_0__.Ob(28,"x-col",15),_angular_core__WEBPACK_IMPORTED_MODULE_0__.Ob(29,"x-select",21),_angular_core__WEBPACK_IMPORTED_MODULE_0__.Vb("ngModelChange",(function(e){return t.processid=e})),_angular_core__WEBPACK_IMPORTED_MODULE_0__.Nb(),_angular_core__WEBPACK_IMPORTED_MODULE_0__.Nb(),_angular_core__WEBPACK_IMPORTED_MODULE_0__.Nb(),_angular_core__WEBPACK_IMPORTED_MODULE_0__.Jb(30,"x-row",14),_angular_core__WEBPACK_IMPORTED_MODULE_0__.Ob(31,"x-row"),_angular_core__WEBPACK_IMPORTED_MODULE_0__.Ob(32,"x-col",15),_angular_core__WEBPACK_IMPORTED_MODULE_0__.Ob(33,"x-input",22,23),_angular_core__WEBPACK_IMPORTED_MODULE_0__.Vb("ngModelChange",(function(e){return t.currentsample.price=e})),_angular_core__WEBPACK_IMPORTED_MODULE_0__.Nb(),_angular_core__WEBPACK_IMPORTED_MODULE_0__.Nb(),_angular_core__WEBPACK_IMPORTED_MODULE_0__.Ob(35,"x-col",15),_angular_core__WEBPACK_IMPORTED_MODULE_0__.Ob(36,"x-input",24,25),_angular_core__WEBPACK_IMPORTED_MODULE_0__.Vb("ngModelChange",(function(e){return t.currentsample.standardfee=e})),_angular_core__WEBPACK_IMPORTED_MODULE_0__.Nb(),_angular_core__WEBPACK_IMPORTED_MODULE_0__.Nb(),_angular_core__WEBPACK_IMPORTED_MODULE_0__.Nb(),_angular_core__WEBPACK_IMPORTED_MODULE_0__.Jb(38,"x-row",14),_angular_core__WEBPACK_IMPORTED_MODULE_0__.Ob(39,"x-row"),_angular_core__WEBPACK_IMPORTED_MODULE_0__.Ob(40,"x-col",26),_angular_core__WEBPACK_IMPORTED_MODULE_0__.wc(41," \u68c0\u6d4b\u9879\u76ee\u4fe1\u606f "),_angular_core__WEBPACK_IMPORTED_MODULE_0__.Nb(),_angular_core__WEBPACK_IMPORTED_MODULE_0__.Nb(),_angular_core__WEBPACK_IMPORTED_MODULE_0__.Jb(42,"x-row",27),_angular_core__WEBPACK_IMPORTED_MODULE_0__.Ob(43,"x-row"),_angular_core__WEBPACK_IMPORTED_MODULE_0__.Ob(44,"x-col",9),_angular_core__WEBPACK_IMPORTED_MODULE_0__.Ob(45,"x-button",28),_angular_core__WEBPACK_IMPORTED_MODULE_0__.Vb("click",(function(){return!t.methodInvalid&&t.projectaction("add")})),_angular_core__WEBPACK_IMPORTED_MODULE_0__.wc(46," \u6dfb\u52a0 "),_angular_core__WEBPACK_IMPORTED_MODULE_0__.Nb(),_angular_core__WEBPACK_IMPORTED_MODULE_0__.Nb(),_angular_core__WEBPACK_IMPORTED_MODULE_0__.Nb(),_angular_core__WEBPACK_IMPORTED_MODULE_0__.Ob(47,"x-row"),_angular_core__WEBPACK_IMPORTED_MODULE_0__.Ob(48,"x-col"),_angular_core__WEBPACK_IMPORTED_MODULE_0__.Ob(49,"x-table",29,30),_angular_core__WEBPACK_IMPORTED_MODULE_0__.Vb("indexChange",(function(e){return t.projectindex=e}))("sizeChange",(function(e){return t.projectsize=e})),_angular_core__WEBPACK_IMPORTED_MODULE_0__.Nb(),_angular_core__WEBPACK_IMPORTED_MODULE_0__.Nb(),_angular_core__WEBPACK_IMPORTED_MODULE_0__.Nb(),_angular_core__WEBPACK_IMPORTED_MODULE_0__.Ob(51,"x-row"),_angular_core__WEBPACK_IMPORTED_MODULE_0__.Ob(52,"x-col",26),_angular_core__WEBPACK_IMPORTED_MODULE_0__.wc(53," \u5916\u5305\u9879\u76ee\u4fe1\u606f "),_angular_core__WEBPACK_IMPORTED_MODULE_0__.Nb(),_angular_core__WEBPACK_IMPORTED_MODULE_0__.Nb(),_angular_core__WEBPACK_IMPORTED_MODULE_0__.Jb(54,"x-row",27),_angular_core__WEBPACK_IMPORTED_MODULE_0__.Ob(55,"x-row"),_angular_core__WEBPACK_IMPORTED_MODULE_0__.Ob(56,"x-col",9),_angular_core__WEBPACK_IMPORTED_MODULE_0__.Ob(57,"x-button",31),_angular_core__WEBPACK_IMPORTED_MODULE_0__.Vb("click",(function(){return!t.methodInvalid&&t.externprojectaction("add")})),_angular_core__WEBPACK_IMPORTED_MODULE_0__.wc(58," \u6dfb\u52a0 "),_angular_core__WEBPACK_IMPORTED_MODULE_0__.Nb(),_angular_core__WEBPACK_IMPORTED_MODULE_0__.Nb(),_angular_core__WEBPACK_IMPORTED_MODULE_0__.Nb(),_angular_core__WEBPACK_IMPORTED_MODULE_0__.Ob(59,"x-row"),_angular_core__WEBPACK_IMPORTED_MODULE_0__.Ob(60,"x-col"),_angular_core__WEBPACK_IMPORTED_MODULE_0__.Ob(61,"x-table",32,30),_angular_core__WEBPACK_IMPORTED_MODULE_0__.Vb("indexChange",(function(e){return t.externprojectindex=e}))("sizeChange",(function(e){return t.externprojectsize=e})),_angular_core__WEBPACK_IMPORTED_MODULE_0__.Nb(),_angular_core__WEBPACK_IMPORTED_MODULE_0__.Nb(),_angular_core__WEBPACK_IMPORTED_MODULE_0__.Nb(),_angular_core__WEBPACK_IMPORTED_MODULE_0__.Nb(),_angular_core__WEBPACK_IMPORTED_MODULE_0__.uc(63,AddsampleComponent_ng_template_63_Template,2,1,"ng-template",null,33,_angular_core__WEBPACK_IMPORTED_MODULE_0__.vc),_angular_core__WEBPACK_IMPORTED_MODULE_0__.uc(65,AddsampleComponent_ng_template_65_Template,2,1,"ng-template",null,34,_angular_core__WEBPACK_IMPORTED_MODULE_0__.vc)),2&e){var a=_angular_core__WEBPACK_IMPORTED_MODULE_0__.jc(64),i=_angular_core__WEBPACK_IMPORTED_MODULE_0__.jc(66);_angular_core__WEBPACK_IMPORTED_MODULE_0__.ec("visible",t.qvisible)("backdropClose",!1)("hasBackdrop",!1),_angular_core__WEBPACK_IMPORTED_MODULE_0__.yb(2),_angular_core__WEBPACK_IMPORTED_MODULE_0__.ec("tablespan",15)("modify",1)("treespan",5)("producthidden",t.producthidden)("qualitreeheight",t.qualitreeheight),_angular_core__WEBPACK_IMPORTED_MODULE_0__.yb(2),_angular_core__WEBPACK_IMPORTED_MODULE_0__.ec("visible",t.qexternvisible)("backdropClose",!1)("hasBackdrop",!1),_angular_core__WEBPACK_IMPORTED_MODULE_0__.yb(2),_angular_core__WEBPACK_IMPORTED_MODULE_0__.ec("modify",1)("tablespan",10)("treespan",10),_angular_core__WEBPACK_IMPORTED_MODULE_0__.yb(8),_angular_core__WEBPACK_IMPORTED_MODULE_0__.ec("disabled",t.formInvalid||t.disabled),_angular_core__WEBPACK_IMPORTED_MODULE_0__.yb(4),_angular_core__WEBPACK_IMPORTED_MODULE_0__.xc(t.invalidstring),_angular_core__WEBPACK_IMPORTED_MODULE_0__.yb(4),_angular_core__WEBPACK_IMPORTED_MODULE_0__.ec("disabled",t.disabled)("ngModel",t.currentsample.samplename),_angular_core__WEBPACK_IMPORTED_MODULE_0__.yb(5),_angular_core__WEBPACK_IMPORTED_MODULE_0__.ec("disabled",t.domaindisabled||t.disabled)("data",t.domaindata)("ngModel",t.currentsample.domainid),_angular_core__WEBPACK_IMPORTED_MODULE_0__.yb(2),_angular_core__WEBPACK_IMPORTED_MODULE_0__.ec("data",t.process)("ngModel",t.processid),_angular_core__WEBPACK_IMPORTED_MODULE_0__.yb(4),_angular_core__WEBPACK_IMPORTED_MODULE_0__.ec("disabled",t.disabled)("ngModel",t.currentsample.price),_angular_core__WEBPACK_IMPORTED_MODULE_0__.yb(3),_angular_core__WEBPACK_IMPORTED_MODULE_0__.ec("disabled",t.disabled)("ngModel",t.currentsample.standardfee),_angular_core__WEBPACK_IMPORTED_MODULE_0__.yb(9),_angular_core__WEBPACK_IMPORTED_MODULE_0__.ec("disabled",t.methodInvalid||t.disabled),_angular_core__WEBPACK_IMPORTED_MODULE_0__.yb(4),_angular_core__WEBPACK_IMPORTED_MODULE_0__.ec("data",t.projectdata)("columns",t.projectcolumns)("index",t.projectindex)("size",t.projectsize)("total",t.projecttotal)("query",t.projectquery)("bodyColumnTpl",_angular_core__WEBPACK_IMPORTED_MODULE_0__.gc(43,_c6,a)),_angular_core__WEBPACK_IMPORTED_MODULE_0__.yb(8),_angular_core__WEBPACK_IMPORTED_MODULE_0__.ec("disabled",t.methodInvalid||t.disabled),_angular_core__WEBPACK_IMPORTED_MODULE_0__.yb(4),_angular_core__WEBPACK_IMPORTED_MODULE_0__.ec("data",t.externprojectdata)("columns",t.externprojectcolumns)("index",t.externprojectindex)("size",t.externprojectsize)("total",t.externtotal)("query",t.externprojectquery)("bodyColumnTpl",_angular_core__WEBPACK_IMPORTED_MODULE_0__.gc(45,_c6,i))}},directives:[_ng_nest_ui__WEBPACK_IMPORTED_MODULE_7__.a,src_main_qualification_qualification_component__WEBPACK_IMPORTED_MODULE_5__.a,_ng_nest_ui_inner__WEBPACK_IMPORTED_MODULE_12__.a,_ng_nest_ui__WEBPACK_IMPORTED_MODULE_8__.c,_ng_nest_ui__WEBPACK_IMPORTED_MODULE_8__.a,_ng_nest_ui__WEBPACK_IMPORTED_MODULE_9__.a,_ng_nest_ui__WEBPACK_IMPORTED_MODULE_10__.a,_angular_forms__WEBPACK_IMPORTED_MODULE_13__.B,_angular_forms__WEBPACK_IMPORTED_MODULE_13__.q,_angular_forms__WEBPACK_IMPORTED_MODULE_13__.t,_ng_nest_ui__WEBPACK_IMPORTED_MODULE_11__.a,_ng_nest_ui_table__WEBPACK_IMPORTED_MODULE_14__.a,_ng_nest_ui_link__WEBPACK_IMPORTED_MODULE_15__.a],styles:[":host x-table.x-pagination{padding-top:.875rem;display:none}"],encapsulation:3}),AddsampleComponent}()},jnZo:function(e,t,a){"use strict";a.r(t),a.d(t,"EvirmentheathModule",(function(){return Je}));var i,n=a("tyNb"),c=a("3pM9"),r=a("HDdC"),s=a("LvDl"),o=a("fXoL"),l=((i=function(){function e(){_classCallCheck(this,e),this.localdata=[]}return _createClass(e,[{key:"setlocaldata",value:function(e){this.localdata=e}},{key:"getList",value:function(e,t,a,i){var n=this;return new r.a((function(t){n.setFilter(e,(null==i?void 0:i.filterLogic)||"and",null==i?void 0:i.filter),t.complete()}))}},{key:"get",value:function(e){return new r.a}},{key:"post",value:function(e){return new r.a}},{key:"put",value:function(e){return new r.a}},{key:"delete",value:function(e){return new r.a}},{key:"setFilter",value:function(e,t,a){var i=e;return a&&a.length>0&&(i=e.filter((function(e){var i=!1;if("or"==t){for(var n=0;n<a.length;n++)if(e[a[n].field].indexOf(a[n].value)>=0){i=!0;break}}else if("and"==t)for(i=!0,n=0;n<a.length;n++)if(-1==e[a[n].field].indexOf(a[n].value)){i=!1;break}return i}))),i}},{key:"setGroup",value:function(e,t){return Object(s.map)(Object(c.L)(e,t),(function(e,a){var i={id:a,count:e.length};return i[t]=a,i}))}},{key:"setSort",value:function(e,t){return Object(s.orderBy)(e,Object(s.map)(t,(function(e){return e.field})),Object(s.map)(t,(function(e){return e.value})))}}]),e}()).\u0275fac=function(e){return new(e||i)},i.\u0275prov=o.Eb({token:i,factory:i.\u0275fac}),i),_=a("wTjX"),u=a("K7LP"),d=a("LZRM"),b=a("BzWU"),h=a("wd/R"),p=a("TPaT"),m=a("eIN6"),f=a("x2e1"),g=a("x6Xy"),v=a("qMpK"),E=a("SfH5"),O=a("GvSL"),C=a("yO6f"),M=a("kXfN"),P=["contacttable"];function y(e,t){if(1&e){var a=o.Pb();o.Ob(0,"div",5),o.Ob(1,"x-link",6),o.Vb("click",(function(){o.lc(a);var e=t.$row,i=o.Yb();return!i.submitdisable(e)&&i.auth.delete&&i.cotactaction("delete",e)})),o.Nb(),o.Ob(2,"x-link",7),o.Vb("click",(function(){o.lc(a);var e=t.$row,i=o.Yb();return!i.submitdisable(e)&&i.auth.submit&&i.cotactaction("submit",e)})),o.Nb(),o.Nb()}if(2&e){var i=t.$row,n=o.Yb();o.yb(1),o.ec("disabled",!n.auth.delete||n.submitdisable(i)),o.yb(1),o.ec("disabled",!n.auth.submit||n.submitdisable(i))}}var D,x,w,I,k=function(e){return{actions:e}},B=((D=function(e){_inherits(a,e);var t=_createSuper(a);function a(e,i,n,c,r,s,l){var _;return _classCallCheck(this,a),(_=t.call(this,e)).indexService=e,_.contactservice=i,_.msgBox=n,_.msg=c,_.flowservice=r,_.projectservice=s,_.rolediscountservice=l,_.contactChange=new o.n,_.contactdata=[],_.allcontactdata=[],_.contactcolumns=[{id:"index",label:"\u5e8f\u53f7",width:50,type:"index"},{id:"actions",label:"\u64cd\u4f5c",width:50},{id:"id",label:"\u5408\u540c\u7f16\u53f7",width:80,sort:!0},{id:"totalfee",label:"\u603b\u8d39\u7528",width:80,sort:!0},{id:"testfee",label:"\u68c0\u6d4b\u8d39",width:80,sort:!0},{id:"standardfee",label:"\u6807\u51c6\u68c0\u6d4b\u8d39",width:100,sort:!0},{id:"discount",label:"\u6298\u6263",width:80},{id:"ugency",label:"\u52a0\u6025\u7c7b\u578b",width:80,sort:!0},{id:"signdate",label:"\u7b7e\u8ba2\u65e5\u671f",width:100,sort:!0}],_.activeid="",_.contactindex=1,_.contactsize=20,_.contacttotal=0,_.contactquery={filter:[]},_.auth={},_}return _createClass(a,[{key:"ngOnInit",value:function(){}},{key:"setActive",value:function(e){this.activeid=e}},{key:"cotactaction",value:function(e,t){var a=this;switch(e){case"add":if(null==this.customer||null==this.customer.id||""==this.customer.id)this.msgBox.alert("\u8fd8\u6ca1\u6709\u9009\u62e9\u5ba2\u6237");else{var i=h().format("YYYY-MM-DD");this.currentContact={id:b.a.GetRandomStr(!0,5,16),customerid:this.customer.id,signdate:i},console.log(i),this.currentContact.userid=this.indexService.auth.user.id+"",this.contactservice.post(this.currentContact).subscribe((function(e){a.currentContact=e,a.contactdata.push(e),a.contactdata=a.contactdata.map((function(e){return e})),a.contacttotal=a.contactdata.length,a.contacttable.activatedRow=e,null!=a.contactchange&&a.contactChange.emit(e)}))}break;case"delete":this.msgBox.confirm({title:"\u63d0\u793a",content:"\u6b64\u64cd\u4f5c\u5c06\u6c38\u4e45\u5220\u9664\u6b64\u6761\u6570\u636e\uff1a".concat(t.id,"\uff0c\u662f\u5426\u7ee7\u7eed\uff1f"),type:"warning",callback:function(e){"confirm"===e&&a.contactservice.delete(t.id||"").subscribe((function(e){var i=b.a.setafterdelete(t.id,a.contactdata);a.msg.success("\u5220\u9664\u6210\u529f"),a.contactdata=a.contactdata.map((function(e){return e})),a.contacttotal=a.contactdata.length,i>0?a.currentContact=a.contactdata[i-1]:0==i&&a.contacttotal>0&&(a.currentContact=a.contactdata[i+1]),a.contacttable.activatedRow=a.currentContact,null!=a.contactchange&&a.contactChange.emit(a.currentContact)}))}});break;case"submit":var n=t.contactcustomers.find((function(e){return 1==e.customertype}));null!=n&&null!=n.area&&this.rolediscountservice.getrolediscountvaluebyid(n.area,this.indexService.auth.user.roles).subscribe((function(e){a.flowservice.startflow({customername:n.customername,userid:a.indexService.auth.user.id+"",username:a.indexService.auth.user.name,contactid:t.id,instanceKey:"LimsTestProcess"}).subscribe((function(i){a.projectservice.getprojects(t.id).subscribe((function(n){a.flowservice.excutetask(i.TaskId,{userid:a.indexService.auth.user.id+"",username:a.indexService.auth.user.name,contactid:t.id,limitdiscount:e.discount,ugencytype:t.service.id}).subscribe((function(e){a.msg.success("\u63d0\u4ea4\u6210\u529f"),a.currentContact.contactstatus=1}))}))}))}))}}},{key:"getcontactdata",value:function(){var e=this,t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.contactquery={filter:[{field:"id",value:""+this.customer.id,operation:"="},{field:"userid",value:""+this.indexService.auth.user.id,operation:"="}]},this.contactservice.getList(this.contactindex,this.contactsize,this.contactquery).subscribe((function(a){var i;if(i=[a.list,Number(a.total)],e.contactdata=i[0],e.contacttotal=i[1],console.log(a.list),e.contactdata.length>0){if(t)if(""!=e.activeid){var n=e.contactdata.findIndex((function(t){return t.id==e.activeid}));e.currentContact=-1!=n?e.contactdata[n]:e.contactdata[0]}else e.currentContact=e.contactdata[0];e.contacttable.activatedRow=e.currentContact}e.contactChange.emit(e.currentContact)}))}},{key:"refreshdata",value:function(){this.contactdata=_toConsumableArray(this.contactdata)}},{key:"contactchange",value:function(e){this.currentContact=e,this.contactChange.emit(e)}},{key:"copaycotactaction",value:function(){var e=this;null!=this.currentContact&&null!=this.currentContact&&null!=this.currentContact.id&&this.contactservice.getcontactproject(this.currentContact.id+"").subscribe((function(t){var a,i=t.contact;i.id=b.a.GetRandomStr(!0,6,10),null===(a=i.contactcustomers)||void 0===a||a.map((function(e){e.contactid=i.id+""}));var n=t.projects,c=1;n.map((function(e){var t;e.contactid=i.id+"",e.id=b.a.JsNewGuid(),e.projectnumber="\u4e34\u65f6\u9879\u76ee"+c,c+=1,e.projectstatus=0,null===(t=e.samples)||void 0===t||t.map((function(t){var a;t.projectid=e.id+"",t.id=b.a.JsNewGuid(),null===(a=t.testprojects)||void 0===a||a.map((function(e){e.sampleid=t.id+""}))}))})),e.contactservice.addcontactproject({contact:i,projects:n}).subscribe((function(){e.currentContact=i,e.contactdata.push(i),e.contactdata=_toConsumableArray(e.contactdata),null!=e.contactChange&&e.contactChange.emit(i)}))}))}},{key:"contactIndexChange",value:function(e){this.contactindex=e}},{key:"submitdisable",value:function(e){return 1==e.contactstatus}}]),a}(u.a)).\u0275fac=function(e){return new(e||D)(o.Ib(_.a),o.Ib(d.a),o.Ib(g.c),o.Ib(v.c),o.Ib(p.a),o.Ib(f.a),o.Ib(m.a))},D.\u0275cmp=o.Cb({type:D,selectors:[["app-contact"]],viewQuery:function(e,t){var a;1&e&&o.Bc(P,!0),2&e&&o.ic(a=o.Wb())&&(t.contacttable=a.first)},inputs:{auth:"auth"},outputs:{contactChange:"contactChange"},features:[o.vb],decls:13,vars:12,consts:[["span","3"],["icon","fto-plus","plain","",3,"disabled","click"],["virtualScroll","","loading","",3,"data","columns","index","size","total","query","adaptionHeight","bodyColumnTpl","indexChange","sizeChange","activatedRowChange"],["contacttable",""],["contactTpl",""],[1,"au-table-actions"],["icon","fto-trash-2","title","\u5220\u9664",3,"disabled","click"],["icon","fto-check","type","success","title","\u63d0\u4ea4",3,"disabled","click"]],template:function(e,t){if(1&e&&(o.Ob(0,"x-row"),o.Ob(1,"x-col",0),o.Ob(2,"x-button",1),o.Vb("click",(function(){return t.auth.add&&t.cotactaction("add")})),o.wc(3," \u65b0\u589e "),o.Nb(),o.Nb(),o.Ob(4,"x-col",0),o.Ob(5,"x-button",1),o.Vb("click",(function(){return t.auth.add&&t.copaycotactaction()})),o.wc(6," \u590d\u5236\u65b0\u589e "),o.Nb(),o.Nb(),o.Nb(),o.Ob(7,"x-row"),o.Ob(8,"x-col"),o.Ob(9,"x-table",2,3),o.Vb("indexChange",(function(e){return t.contactindex=e}))("sizeChange",(function(e){return t.contactsize=e}))("activatedRowChange",(function(e){return t.contactchange(e)}))("indexChange",(function(e){return t.contactIndexChange(e)})),o.Nb(),o.Nb(),o.Nb(),o.uc(11,y,3,2,"ng-template",null,4,o.vc)),2&e){var a=o.jc(12);o.yb(2),o.ec("disabled",!t.auth.add),o.yb(3),o.ec("disabled",!t.auth.add),o.yb(4),o.ec("data",t.contactdata)("columns",t.contactcolumns)("index",t.contactindex)("size",t.contactsize)("total",t.contacttotal)("query",t.contactquery)("adaptionHeight",470)("bodyColumnTpl",o.gc(10,k,a))}},directives:[E.c,E.a,O.a,C.a,M.a],styles:[""]}),D),j=a("M3sX"),A=a("bRdP"),T=a("NtM8"),R=((x=function(e){_inherits(a,e);var t=_createSuper(a);function a(e){var i;return _classCallCheck(this,a),(i=t.call(this,e,{controller:{name:"customers",servicetype:"businessprocess"}})).http=e,i}return a}(A.a)).\u0275fac=function(e){return new(e||x)(o.Sb(T.a))},x.\u0275prov=o.Eb({token:x,factory:x.\u0275fac,providedIn:"root"}),x),W=a("lJxs"),L=((w=function(e){_inherits(a,e);var t=_createSuper(a);function a(){var e;return _classCallCheck(this,a),(e=t.apply(this,arguments)).users=[{id:1,label:"\u5317\u4eac\u5e02"},{id:2,label:"\u4e0a\u6d77\u5e02"},{id:3,label:"\u5929\u6d25\u5e02"},{id:4,label:"\u91cd\u5e86\u5e02"},{id:5,label:"\u5e7f\u4e1c\u7701"},{id:6,label:"\u6c5f\u82cf\u7701"},{id:7,label:"\u5c71\u4e1c\u7701"},{id:8,label:"\u6d59\u6c5f\u7701"},{id:9,label:"\u6cb3\u5357\u7701"},{id:10,label:"\u53f0\u6e7e\u7701"},{id:11,label:"\u6e56\u5317\u7701"},{id:12,label:"\u6e56\u5357\u7701"},{id:13,label:"\u56db\u5ddd\u7701"},{id:14,label:"\u7518\u8083\u7701"},{id:15,label:"\u9655\u897f\u7701"},{id:16,label:"\u5c71\u897f\u7701"},{id:17,label:"\u6c5f\u897f\u7701"},{id:18,label:"\u798f\u5efa\u7701"},{id:19,label:"\u8d35\u5dde\u7701"},{id:20,label:"\u8fbd\u5b81\u7701"},{id:21,label:"\u5409\u6797\u7701"},{id:22,label:"\u9ed1\u9f99\u6c5f\u7701"},{id:23,label:"\u5b89\u5fbd\u7701"},{id:24,label:"\u5185\u8499\u53e4\u81ea\u6cbb\u533a"},{id:25,label:"\u65b0\u7586\u7ef4\u543e\u5c14\u81ea\u6cbb\u533a"},{id:26,label:"\u897f\u85cf\u81ea\u6cbb\u533a"},{id:27,label:"\u6d77\u5357\u7701"},{id:28,label:"\u5b81\u590f\u56de\u65cf\u81ea\u6cbb\u533a"},{id:29,label:"\u5e7f\u897f\u58ee\u65cf\u81ea\u6cbb\u533a"},{id:30,label:"\u6cb3\u5317\u7701"},{id:31,label:"\u9999\u6e2f\u7279\u522b\u884c\u653f\u533a"},{id:32,label:"\u6fb3\u95e8\u7279\u522b\u884c\u653f\u533a"}],e}return _createClass(a,[{key:"getList",value:function(e,t,a){var i=this;return new r.a((function(n){var r=[];r=i.setFilter(i.users,null==a?void 0:a.filter),(null==a?void 0:a.group)&&(r=i.setGroup(r,a.group)),(null==a?void 0:a.sort)&&(r=i.setSort(r,a.sort));var s=Object(c.J)(r,t);n.next(e<=s.length?{total:r.length,list:s[e-1]}:{total:r.length,list:[]}),n.complete()}))}},{key:"getidbyname",value:function(e){return this.users.find((function(t){return t.label==e}))}},{key:"get",value:function(e){return new r.a}},{key:"post",value:function(e){return new r.a}},{key:"put",value:function(e){return new r.a}},{key:"delete",value:function(e){return new r.a}},{key:"setFilter",value:function(e,t){var a=e;return t&&t.length>0&&t.forEach((function(e){a=a.filter((function(t){return t[e.field].indexOf(e.value)>=0}))})),a}},{key:"setGroup",value:function(e,t){return Object(s.map)(Object(c.L)(e,t),(function(e,a){var i={id:a,count:e.length};return i[t]=a,i}))}},{key:"setSort",value:function(e,t){return Object(s.orderBy)(e,Object(s.map)(t,(function(e){return e.field})),Object(s.map)(t,(function(e){return e.value})))}}]),a}(c.z)).\u0275fac=function(e){return N(e||w)},w.\u0275prov=o.Eb({token:w,factory:w.\u0275fac}),w),N=o.Qb(L),K=a("1uEr"),U=a("ZQZ3"),q=a("MOn6"),V=a("hMyc"),z=["form"],S=((I=function(){function e(t,a,i,n){var c=this;_classCallCheck(this,e),this.message=t,this.cdr=a,this.service=i,this.provservice=n,this.config={labelWidth:"6rem"},this.sendmessage=new o.n,this.controls=[{control:"input",id:"customername",label:"\u5ba2\u6237\u540d\u79f0",required:!0,maxlength:50,pattern:/[\u4e00-\u9fa5_a-zA-Z0-9_]/},{control:"input",id:"customeraddress",label:"\u5355\u4f4d\u5730\u5740",required:!0,maxlength:50,pattern:/[\u4e00-\u9fa5_a-zA-Z0-9_]/},{control:"find",id:"customertype",label:"\u5ba2\u6237\u7c7b\u578b",required:!0,multiple:!1,treeData:function(){return[{id:"1",label:"\u5927\u5ba2\u6237"},{id:"2",label:"\u666e\u901a\u5ba2\u6237"}]}},{control:"find",id:"area",label:"\u7701\u4efd",required:!0,multiple:!1,treeData:function(){return c.provservice.getList(1,50).pipe(Object(W.a)((function(e){return e.list})))}},{control:"input",id:"contacter",label:"\u8054\u7cfb\u4eba\u59d3\u540d",required:!0},{control:"input",id:"phone",label:"\u8054\u7cfb\u4eba\u7535\u8bdd",required:!0},{control:"input",id:"fax",label:"\u4f20\u771f"},{control:"input",id:"email",label:"\u90ae\u7bb1"},{control:"input",id:"postcode",label:"\u90ae\u7f16"}]}return _createClass(e,[{key:"ngDoCheck",value:function(){}},{key:"setinitcustomer",value:function(e){var t,a,i,n;this.id=e.id+"",console.log(e),this.form.formGroup.setValue({customername:e.customername,contacter:e.contacter,customeraddress:e.customeraddress,phone:e.phone,email:e.email,customertype:{id:null===(t=e.customertype)||void 0===t?void 0:t.id,label:null===(a=e.customertype)||void 0===a?void 0:a.customertype},fax:e.fax,postcode:e.postcode,area:null==e.area?1:this.provservice.getidbyname(e.area)}),this.selectedprovince=this.provservice.getidbyname(e.area+""),this.selected={id:null==(null===(i=e.customertype)||void 0===i?void 0:i.id)?2:e.customertype.id,label:null==(null===(n=e.customertype)||void 0===n?void 0:n.customertype)?"\u666e\u901a\u5ba2\u6237":e.customertype.customertype},console.log(this.form.formGroup),this.selected.id&&(this.controls.find((function(e){return"customertype"===e.id})).value=[this.selected]),null!=this.selectedprovince&&this.selectedprovince.id&&(this.controls.find((function(e){return"area"===e.id})).value=[this.selectedprovince])}},{key:"setcurrent",value:function(e,t,a){this.userid=t,this.currentcustomer=a,this.type=e,null!=a?this.setinitcustomer(a):this.form.formGroup.setValue({customername:"",contacter:"",customeraddress:"",phone:"",email:"",customertype:{id:2,label:"\u666e\u901a\u5ba2\u6237"},fax:"",area:{id:1,label:"\u5317\u4eac"},postcode:""})}},{key:"ngOnInit",value:function(){}},{key:"ngAfterViewInit",value:function(){this.cdr.detectChanges()}},{key:"action",value:function(e){var t=this;switch(e){case"info":case"edit":break;case"save":this.form.formGroup.value.area=this.form.formGroup.value.area.label,this.form.formGroup.value.userid=this.userid,"add"===this.type?this.service.post(this.form.formGroup.value).subscribe((function(e){t.currentcustomer=e,console.log(e.id),t.message.success("\u65b0\u589e\u6210\u529f\uff01"),t.sendmessage.emit("add")})):"edit"===this.type&&(this.form.formGroup.value.id=this.id,this.currentcustomer=this.form.formGroup.value,this.service.put(this.form.formGroup.value).subscribe((function(e){t.message.success("\u4fee\u6539\u6210\u529f\uff01"),t.sendmessage.emit("edit")})));break;case"cancel":this.sendmessage.emit("cancel")}}},{key:"formInvalid",get:function(){var e,t;return null===(t=null===(e=this.form)||void 0===e?void 0:e.formGroup)||void 0===t?void 0:t.invalid}},{key:"disabled",get:function(){return"info"===this.type}}]),e}()).\u0275fac=function(e){return new(e||I)(o.Ib(v.c),o.Ib(o.h),o.Ib(R),o.Ib(L))},I.\u0275cmp=o.Cb({type:I,selectors:[["app-addcustomers"]],viewQuery:function(e,t){var a;1&e&&o.Bc(z,!0),2&e&&o.ic(a=o.Wb())&&(t.form=a.first)},outputs:{sendmessage:"sendmessage"},features:[o.xb([L])],decls:9,vars:5,consts:[[1,"au-inner","au-column"],["au-adaption","","direction","row","labelSuffix",":","labelWidth","6rem","width","24rem","labelAlign","end","span","20","space","2",1,"au-panel","au-overflow-auto",3,"outerHeight","disabled","controls"],["form",""],["bottom",""],[3,"space"],["icon","fto-chevron-left",3,"click"],["icon","fto-save","type","primary",3,"disabled","click"]],template:function(e,t){1&e&&(o.Ob(0,"x-inner",0),o.Jb(1,"x-form",1,2),o.Ob(3,"au-tool",3),o.Ob(4,"x-buttons",4),o.Ob(5,"x-button",5),o.Vb("click",(function(){return t.action("cancel")})),o.wc(6,"\u8fd4\u56de"),o.Nb(),o.Ob(7,"x-button",6),o.Vb("click",(function(){return!t.formInvalid&&t.action("save")})),o.wc(8," \u4fdd\u5b58 "),o.Nb(),o.Nb(),o.Nb(),o.Nb()),2&e&&(o.yb(1),o.ec("outerHeight",100)("disabled",t.disabled)("controls",t.controls),o.yb(3),o.ec("space",.5),o.yb(3),o.ec("disabled",t.formInvalid||t.disabled))},directives:[K.a,U.b,q.a,V.a,O.c,O.a],styles:[""]}),I),J=a("l5Yv"),G=a("P0lq"),Y=["customtable"],$=["customercomponent"],H=["searchcustom"];function F(e,t){if(1&e){var a=o.Pb();o.Ob(0,"div",15),o.Ob(1,"x-link",16),o.Vb("click",(function(){o.lc(a);var e=t.$row,i=o.Yb();return i.auth.info&&i.action("info",e)})),o.Nb(),o.Ob(2,"x-link",17),o.Vb("click",(function(){o.lc(a);var e=t.$row,i=o.Yb();return i.auth.edit&&i.action("edit",e)})),o.Nb(),o.Ob(3,"x-link",18),o.Vb("click",(function(){o.lc(a);var e=t.$row,i=o.Yb();return i.auth.delete&&i.action("delete",e)})),o.Nb(),o.Nb()}if(2&e){var i=o.Yb();o.yb(1),o.ec("disabled",!i.auth.info),o.yb(1),o.ec("disabled",!i.auth.edit),o.yb(1),o.ec("disabled",!i.auth.delete)}}var Q,X=function(e){return{actions:e}},Z=((Q=function(){function e(t,a,i,n,c){_classCallCheck(this,e),this.service=t,this.cdr=a,this.indexService=i,this.msgBox=n,this.msg=c,this.ChangeCustomer=new o.n,this.hidebutton="inline",this.customeradaption=500,this.auth={},this.multiple=!1,this.seldata=[],this.data=[],this.alldata=[],this.columns=[{id:"index",label:"\u5e8f\u53f7",width:100,left:0,type:"index"},{id:"actions",label:"\u64cd\u4f5c",width:100,left:80},{id:"customername",label:"\u5ba2\u6237\u540d\u79f0",width:200,sort:!0},{id:"area",label:"\u533a\u57df",width:300,sort:!0},{id:"customeraddress",label:"\u5355\u4f4d\u5730\u5740",width:300,sort:!0},{id:"email",label:"\u90ae\u7bb1",width:300},{id:"phone",label:"\u7535\u8bdd",width:300},{id:"contacter",label:"\u8054\u7cfb\u4eba",width:300,flex:1,sort:!0},{id:"postcode",label:"\u90ae\u7f16",width:300,flex:1},{id:"remark",label:"\u5907\u6ce8",width:700,flex:1}],this.size=50,this.index=1,this.query={filter:[]},this.total=0,this.visible=!1}return _createClass(e,[{key:"ngAfterViewInit",value:function(){this.getalldata(this.indexService.auth.user.id+""),this.getData()}},{key:"setActive",value:function(e){var t=this.data.findIndex((function(t){return t.id==e}));-1!=t&&(this.customtable.activatedRow=this.data[t],this.currentCustomer=this.data[t])}},{key:"customerchange",value:function(e){if(this.currentCustomer=e,null!=this.ChangeCustomer&&this.ChangeCustomer.emit(e),this.multiple){var t=this.seldata.findIndex((function(t){return t.id==e.id}));-1==t&&e.sel?this.seldata.push(e):!e.sel&&t>=0&&this.seldata.splice(t,1)}}},{key:"setselect",value:function(){var e=this,t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.getalldata(this.indexService.auth.user.id+""),this.getData(),this.multiple=t,t?this.columns=[{id:"sel",label:"\u9009\u62e9",width:100,left:0,type:"checkbox"},{id:"customername",label:"\u5ba2\u6237\u540d\u79f0",width:200,sort:!0},{id:"area",label:"\u533a\u57df",width:300,sort:!0},{id:"customeraddress",label:"\u5355\u4f4d\u5730\u5740",width:300,sort:!0},{id:"email",label:"\u90ae\u7bb1",width:300},{id:"phone",label:"\u7535\u8bdd",width:300},{id:"contacter",label:"\u8054\u7cfb\u4eba",width:300,flex:1,sort:!0},{id:"postcode",label:"\u90ae\u7f16",width:300,flex:1},{id:"remark",label:"\u5907\u6ce8",width:700,flex:1}]:(this.columns=[{id:"customername",label:"\u5ba2\u6237\u540d\u79f0",width:200,sort:!0},{id:"area",label:"\u533a\u57df",width:300,sort:!0},{id:"customeraddress",label:"\u5355\u4f4d\u5730\u5740",width:300,sort:!0},{id:"email",label:"\u90ae\u7bb1",width:300},{id:"phone",label:"\u7535\u8bdd",width:300},{id:"contacter",label:"\u8054\u7cfb\u4eba",width:300,flex:1,sort:!0},{id:"postcode",label:"\u90ae\u7f16",width:300,flex:1},{id:"remark",label:"\u5907\u6ce8",width:700,flex:1}],this.seldata.length>0&&(this.customtable.activatedRow=this.data.find((function(t){return t.id==e.seldata[0].id})))),this.data.map((function(t){t.sel=-1!=e.seldata.findIndex((function(e){return e.id==t.id}))}))}},{key:"searchkeydown",value:function(){""!=this.searchcustom.value?(this.query.filterLogic="or",this.query.filter=[{field:"customername",value:this.searchcustom.value,operation:"%"},{field:"customeraddress",value:this.searchcustom.value,operation:"%"}]):(this.query.filter=[],this.total=this.alldata.length),this.getData()}},{key:"ngOnInit",value:function(){}},{key:"getData",value:function(){var e=this;this.service.gethandledata(this.alldata,this.index,this.size,this.query).subscribe((function(t){var a;a=[t.list,Number(t.total)],e.data=a[0],e.total=a[1],e.total>0&&(e.multiple&&e.data.map((function(t){-1!=e.seldata.findIndex((function(e){return e.id==t.id}))&&(t.sel=!0)})),e.currentCustomer=e.data[0],e.customtable.activatedRow=e.data[0],null!=e.ChangeCustomer&&e.ChangeCustomer.emit(e.data[0]))}))}},{key:"getalldata",value:function(e){var t=this;this.query={filter:[{field:"userid",value:e,operation:"="}]},this.service.getList(this.index,this.size,this.query).subscribe((function(e){var a;a=[e.list,Number(e.total)],t.alldata=a[0],t.total=a[1],t.getData(),t.cdr.detectChanges()}))}},{key:"indexChange",value:function(e){this.index=e,this.getData()}},{key:"sortChange",value:function(e){this.query.sort=e,this.getData()}},{key:"handlecustomerchange",value:function(e){var t=this;if(this.index=1,this.size=50,this.total=0,null!=this.AddcustomersComponent.currentcustomer)switch(this.currentCustomer=this.AddcustomersComponent.currentcustomer,e){case"add":this.data.push(this.currentCustomer),this.data=this.data.map((function(e){return e})),this.customtable.activatedRow=this.currentCustomer,null!=this.ChangeCustomer&&this.ChangeCustomer.emit(this.currentCustomer);break;case"edit":this.data=this.data.map((function(e){return e.id==t.currentCustomer.id?t.currentCustomer:e}))}this.visible=!1}},{key:"action",value:function(e,t){var a=this;"delete"!=e?(this.AddcustomersComponent.setcurrent(e,this.indexService.auth.user.id+"",t),this.visible=!0):this.msgBox.confirm({title:"\u63d0\u793a",content:"\u6b64\u64cd\u4f5c\u5c06\u6c38\u4e45\u5220\u9664\u6b64\u6761\u6570\u636e\uff1a".concat(t.customername,"\uff0c\u662f\u5426\u7ee7\u7eed\uff1f"),type:"warning",callback:function(e){"confirm"===e&&a.service.delete(t.id).subscribe((function(e){var i=b.a.setafterdelete(t.id,a.data);a.data=a.data.map((function(e){return e})),a.total=a.data.length,a.msg.success("\u5220\u9664\u6210\u529f"),i>0&&(a.currentCustomer=a.data[i-1]),a.customtable.activatedRow=a.currentCustomer,null!=a.ChangeCustomer&&a.ChangeCustomer.emit(a.currentCustomer)}))}})}}]),e}()).\u0275fac=function(e){return new(e||Q)(o.Ib(R),o.Ib(o.h),o.Ib(_.a),o.Ib(g.c),o.Ib(v.c))},Q.\u0275cmp=o.Cb({type:Q,selectors:[["app-customer"]],viewQuery:function(e,t){var a;1&e&&(o.Bc(Y,!0),o.Bc($,!0),o.Bc(H,!0)),2&e&&(o.ic(a=o.Wb())&&(t.customtable=a.first),o.ic(a=o.Wb())&&(t.AddcustomersComponent=a.first),o.ic(a=o.Wb())&&(t.searchcustom=a.first))},inputs:{hidebutton:"hidebutton",customeradaption:"customeradaption",auth:"auth"},outputs:{ChangeCustomer:"ChangeCustomer"},decls:19,vars:18,consts:[["width","30%","height","70%",3,"visible","showConfirm","showCancel","backdropClose","hasBackdrop","visibleChange"],["dialogcustomer",""],[2,"width","100%","height","100%",3,"sendmessage"],["customercomponent",""],["span","3"],["id","buttonpanel"],["icon","fto-plus","plain","",3,"disabled","click"],["span","4"],["placeholder","\u8bf7\u8f93\u5165\u5185\u5bb9","icon","ado-search",3,"keyup"],["searchcustom",""],["span","24"],["customerd",""],["virtualScroll","","loading","",3,"columns","data","index","size","query","total","adaptionHeight","bodyColumnTpl","indexChange","sizeChange","queryChange","activatedRowChange","sortChange"],["customtable",""],["actionsTpl",""],[1,"au-table-actions"],["icon","fto-eye","title","\u67e5\u770b",3,"disabled","click"],["icon","fto-edit","title","\u4fee\u6539",3,"disabled","click"],["icon","fto-trash-2","title","\u5220\u9664",3,"disabled","click"]],template:function(e,t){if(1&e&&(o.Ob(0,"x-dialog",0,1),o.Vb("visibleChange",(function(e){return t.visible=e})),o.Ob(2,"app-addcustomers",2,3),o.Vb("sendmessage",(function(e){return t.handlecustomerchange(e)})),o.Nb(),o.Nb(),o.Ob(4,"x-row"),o.Ob(5,"x-col",4),o.Ob(6,"div",5),o.Ob(7,"x-button",6),o.Vb("click",(function(){return t.auth.add&&t.action("add")})),o.wc(8," \u65b0\u589e "),o.Nb(),o.Nb(),o.Nb(),o.Ob(9,"x-col",7),o.Ob(10,"x-input",8,9),o.Vb("keyup",(function(){return t.searchkeydown()})),o.Nb(),o.Nb(),o.Nb(),o.Ob(12,"x-row"),o.Ob(13,"x-col",10,11),o.Ob(15,"x-table",12,13),o.Vb("indexChange",(function(e){return t.index=e}))("sizeChange",(function(e){return t.size=e}))("queryChange",(function(e){return t.query=e}))("activatedRowChange",(function(e){return t.customerchange(e)}))("indexChange",(function(e){return t.indexChange(e)}))("sortChange",(function(e){return t.sortChange(e)})),o.Nb(),o.Nb(),o.Nb(),o.uc(17,F,4,3,"ng-template",null,14,o.vc)),2&e){var a=o.jc(18);o.ec("visible",t.visible)("showConfirm",!1)("showCancel",!1)("backdropClose",!1)("hasBackdrop",!1),o.yb(6),o.rc("display",t.hidebutton),o.yb(1),o.ec("disabled",!t.auth.add),o.yb(8),o.ec("columns",t.columns)("data",t.data)("index",t.index)("size",t.size)("query",t.query)("total",t.total)("adaptionHeight",t.customeradaption)("bodyColumnTpl",o.gc(16,X,a))}},directives:[J.a,S,E.c,E.a,O.a,G.a,C.a,M.a],styles:[""]}),Q),ee=a("bwiJ"),te=["samplecomponent"],ae=["sampletable"];function ie(e,t){if(1&e){var a=o.Pb();o.Ob(0,"div",9),o.Ob(1,"x-link",10),o.Vb("click",(function(){o.lc(a);var e=t.$row;return o.Yb().sampleaction("info",e)})),o.Nb(),o.Ob(2,"x-link",11),o.Vb("click",(function(){o.lc(a);var e=t.$row,i=o.Yb();return!i.disabled&&i.sampleaction("edit",e)})),o.Nb(),o.Ob(3,"x-link",12),o.Vb("click",(function(){o.lc(a);var e=t.$row,i=o.Yb();return!i.disabled&&i.sampleaction("delete",e)})),o.Nb(),o.Nb()}if(2&e){var i=o.Yb();o.yb(2),o.ec("disabled",i.disabled),o.yb(1),o.ec("disabled",i.disabled)}}var ne,ce=function(e){return{actions:e}},re=((ne=function(e){_inherits(a,e);var t=_createSuper(a);function a(e,i,n){var c;return _classCallCheck(this,a),(c=t.call(this,e)).indexService=e,c.msgBox=i,c.msg=n,c.samplevisible=!1,c.samplesize=20,c.sampleindex=1,c.samplequery={filter:[]},c.sampletotal=0,c.samplecolumns=[{id:"index",label:"\u5e8f\u53f7",width:100,left:0,type:"index"},{id:"actions",label:"\u64cd\u4f5c",width:100,left:100},{id:"samplename",label:"\u6837\u54c1\u540d\u79f0",width:200,sort:!0},{id:"price",label:"\u6837\u54c1\u4ef7\u683c",width:200,sort:!0},{id:"testproject",label:"\u68c0\u6d4b\u9879\u76ee",width:200,sort:!0},{id:"methodname",label:"\u68c0\u6d4b\u65b9\u6cd5",width:200,sort:!0}],c.domaindisabled=!1,c}return _createClass(a,[{key:"ngDoCheck",value:function(){}},{key:"ngOnInit",value:function(){this.currentsample=this.getnewsample()}},{key:"getnewsample",value:function(){return{projectid:null!=this.currentproject?this.currentproject.id:void 0,id:b.a.JsNewGuid(),samplename:"",samplequality:"1",price:0,externprice:0,testprojects:[]}}},{key:"setcopy",value:function(e){var t=b.a.deepClone(e);t.id=b.a.JsNewGuid(),this.sampledata.push(t),this.sampledata=_toConsumableArray(this.sampledata)}},{key:"sampleaction",value:function(e,t){var a=this;if("copyadd"==e)return console.log(this.currentsample),void(null!=this.sampletable.activatedRow?this.setcopy(this.sampletable.activatedRow):this.msgBox.alert("\u6ca1\u6709\u590d\u5236\u5bf9\u8c61"));if(this.samplecomponent.type=e,"delete"!=e){var i=-1;null==t?(this.currentsample=this.getnewsample(),this.samplecomponent.currentsample=this.currentsample):(this.currentsample=t,i=this.sampledata.findIndex((function(e){return e.id==t.id})),this.samplecomponent.currentsample=t),0==this.currentproject.mergereport&&this.sampledata.length>0&&0!=i?(this.domaindisabled=!0,this.currentsample.domainid=this.sampledata[0].domainid):this.domaindisabled=!1,this.samplecomponent.getproject(),this.samplevisible=!0}else this.msgBox.confirm({title:"\u63d0\u793a",content:"\u6b64\u64cd\u4f5c\u5c06\u6c38\u4e45\u5220\u9664\u6b64\u6761\u6570\u636e\uff1a".concat(null==t?void 0:t.samplename,"\uff0c\u662f\u5426\u7ee7\u7eed\uff1f"),type:"warning",callback:function(e){if("confirm"===e&&null!=t){var i=b.a.setafterdelete(t.id+"",a.sampledata);a.sampledata=_toConsumableArray(a.sampledata),a.sampletotal=a.sampledata.length,i>0&&(a.currentsample=a.sampledata[i-1],a.sampletable.activatedRow=a.currentsample)}}})}},{key:"activechange",value:function(e){this.currentsample=e}},{key:"setsampledata",value:function(e){this.sampledata=[],this.sampledata=e,this.currentsample={},this.sampletable.activatedRow=void 0,this.sampledata.length>0&&(this.currentsample=this.sampledata[0],this.sampletable.activatedRow=this.currentsample)}},{key:"handlesamplechange",value:function(e){var t=this;switch(null!=this.samplecomponent.currentsample&&(this.currentsample=this.samplecomponent.currentsample),e){case"add":this.sampledata.push(this.currentsample),this.sampledata=_toConsumableArray(this.sampledata);break;case"edit":var a=this.sampledata[0].domainid;this.sampledata=this.sampledata.map((function(e){return 0==t.currentproject.mergereport&&(e.domainid=a),e.id==t.currentsample.id?t.currentsample:e}))}this.samplevisible=!1}},{key:"disabled",get:function(){return"info"==this.type}}]),a}(u.a)).\u0275fac=function(e){return new(e||ne)(o.Ib(_.a),o.Ib(g.c),o.Ib(v.c))},ne.\u0275cmp=o.Cb({type:ne,selectors:[["app-sample"]],viewQuery:function(e,t){var a;1&e&&(o.Bc(te,!0),o.Bc(ae,!0)),2&e&&(o.ic(a=o.Wb())&&(t.samplecomponent=a.first),o.ic(a=o.Wb())&&(t.sampletable=a.first))},features:[o.vb],decls:17,vars:17,consts:[["width","50%","height","60%","placement","top",3,"visible","showConfirm","showCancel","backdropClose","hasBackdrop","visibleChange"],["dialogsample",""],[2,"width","100%","height","100%",3,"currentsample","domaindisabled","sendaddsample"],["samplecomponent",""],["span","2"],["icon","fto-plus","plain","","size","small","type","primary",3,"disabled","click"],["adaptionHeight","520","virtualScroll","","loading","",3,"data","columns","index","size","total","bodyColumnTpl","indexChange","sizeChange","activatedRowChange"],["sampletable",""],["sampleTpl",""],[1,"au-table-actions"],["icon","fto-eye","title","\u67e5\u770b",3,"click"],["icon","fto-edit","title","\u4fee\u6539",3,"disabled","click"],["icon","fto-trash-2","title","\u5220\u9664",3,"disabled","click"]],template:function(e,t){if(1&e&&(o.Ob(0,"x-dialog",0,1),o.Vb("visibleChange",(function(e){return t.samplevisible=e})),o.Ob(2,"app-addsample",2,3),o.Vb("sendaddsample",(function(e){return t.handlesamplechange(e)})),o.Nb(),o.Nb(),o.Ob(4,"x-row"),o.Ob(5,"x-col",4),o.Ob(6,"x-button",5),o.Vb("click",(function(){return!t.disabled&&t.sampleaction("add")})),o.wc(7," \u65b0\u589e "),o.Nb(),o.Nb(),o.Ob(8,"x-col",4),o.Ob(9,"x-button",5),o.Vb("click",(function(){return!t.disabled&&t.sampleaction("copyadd")})),o.wc(10," \u590d\u5236\u65b0\u589e "),o.Nb(),o.Nb(),o.Nb(),o.Ob(11,"x-row"),o.Ob(12,"x-col"),o.Ob(13,"x-table",6,7),o.Vb("indexChange",(function(e){return t.sampleindex=e}))("sizeChange",(function(e){return t.samplesize=e}))("activatedRowChange",(function(e){return t.activechange(e)})),o.Nb(),o.Nb(),o.Nb(),o.uc(15,ie,4,2,"ng-template",null,8,o.vc)),2&e){var a=o.jc(16);o.ec("visible",t.samplevisible)("showConfirm",!1)("showCancel",!1)("backdropClose",!1)("hasBackdrop",!1),o.yb(2),o.ec("currentsample",t.currentsample)("domaindisabled",t.domaindisabled),o.yb(4),o.ec("disabled",t.disabled),o.yb(3),o.ec("disabled",t.disabled),o.yb(4),o.ec("data",t.sampledata)("columns",t.samplecolumns)("index",t.sampleindex)("size",t.samplesize)("total",t.sampletotal)("bodyColumnTpl",o.gc(15,ce,a))}},directives:[J.a,ee.a,E.c,E.a,O.a,C.a,M.a],styles:[""]}),ne),se=a("Prn+"),oe=a("4h90"),le=a("ofXK"),_e=a("5IKz"),ue=a("3Pt+"),de=["selcustomer"],be=["sampledata"],he=["invalidcollectionfee"],pe=["invalidbusinessfee"],me=["invalidreportcount"],fe=["invalidexternfee"];function ge(e,t){if(1&e&&(o.Ob(0,"div",30),o.wc(1),o.Nb()),2&e){var a=o.Yb();o.yb(1),o.xc(a.invalidinfo)}}function ve(e,t){if(1&e){var a=o.Pb();o.Ob(0,"x-tag",31),o.Vb("close",(function(){o.lc(a);var e=t.$implicit,i=o.Yb();return!i.contactdisabled&&!i.disabled&&i.tagclose(e,"delegate")})),o.wc(1),o.Nb()}if(2&e){var i=t.$implicit,n=o.Yb();o.ec("disabled",n.disabled||n.contactdisabled),o.yb(1),o.xc(i.customername)}}function Ee(e,t){if(1&e){var a=o.Pb();o.Ob(0,"x-tag",31),o.Vb("close",(function(){o.lc(a);var e=t.$implicit,i=o.Yb();return!i.contactdisabled&&!i.disabled&&i.tagclose(e,"pay")})),o.wc(1),o.Nb()}if(2&e){var i=t.$implicit,n=o.Yb();o.ec("disabled",n.disabled||n.contactdisabled),o.yb(1),o.xc(i.customername)}}function Oe(e,t){if(1&e){var a=o.Pb();o.Ob(0,"x-tag",31),o.Vb("close",(function(){o.lc(a);var e=t.$implicit,i=o.Yb();return!i.contactdisabled&&!i.disabled&&i.tagclose(e,"inspect")})),o.wc(1),o.Nb()}if(2&e){var i=t.$implicit,n=o.Yb();o.ec("disabled",n.disabled||n.contactdisabled),o.yb(1),o.xc(i.customername)}}var Ce,Me=((Ce=function(){function e(t,a,i,n,c,r){_classCallCheck(this,e),this.receiveservice=t,this.sealService=a,this.service=i,this.projectservicetype=n,this.domainservice=c,this.Msg=r,this.projectchange=new o.n,this.currentprojectcount=0,this.currentcontactdisabled=!1,this.multiplereportdata=[{id:0,label:"\u5408\u51fa\u62a5\u544a"},{id:1,label:"\u5206\u51fa\u62a5\u544a"}],this.multiplereport=0,this.judgedata=[{id:1,label:"\u662f"},{id:0,label:"\u5426"}],this.externdata=[{id:1,label:"\u662f"},{id:0,label:"\u5426"}],this.domaindata=[],this.domain=1,this.sealdata=[],this.seal=[],this.ugencyservice=!1,this.standardservice=!0,this.customertype="",this.delegates=[],this.inspects=[],this.pays=[],this.servicetype=1,this.selvisible=!1,this.customeradaption=240,this.hidebutton="none",this.invalidinfo="",this.showTableBoolean=!1,this.currentcontact={},this.disablecls="x-radio x-flex x-justify-start x-align-start x-direction-column",this.samplesourcedata=[],this.samplesource=1}return _createClass(e,[{key:"ngOnInit",value:function(){var e=this;this.receiveservice.getList(1,20,{}).subscribe((function(t){e.samplesourcedata=t.list})),this.sealService.getList(1,20,{}).subscribe((function(t){e.sealdata=t.list})),this.projectservicetype.getList(1,20,{}).subscribe((function(t){e.servicetypedata=t.list})),this.domainservice.getList(1,20,{}).subscribe((function(t){e.domaindata=t.list})),setTimeout((function(){e.showTableBoolean=!0}),0)}},{key:"setinit",value:function(e){var t=this;if(this.currentprojectcount=e,null!=this.currentproject.samples&&(this.sampledata.type=this.type,this.sampledata.currentproject=this.currentproject,this.sampledata.setsampledata(this.currentproject.samples)),this.delegates=[],this.pays=[],this.inspects=[],null!=this.currentcontact){if(null!=this.currentcontact.contactcustomers&&0!=this.currentcontact.contactcustomers.length&&this.currentcontact.contactcustomers.map((function(e){1==e.customertype&&t.delegates.push({id:e.customerid+"",customername:e.customername}),2==e.customertype&&t.pays.push({id:e.customerid+"",customername:e.customername}),3==e.customertype&&t.inspects.push({id:e.customerid+"",customername:e.customername})})),null!=this.currentcontact.seal){this.seal=[];for(var a=0;a<this.currentcontact.seal.length;a++)this.seal.push(Number(this.currentcontact.seal[a].id))}null!=this.currentcontact.service&&(this.servicetype=Number(this.currentcontact.service.id)),null!=this.currentcontact.samplesource&&(this.samplesource=Number(this.currentcontact.samplesource.id))}}},{key:"selconfirm",value:function(){switch(this.customertype){case"delegate":this.delegates=this.selcustomer.seldata;break;case"pay":this.pays=[this.selcustomer.customtable.activatedRow];break;case"inspect":this.inspects=[this.selcustomer.customtable.activatedRow]}}},{key:"tagclose",value:function(e,t){switch(t){case"delegate":this.deletetag(this.delegates,e.id+"");break;case"pay":this.deletetag(this.pays,e.id+"");break;case"inspect":this.deletetag(this.inspects,e.id+"")}}},{key:"deletetag",value:function(e,t){var a=e.findIndex((function(e){return e.id==t}));-1!=a&&e.splice(a,1)}},{key:"setproject",value:function(){var e,t,a,i=this;if(!this.contactdisabled&&null!=this.currentcontact){null!=this.currentcontact.contactcustomers&&(this.currentcontact.contactcustomers=[],this.delegates.map((function(e){null!=i.currentcontact.contactcustomers&&i.currentcontact.contactcustomers.push({contactid:i.currentcontact.id+"",customerid:e.id,customername:e.customername,customertype:1})})),this.pays.length>0&&this.currentcontact.contactcustomers.push({contactid:this.currentcontact.id+"",customerid:this.pays[0].id,customername:this.pays[0].customername,customertype:2}),this.inspects.length>0&&this.currentcontact.contactcustomers.push({contactid:this.currentcontact.id+"",customerid:this.inspects[0].id,customername:this.inspects[0].customername,customertype:3})),this.currentcontact.samplesource=this.getpr(this.samplesource+"",this.samplesourcedata),this.currentcontact.seal=[];for(var n=0;n<this.seal.length;n++)console.log(null===(e=this.currentcontact.seal)||void 0===e?void 0:e.findIndex((function(e){return e.id==i.seal[n].id}))),-1==(null===(t=this.currentcontact.seal)||void 0===t?void 0:t.findIndex((function(e){return e.id==i.seal[n].id})))&&(null===(a=this.currentcontact.seal)||void 0===a||a.push(this.getpr(this.seal[n]+"",this.sealdata)));this.currentcontact.service=this.getpr(this.servicetype+"",this.servicetypedata)}null!=this.currentproject&&this.sampledata.sampledata.length>0&&(this.currentproject.domain=this.getpr(this.sampledata.sampledata[0].domainid+"",this.domaindata),this.currentproject.samples=this.sampledata.sampledata)}},{key:"getpr",value:function(e,t){var a=t.find((function(t){return t.id==e}));return null!=a?a:{}}},{key:"setmultiproject",value:function(e){if(1==this.currentproject.mergereport){if(null!=this.currentproject.samples)for(var t=0;t<this.currentproject.samples.length;t++){var a={};for(var i in this.currentproject)a[i]=this.currentproject[i];a.samples=[],a.id=b.a.JsNewGuid();var n={};for(var i in this.currentproject.samples[t])n[i]=this.currentproject.samples[t][i];n.projectid=a.id,a.samples.push(n);var c=this.domaindata.find((function(e){return e.id==n.domainid}));null!=c&&(a.domain=c),a.projectnumber=a.projectnumber+""+(this.currentprojectcount+t+1),e.push(a)}}else 0==this.currentproject.projectstatus&&(this.currentproject.projectnumber="\u4e34\u65f6\u9879\u76ee"+(this.currentprojectcount+1)),e.push(this.currentproject)}},{key:"action",value:function(e){var t=this;switch(e){case"save":this.setproject();var a=[];this.setmultiproject(a),"add"==this.type?this.service.post({id:b.a.JsNewGuid(),projects:a}).subscribe((function(e){t.projectchange.emit(e.projects),t.Msg.success("\u6dfb\u52a0\u6210\u529f")})):"edit"==this.type&&(1==a.length?this.service.put({id:b.a.JsNewGuid(),projects:a}).subscribe((function(e){t.projectchange.emit(e.projects),t.Msg.success("\u4fee\u6539\u6210\u529f")})):this.service.delete(this.currentproject.id+"").subscribe((function(e){t.service.post({id:b.a.JsNewGuid(),projects:a}).subscribe((function(e){t.projectchange.emit(e.projects)}))})));break;case"cancel":this.projectchange.emit(void 0)}}},{key:"addcustomer",value:function(e){switch(this.selvisible=!0,this.customertype=e,e){case"delegate":this.selcustomer.seldata=this.delegates,this.selcustomer.setselect();break;case"pay":this.selcustomer.seldata=this.pays,this.selcustomer.setselect(!1);break;case"inspect":this.selcustomer.seldata=this.inspects,this.selcustomer.setselect(!1)}}},{key:"contactdisabled",set:function(e){this.currentcontactdisabled=e},get:function(){return this.currentcontactdisabled}},{key:"formInvalid",get:function(){var e,t,a;return this.invalidinfo="",null!=this.delegates&&0==this.delegates.length?(this.invalidinfo="\u5ba2\u6237\u4e0d\u80fd\u4e3a\u7a7a",!0):null!=this.invalidcollectionfee&&null!=this.invalidcollectionfee.value&&isNaN(this.invalidcollectionfee.value)?(this.invalidinfo="\u91c7\u6837\u8d39\u4e0d\u662f\u6570\u5b57",!0):null!=this.invalidbusinessfee&&null!=this.invalidbusinessfee.value&&isNaN(this.invalidbusinessfee.value)?(this.invalidinfo="\u4e1a\u52a1\u8d39\u4e0d\u662f\u6570\u5b57",!0):null==this.invalidreportcount||null==this.invalidreportcount.value||/^[0-9]{1,10}$/.test(this.invalidreportcount.value)?null!=this.invalidexternfee&&null!=this.invalidexternfee.value&&isNaN(this.invalidexternfee.value)?(this.invalidinfo="\u5916\u5305\u8d39\u4e0d\u662f\u6570\u5b57",!0):null!=this.sampledata&&null!=(null===(e=this.sampledata)||void 0===e?void 0:e.sampledata)&&0==(null===(a=null===(t=this.sampledata)||void 0===t?void 0:t.sampledata)||void 0===a?void 0:a.length)&&(this.invalidinfo="\u6837\u54c1\u4e0d\u80fd\u4e3a\u7a7a",!0):(this.invalidinfo="\u62a5\u544a\u4efd\u6570\u4e0d\u662f\u6570\u5b57",!0)}},{key:"disabled",get:function(){return"info"==this.type}}]),e}()).\u0275fac=function(e){return new(e||Ce)(o.Ib(f.b),o.Ib(f.c),o.Ib(f.a),o.Ib(f.d),o.Ib(j.d),o.Ib(v.c))},Ce.\u0275cmp=o.Cb({type:Ce,selectors:[["app-addbusinessproject"]],viewQuery:function(e,t){var a;1&e&&(o.Bc(de,!0),o.Bc(be,!0),o.Bc(he,!0),o.Bc(pe,!0),o.Bc(me,!0),o.Bc(fe,!0)),2&e&&(o.ic(a=o.Wb())&&(t.selcustomer=a.first),o.ic(a=o.Wb())&&(t.sampledata=a.first),o.ic(a=o.Wb())&&(t.invalidcollectionfee=a.first),o.ic(a=o.Wb())&&(t.invalidbusinessfee=a.first),o.ic(a=o.Wb())&&(t.invalidreportcount=a.first),o.ic(a=o.Wb())&&(t.invalidexternfee=a.first))},inputs:{currentproject:"currentproject"},outputs:{projectchange:"projectchange"},decls:89,vars:37,consts:[["width","50%","height","30%","placement","top",3,"visible","visibleChange","confirm"],["Seldialog",""],[2,"width","100%","height","100%",3,"customeradaption","hidebutton"],["selcustomer",""],[1,"au-inner","au-column"],["id","displaytag","style","color: crimson;font-size: 10pt;",4,"ngIf"],["plain","","icon","fto-plus","size","small",2,"flex","1",3,"disabled","click"],[1,"row"],["type","info","style","flex:1;","closable","",3,"disabled","close",4,"ngFor","ngForOf"],["plain","","size","small","icon","fto-plus",2,"flex","1",3,"disabled","click"],[2,"height","20px"],["span","2"],["span","7"],[3,"disabled","data","ngModel","ngModelChange"],["span","5"],["span","2",1,"x-radio-label"],["span","4"],["span","1",1,"x-radio-label"],[3,"disabled","ngModel","ngModelChange"],["invalidcollectionfee",""],["invalidbusinessfee",""],["invalidexternfee",""],["span","1"],["invalidreportcount",""],[2,"height","30px"],["sampledata",""],[2,"width","90%"],[2,"width","5%"],["plain","","icon","fto-chevron-left",3,"click"],["icon","fto-save","type","primary","plain","",3,"disabled","click"],["id","displaytag",2,"color","crimson","font-size","10pt"],["type","info","closable","",2,"flex","1",3,"disabled","close"]],template:function(e,t){1&e&&(o.Ob(0,"x-dialog",0,1),o.Vb("visibleChange",(function(e){return t.selvisible=e}))("confirm",(function(){return t.selconfirm()})),o.Jb(2,"app-customer",2,3),o.Nb(),o.Ob(4,"x-inner",4),o.uc(5,ge,2,1,"div",5),o.Ob(6,"x-row"),o.Ob(7,"table"),o.Ob(8,"tr"),o.Ob(9,"td"),o.Ob(10,"x-button",6),o.Vb("click",(function(){return!t.contactdisabled&&!t.disabled&&t.addcustomer("delegate")})),o.wc(11,"\u6dfb\u52a0\u59d4\u6258\u5ba2\u6237"),o.Nb(),o.Nb(),o.Ob(12,"td"),o.Ob(13,"div",7),o.uc(14,ve,2,2,"x-tag",8),o.Nb(),o.Nb(),o.Ob(15,"td"),o.Ob(16,"x-button",6),o.Vb("click",(function(){return!t.contactdisabled&&!t.disabled&&t.addcustomer("pay")})),o.wc(17,"\u6dfb\u52a0\u4ed8\u6b3e\u5355\u4f4d"),o.Nb(),o.Nb(),o.Ob(18,"td"),o.uc(19,Ee,2,2,"x-tag",8),o.Nb(),o.Ob(20,"td"),o.Ob(21,"x-button",9),o.Vb("click",(function(){return!t.contactdisabled&&!t.disabled&&t.addcustomer("inspect")})),o.wc(22,"\u6dfb\u52a0\u53d7\u68c0\u5355\u4f4d"),o.Nb(),o.Nb(),o.Ob(23,"td"),o.uc(24,Oe,2,2,"x-tag",8),o.Nb(),o.Nb(),o.Nb(),o.Nb(),o.Jb(25,"x-row",10),o.Ob(26,"x-row"),o.Ob(27,"x-col",11),o.wc(28,"\u6837\u54c1\u6765\u6e90"),o.Nb(),o.Ob(29,"x-col",12),o.Ob(30,"x-radio",13),o.Vb("ngModelChange",(function(e){return t.samplesource=e})),o.Nb(),o.Nb(),o.Ob(31,"x-col",11),o.wc(32,"\u662f\u5426\u5224\u5b9a"),o.Nb(),o.Ob(33,"x-col",14),o.Ob(34,"x-radio",13),o.Vb("ngModelChange",(function(e){return t.currentcontact.isjudgement=e})),o.Nb(),o.Nb(),o.Ob(35,"x-col",11),o.wc(36,"\u662f\u5426\u5916\u5305"),o.Nb(),o.Ob(37,"x-col",14),o.Ob(38,"x-radio",13),o.Vb("ngModelChange",(function(e){return t.currentcontact.isextern=e})),o.Nb(),o.Nb(),o.Nb(),o.Jb(39,"x-row",10),o.Ob(40,"x-row"),o.Ob(41,"x-col",11),o.wc(42,"\u8d44\u8d28\u76d6\u7ae0"),o.Nb(),o.Ob(43,"x-col",12),o.Ob(44,"x-checkbox",13),o.Vb("ngModelChange",(function(e){return t.seal=e})),o.Nb(),o.Nb(),o.Ob(45,"x-col",11),o.wc(46,"\u670d\u52a1\u7c7b\u578b"),o.Nb(),o.Ob(47,"x-col",14),o.Ob(48,"x-radio",13),o.Vb("ngModelChange",(function(e){return t.servicetype=e})),o.Nb(),o.Nb(),o.Nb(),o.Jb(49,"x-row",10),o.Ob(50,"x-row"),o.Ob(51,"x-col",15),o.wc(52,"\u62a5\u544a\u5f62\u5f0f"),o.Nb(),o.Ob(53,"x-col",16),o.Ob(54,"x-radio",13),o.Vb("ngModelChange",(function(e){return t.currentproject.mergereport=e})),o.Nb(),o.Nb(),o.Ob(55,"x-col",17),o.wc(56,"\u91c7\u6837\u8d39"),o.Nb(),o.Ob(57,"x-col",11),o.Ob(58,"x-input",18,19),o.Vb("ngModelChange",(function(e){return t.currentcontact.collectionfee=e})),o.Nb(),o.Nb(),o.Ob(60,"x-col",17),o.wc(61,"\u4e1a\u52a1\u8d39"),o.Nb(),o.Ob(62,"x-col",11),o.Ob(63,"x-input",18,20),o.Vb("ngModelChange",(function(e){return t.currentcontact.businessfee=e})),o.Nb(),o.Nb(),o.Ob(65,"x-col",17),o.wc(66,"\u5916\u5305\u8d39"),o.Nb(),o.Ob(67,"x-col",11),o.Ob(68,"x-input",18,21),o.Vb("ngModelChange",(function(e){return t.currentcontact.externfee=e})),o.Nb(),o.Nb(),o.Ob(70,"x-col",11),o.wc(71,"\u62a5\u544a\u4efd\u6570"),o.Nb(),o.Ob(72,"x-col",22),o.Ob(73,"x-input",18,23),o.Vb("ngModelChange",(function(e){return t.currentproject.reportcount=e})),o.Nb(),o.Nb(),o.Nb(),o.Jb(75,"x-row",24),o.Ob(76,"x-row"),o.Jb(77,"app-sample",null,25),o.Nb(),o.Ob(79,"x-row"),o.Ob(80,"table"),o.Ob(81,"tr"),o.Jb(82,"td",26),o.Ob(83,"td",27),o.Ob(84,"x-button",28),o.Vb("click",(function(){return t.action("cancel")})),o.wc(85,"\u8fd4\u56de"),o.Nb(),o.Nb(),o.Ob(86,"td",27),o.Ob(87,"x-button",29),o.Vb("click",(function(){return!t.disabled&&!t.formInvalid&&t.action("save")})),o.wc(88," \u4fdd\u5b58 "),o.Nb(),o.Nb(),o.Nb(),o.Nb(),o.Nb(),o.Nb()),2&e&&(o.ec("visible",t.selvisible),o.yb(2),o.ec("customeradaption",t.customeradaption)("hidebutton",t.hidebutton),o.yb(3),o.ec("ngIf",t.showTableBoolean),o.yb(5),o.ec("disabled",t.disabled||t.contactdisabled),o.yb(4),o.ec("ngForOf",t.delegates),o.yb(2),o.ec("disabled",t.disabled||t.contactdisabled),o.yb(3),o.ec("ngForOf",t.pays),o.yb(2),o.ec("disabled",t.disabled||t.contactdisabled),o.yb(3),o.ec("ngForOf",t.inspects),o.yb(6),o.ec("disabled",t.disabled||t.contactdisabled)("data",t.samplesourcedata)("ngModel",t.samplesource),o.yb(4),o.ec("disabled",t.disabled||t.contactdisabled)("data",t.judgedata)("ngModel",t.currentcontact.isjudgement),o.yb(4),o.ec("disabled",t.disabled||t.contactdisabled)("data",t.externdata)("ngModel",t.currentcontact.isextern),o.yb(6),o.ec("disabled",t.disabled||t.contactdisabled)("data",t.sealdata)("ngModel",t.seal),o.yb(4),o.ec("disabled",t.disabled||t.contactdisabled)("data",t.servicetypedata)("ngModel",t.servicetype),o.yb(6),o.ec("disabled",t.disabled)("data",t.multiplereportdata)("ngModel",t.currentproject.mergereport),o.yb(4),o.ec("disabled",t.disabled||t.contactdisabled)("ngModel",t.currentcontact.collectionfee),o.yb(5),o.ec("disabled",t.disabled||t.contactdisabled)("ngModel",t.currentcontact.businessfee),o.yb(5),o.ec("disabled",t.disabled||t.contactdisabled)("ngModel",t.currentcontact.externfee),o.yb(5),o.ec("disabled",t.disabled)("ngModel",t.currentproject.reportcount),o.yb(14),o.ec("disabled",t.formInvalid||t.disabled))},directives:[J.a,Z,K.a,le.t,E.c,O.a,le.s,E.a,_e.a,ue.q,ue.t,se.a,G.a,re,oe.a],styles:[""]}),Ce),Pe=["projectlist"],ye=["addbusiness"];function De(e,t){if(1&e){var a=o.Pb();o.Ob(0,"div",10),o.Ob(1,"x-link",11),o.Vb("click",(function(){o.lc(a);var e=t.$row,i=o.Yb();return i.auth.info&&i.action("info",e)})),o.Nb(),o.Ob(2,"x-link",12),o.Vb("click",(function(){o.lc(a);var e=t.$row,i=o.Yb();return!i.disabled(e)&&i.auth.edit&&i.action("edit",e)})),o.Nb(),o.Ob(3,"x-link",13),o.Vb("click",(function(){o.lc(a);var e=t.$row,i=o.Yb();return!i.disabled(e)&&i.auth.delete&&i.action("delete",e)})),o.Nb(),o.Nb()}if(2&e){var i=t.$row,n=o.Yb();o.yb(1),o.ec("disabled",!n.auth.info),o.yb(1),o.ec("disabled",!n.auth.edit||n.disabled(i)),o.yb(1),o.ec("disabled",!n.auth.delete||n.disabled(i))}}var xe,we,Ie,ke,Be=function(e){return{actions:e}},je=((xe=function(e){_inherits(a,e);var t=_createSuper(a);function a(e,i,n,c){var r;return _classCallCheck(this,a),(r=t.call(this,e)).indexService=e,r.service=i,r.msgBox=n,r.msg=c,r.ProjectsChange=new o.n,r.type="add",r.visible=!1,r.columns=[{id:"actions",label:"\u64cd\u4f5c",width:100},{id:"projectnumber",label:"\u9879\u76ee\u7f16\u53f7",width:150,sort:!0},{id:"domainlabel",label:"\u9886\u57df",width:150,sort:!0}],r.size=20,r.index=1,r.query={filter:[]},r.total=0,r.activeprojectid="",r.currentproject={mergereport:1,reportcount:2},r.contactdisabled=!1,r.auth={},r}return _createClass(a,[{key:"ngOnInit",value:function(){}},{key:"setproject",value:function(e){var t;null!=e&&(e.domainlabel=null===(t=e.domain)||void 0===t?void 0:t.label)}},{key:"projectchange",value:function(e){var t=this;if(this.visible=!1,null!=e){var a=e.findIndex((function(e){return e.id==t.currentproject.id})),i=this.data.findIndex((function(e){return e.id==t.currentproject.id}));-1==a&&-1!=i&&this.data.splice(i,1);for(var n=0;n<e.length;n++){this.setproject(e[n]);var c=this.data.findIndex((function(t){return t.id==e[n].id}));-1==c?this.data.push(e[n]):this.data.splice(c,1,e[n])}this.data=_toConsumableArray(this.data),null!=this.ProjectsChange&&this.ProjectsChange.emit(this.data)}}},{key:"copayaction",value:function(e){var t=this;if(null!=this.projectlist.activatedRow){var a=b.a.deepClone(this.currentproject);console.log(a),a.id=b.a.JsNewGuid(),a.projectstatus=0,a.samples.map((function(e){e.projectid=a.id,e.id=b.a.JsNewGuid(),e.testprojects.map((function(t){t.sampleid=e.id}))})),a.projectnumber=a.projectnumber+"\u590d\u4ef6",this.service.post({id:b.a.JsNewGuid(),projects:[a]}).subscribe((function(e){t.data.push(a),t.data=_toConsumableArray(t.data),t.projectlist.activatedRow=a,t.currentproject=a,null!=t.ProjectsChange&&t.ProjectsChange.emit(t.data)}))}}},{key:"activechange",value:function(e){this.currentproject=e}},{key:"getproject",value:function(){var e=b.a.JsNewGuid();return{contactid:this.currentcontact.id+"",id:e,projectnumber:"\u4e34\u65f6\u9879\u76ee",reportcount:2,domain:{id:1},mergereport:0,samples:[]}}},{key:"setswitch",value:function(e,t){this.visible=!0,this.addbusiness.type=e,this.addbusiness.currentproject=t,this.currentproject=t,this.addbusiness.currentcontact=this.currentcontact,this.addbusiness.setinit(this.data.length)}},{key:"action",value:function(e,t){var a=this;switch(this.addbusiness.contactdisabled=!1,this.contactdisabled=!1,e){case"add":null!=this.currentcontact&&null!=this.currentcontact.id&&(this.data.length>0&&(this.addbusiness.contactdisabled=!0,this.contactdisabled=!0),this.setswitch(e,this.getproject()));break;case"info":t.mergereport=0,this.setswitch(e,t);break;case"edit":t.mergereport=0,this.data.findIndex((function(e){return e.id==t.id}))>0&&(this.addbusiness.contactdisabled=!0,this.contactdisabled=!0),this.setswitch(e,t);break;case"delete":this.msgBox.confirm({title:"\u63d0\u793a",content:"\u6b64\u64cd\u4f5c\u5c06\u6c38\u4e45\u5220\u9664\u6b64\u6761\u6570\u636e\uff1a".concat(t.id,"\uff0c\u662f\u5426\u7ee7\u7eed\uff1f"),type:"warning",callback:function(e){"confirm"===e&&a.service.delete(t.id).subscribe((function(e){var i=a.data.findIndex((function(e){return e.id==t.id}));-1!=i&&(a.data.splice(i,1),a.msg.success("\u5220\u9664\u6210\u529f"),a.data=_toConsumableArray(a.data),0!=i?a.projectlist.activatedRow=a.data[i-1]:0==i&&a.data.length>0&&(a.projectlist.activatedRow=a.data[0]))}))}})}}},{key:"disabled",value:function(e){return!(null==e||!e.submit)}},{key:"IndexChange",value:function(e){}},{key:"getdata",value:function(){var e=this;this.data=[],this.currentproject={},this.projectlist.activatedRow=void 0,this.total=0,null!=this.currentcontact&&null!=this.currentcontact.id&&(this.query={filter:[{field:"contactid",value:this.currentcontact.id+"",operation:"="}]},this.service.getList(this.index,this.size,this.query).subscribe((function(t){var a;if(a=[t.list,Number(t.total)],e.data=a[0],e.total=a[1],e.data.map((function(t){e.setproject(t)})),""!=e.activeprojectid){var i=e.data.findIndex((function(t){return t.id==e.activeprojectid}));e.currentproject=-1!=i?e.data[i]:e.data[0]}else e.data.length>0&&(e.currentproject=e.data[0]);e.projectlist.activatedRow=e.currentproject})))}}]),a}(u.a)).\u0275fac=function(e){return new(e||xe)(o.Ib(_.a),o.Ib(f.a),o.Ib(g.c),o.Ib(v.c))},xe.\u0275cmp=o.Cb({type:xe,selectors:[["app-businessproject"]],viewQuery:function(e,t){var a;1&e&&(o.Bc(Pe,!0),o.Bc(ye,!0)),2&e&&(o.ic(a=o.Wb())&&(t.projectlist=a.first),o.ic(a=o.Wb())&&(t.addbusiness=a.first))},inputs:{auth:"auth"},outputs:{ProjectsChange:"ProjectsChange"},features:[o.vb],decls:17,vars:18,consts:[["width","70%","height","80%","placement","top",3,"visible","showConfirm","showCancel","backdropClose","hasBackdrop","visibleChange"],["dialogcustomer",""],[2,"width","100%","height","100%",3,"currentproject","projectchange"],["addbusiness",""],["span","6"],["icon","fto-plus","plain","",3,"disabled","click"],["span","5"],["virtualScroll","","loading","",3,"data","columns","index","size","total","query","adaptionHeight","bodyColumnTpl","indexChange","sizeChange","activatedRowChange"],["projectlist",""],["contactTpl",""],[1,"au-table-actions"],["icon","fto-eye","title","\u67e5\u770b",3,"disabled","click"],["icon","fto-edit","title","\u4fee\u6539",3,"disabled","click"],["icon","fto-trash-2","title","\u5220\u9664",3,"disabled","click"]],template:function(e,t){if(1&e&&(o.Ob(0,"x-dialog",0,1),o.Vb("visibleChange",(function(e){return t.visible=e})),o.Ob(2,"app-addbusinessproject",2,3),o.Vb("projectchange",(function(e){return t.projectchange(e)})),o.Nb(),o.Nb(),o.Ob(4,"x-row"),o.Ob(5,"x-col",4),o.Ob(6,"x-button",5),o.Vb("click",(function(){return t.auth.add&&t.action("add")})),o.wc(7," \u65b0\u589e "),o.Nb(),o.Nb(),o.Ob(8,"x-col",6),o.Ob(9,"x-button",5),o.Vb("click",(function(){return t.auth.add&&t.copayaction("add")})),o.wc(10," \u590d\u5236\u65b0\u589e "),o.Nb(),o.Nb(),o.Nb(),o.Ob(11,"x-row"),o.Ob(12,"x-col"),o.Ob(13,"x-table",7,8),o.Vb("indexChange",(function(e){return t.index=e}))("sizeChange",(function(e){return t.size=e}))("activatedRowChange",(function(e){return t.activechange(e)}))("indexChange",(function(e){return t.IndexChange(e)})),o.Nb(),o.Nb(),o.Nb(),o.uc(15,De,4,3,"ng-template",null,9,o.vc)),2&e){var a=o.jc(16);o.ec("visible",t.visible)("showConfirm",!1)("showCancel",!1)("backdropClose",!1)("hasBackdrop",!1),o.yb(2),o.ec("currentproject",t.currentproject),o.yb(4),o.ec("disabled",!t.auth.add),o.yb(3),o.ec("disabled",!t.auth.add),o.yb(4),o.ec("data",t.data)("columns",t.columns)("index",t.index)("size",t.size)("total",t.total)("query",t.query)("adaptionHeight",124)("bodyColumnTpl",o.gc(16,Be,a))}},directives:[J.a,Me,E.c,E.a,O.a,C.a,M.a],styles:[""]}),xe),Ae=["contactlist"],Te=["businessprojectlist"],Re=["customerlist"],We=[{path:"",component:(we=function(e){_inherits(a,e);var t=_createSuper(a);function a(e,i,n,c){var r;return _classCallCheck(this,a),(r=t.call(this,e)).indexService=e,r.contactService=i,r.activatedRoute=n,r.flowservice=c,r.collectionform=[{id:1,label:"\u91c7\u6837"},{id:2,label:"\u9001\u6837"},{id:3,label:"\u90ae\u5bc4"}],r.collectionmodel=1,r.weituomodel=1,r.standprice=2300.45,r.discountprice=1800.97,r.styleset="display:none",r.showTableBoolean=!1,r.showTableBooleancon=!1,r.showTableBooleanpr=!1,r.taskprojectid="",r.taskcustomerid=0,r.taskcontactid="",r.activatedRoute.params.subscribe((function(e){null!=e.projectid?r.flowservice.getcontactbyproject(e.contactid).subscribe((function(e){r.taskprojectid=e.projectid,r.taskcustomerid=e.customerid,r.taskcontactid=e.contactid})):r.taskcustomerid=-1})),r}return _createClass(a,[{key:"changeCustomer",value:function(e){null!=this.taskcustomerid&&-1!=this.taskcustomerid&&this.customerlist.setActive(this.taskcustomerid),this.contactlist.activeid="",-1!=this.taskcustomerid&&(this.contactlist.activeid=this.taskcontactid),this.contactlist.customer=this.customerlist.currentCustomer,this.contactlist.getcontactdata(!0)}},{key:"contactChange",value:function(e){var t;if(0==this.contactlist.contactdata.length)this.businessprojectlist.currentcontact={},this.businessprojectlist.currentproject={};else{var a=null===(t=e.contactcustomers)||void 0===t?void 0:t.findIndex((function(e){return null!=e.customertype&&1==e.customertype}));console.log(e),-1!=a&&null!=a||(console.log("32"),e.contactcustomers=[{contactid:e.id+"",customername:this.contactlist.customer.customername,customerid:this.contactlist.customer.id,customertype:1},{contactid:e.id+"",customername:this.contactlist.customer.customername,customerid:this.contactlist.customer.id,customertype:2},{contactid:e.id+"",customername:this.contactlist.customer.customername,customerid:this.contactlist.customer.id,customertype:3}],e.isjudgement=0,e.judgement="",e.judgementstandard="",e.service={id:1},e.samplesource={id:1},e.seal=[{id:1}],e.collectionfee=0,e.externfee=0,e.businessfee=0),this.businessprojectlist.currentcontact=e}this.businessprojectlist.getdata(),null!=this.taskprojectid&&""!=this.taskprojectid&&(this.businessprojectlist.activeprojectid=this.taskprojectid)}},{key:"setdis",value:function(){this.styleset="display:inline"}},{key:"ProjectsChange",value:function(e){var t,a,i,n=this;this.contactlist.currentContact.testfee=0,this.contactlist.currentContact.standardfee=0;var c=0;e.map((function(e){var t;c+=50*(Number(e.reportcount)-2),null===(t=e.samples)||void 0===t||t.map((function(e){n.contactlist.currentContact.testfee=Number(n.contactlist.currentContact.testfee)+Number(e.price),n.contactlist.currentContact.standardfee=Number(n.contactlist.currentContact.standardfee)+Number(e.standardfee)}))})),2==(null===(t=this.contactlist.currentContact.service)||void 0===t?void 0:t.id)&&(this.contactlist.currentContact.standardfee=2*Number(this.contactlist.currentContact.standardfee)),3==(null===(a=this.contactlist.currentContact.service)||void 0===a?void 0:a.id)&&(this.contactlist.currentContact.standardfee=1.5*Number(this.contactlist.currentContact.standardfee)),0!=this.contactlist.currentContact.standardfee&&(this.contactlist.currentContact.discount=Object(s.round)(Number(this.contactlist.currentContact.testfee)/Number(this.contactlist.currentContact.standardfee)*100)/100),this.contactlist.currentContact.totalfee=Object(s.round)(100*(Number(this.contactlist.currentContact.testfee)+Number(this.contactlist.currentContact.businessfee)+Number(this.contactlist.currentContact.collectionfee)+c+Number(this.contactlist.currentContact.externfee)))/100,this.contactlist.currentContact.ugency=null===(i=this.contactlist.currentContact.service)||void 0===i?void 0:i.label,this.businessprojectlist.contactdisabled||this.contactService.updatecontactinfo(this.contactlist.currentContact).subscribe((function(e){return console.log(e)})),this.contactlist.refreshdata()}},{key:"ngDoCheck",value:function(){}},{key:"setweituodanname",value:function(){}},{key:"ngAfterContentInit",value:function(){}},{key:"ngOnInit",value:function(){var e=this;setTimeout((function(){e.showTableBoolean=!0}),0),setTimeout((function(){e.showTableBooleancon=!0}),0),setTimeout((function(){e.showTableBooleanpr=!0}),0)}}]),a}(u.a),we.\u0275fac=function(e){return new(e||we)(o.Ib(_.a),o.Ib(d.a),o.Ib(n.a),o.Ib(p.a))},we.\u0275cmp=o.Cb({type:we,selectors:[["app-evirmentheath"]],viewQuery:function(e,t){var a;1&e&&(o.Bc(Ae,!0),o.Bc(Te,!0),o.Bc(Re,!0)),2&e&&(o.ic(a=o.Wb())&&(t.contactlist=a.first),o.ic(a=o.Wb())&&(t.businessprojectlist=a.first),o.ic(a=o.Wb())&&(t.customerlist=a.first))},features:[o.xb([l]),o.vb],decls:23,vars:5,consts:[["span","16"],["au-adaption","",1,"au-panel","au-content",3,"outerHeight"],[2,"text-align","center","font-weight","bolder","font-size","12pt"],[3,"auth","ChangeCustomer"],["customerlist",""],[3,"auth","contactChange"],["contactlist",""],["span","8"],[3,"auth","ProjectsChange"],["businessprojectlist",""]],template:function(e,t){1&e&&(o.Ob(0,"x-row"),o.Ob(1,"x-col",0),o.Ob(2,"div",1),o.Ob(3,"x-row"),o.Ob(4,"x-col",2),o.wc(5,"\u5ba2\u6237\u4fe1\u606f"),o.Nb(),o.Nb(),o.Ob(6,"x-row"),o.Ob(7,"app-customer",3,4),o.Vb("ChangeCustomer",(function(e){return t.changeCustomer(e)})),o.Nb(),o.Nb(),o.Ob(9,"x-row"),o.Ob(10,"x-col",2),o.wc(11," \u5ba2\u6237\u5408\u540c\u5217\u8868 "),o.Nb(),o.Nb(),o.Ob(12,"x-row"),o.Ob(13,"app-contact",5,6),o.Vb("contactChange",(function(e){return t.contactChange(e)})),o.Nb(),o.Nb(),o.Nb(),o.Nb(),o.Ob(15,"x-col",7),o.Ob(16,"div",1),o.Ob(17,"x-row"),o.Ob(18,"x-col",2),o.wc(19," \u59d4\u6258\u5355\u57fa\u672c\u4fe1\u606f "),o.Nb(),o.Nb(),o.Ob(20,"x-row"),o.Ob(21,"app-businessproject",8,9),o.Vb("ProjectsChange",(function(e){return t.ProjectsChange(e)})),o.Nb(),o.Nb(),o.Nb(),o.Nb(),o.Nb()),2&e&&(o.yb(2),o.ec("outerHeight",0),o.yb(5),o.ec("auth",t.auth),o.yb(6),o.ec("auth",t.auth),o.yb(3),o.ec("outerHeight",0),o.yb(5),o.ec("auth",t.auth))},directives:[E.c,E.a,q.a,Z,B,je],encapsulation:2}),we)}],Le=((Ie=function e(){_classCallCheck(this,e)}).\u0275mod=o.Gb({type:Ie}),Ie.\u0275inj=o.Fb({factory:function(e){return new(e||Ie)},imports:[[n.i.forChild(We)],n.i]}),Ie),Ne=a("gjGi"),Ke=a("hHlV"),Ue=a("873N"),qe=a("iaau"),Ve=a("Z77y"),ze=a("oJeN"),Se=a("aMyR"),Je=((ke=function e(){_classCallCheck(this,e)}).\u0275mod=o.Gb({type:ke}),ke.\u0275inj=o.Fb({factory:function(e){return new(e||ke)},imports:[[le.c,Le,Se.a,Ke.a,ze.b,O.b,G.b,se.b,Ne.a,qe.a,C.b,G.b,Ue.a,_e.b,Ve.b,J.b,oe.b]]}),ke)}}])})();
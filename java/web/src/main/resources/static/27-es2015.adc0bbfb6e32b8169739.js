(window.webpackJsonp=window.webpackJsonp||[]).push([[27],{bwiJ:function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"a",(function(){return AddsampleComponent}));var _angular_core__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("fXoL"),src_services_sample_service__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("GTjD"),src_main_qualification_qualification_service__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("M3sX"),src_share_utilclass__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("BzWU"),_businessproject_businessproject_service__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("x2e1"),src_main_qualification_qualification_component__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__("OROO"),_ng_nest_ui__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__("qMpK"),_ng_nest_ui__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__("l5Yv"),_ng_nest_ui__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__("SfH5"),_ng_nest_ui__WEBPACK_IMPORTED_MODULE_9__=__webpack_require__("GvSL"),_ng_nest_ui__WEBPACK_IMPORTED_MODULE_10__=__webpack_require__("P0lq"),_ng_nest_ui__WEBPACK_IMPORTED_MODULE_11__=__webpack_require__("oJeN"),_ng_nest_ui_inner__WEBPACK_IMPORTED_MODULE_12__=__webpack_require__("1uEr"),_angular_forms__WEBPACK_IMPORTED_MODULE_13__=__webpack_require__("3Pt+"),_ng_nest_ui_table__WEBPACK_IMPORTED_MODULE_14__=__webpack_require__("yO6f"),_ng_nest_ui_link__WEBPACK_IMPORTED_MODULE_15__=__webpack_require__("kXfN");const _c0=["inputsamplename"],_c1=["inputsamplequality"],_c2=["inputsampleprice"],_c3=["inputexternice"],_c4=["selqual"],_c5=["externselqual"];function AddsampleComponent_ng_template_63_Template(t,e){if(1&t){const t=_angular_core__WEBPACK_IMPORTED_MODULE_0__.Pb();_angular_core__WEBPACK_IMPORTED_MODULE_0__.Ob(0,"div",35),_angular_core__WEBPACK_IMPORTED_MODULE_0__.Ob(1,"x-link",36),_angular_core__WEBPACK_IMPORTED_MODULE_0__.Vb("click",(function(){_angular_core__WEBPACK_IMPORTED_MODULE_0__.lc(t);const i=e.$row,a=_angular_core__WEBPACK_IMPORTED_MODULE_0__.Yb();return!a.disabled&&!a.methodInvalid&&a.projectaction("delete",i)})),_angular_core__WEBPACK_IMPORTED_MODULE_0__.Nb(),_angular_core__WEBPACK_IMPORTED_MODULE_0__.Nb()}if(2&t){const t=_angular_core__WEBPACK_IMPORTED_MODULE_0__.Yb();_angular_core__WEBPACK_IMPORTED_MODULE_0__.yb(1),_angular_core__WEBPACK_IMPORTED_MODULE_0__.ec("disabled",t.formInvalid||t.disabled)}}function AddsampleComponent_ng_template_65_Template(t,e){if(1&t){const t=_angular_core__WEBPACK_IMPORTED_MODULE_0__.Pb();_angular_core__WEBPACK_IMPORTED_MODULE_0__.Ob(0,"div",35),_angular_core__WEBPACK_IMPORTED_MODULE_0__.Ob(1,"x-link",36),_angular_core__WEBPACK_IMPORTED_MODULE_0__.Vb("click",(function(){_angular_core__WEBPACK_IMPORTED_MODULE_0__.lc(t);const i=e.$row,a=_angular_core__WEBPACK_IMPORTED_MODULE_0__.Yb();return!a.disabled&&!a.methodInvalid&&a.externprojectaction("delete",i)})),_angular_core__WEBPACK_IMPORTED_MODULE_0__.Nb(),_angular_core__WEBPACK_IMPORTED_MODULE_0__.Nb()}if(2&t){const t=_angular_core__WEBPACK_IMPORTED_MODULE_0__.Yb();_angular_core__WEBPACK_IMPORTED_MODULE_0__.yb(1),_angular_core__WEBPACK_IMPORTED_MODULE_0__.ec("disabled",t.formInvalid||t.disabled)}}const _c6=function(t){return{actions:t}};let AddsampleComponent=(()=>{class AddsampleComponent{constructor(t,e,i,a){this.service=t,this.commonservice=e,this.message=i,this.domainservice=a,this.currentcontact={},this.sendaddsample=new _angular_core__WEBPACK_IMPORTED_MODULE_0__.n,this.qualitreeheight="300px",this.producthidden="inline",this.invalidstring="",this.projectdata=[],this.projecttotal=0,this.projectsize=20,this.projectindex=1,this.projectquery={filter:[]},this.projectcolumns=[{id:"actions",label:"\u64cd\u4f5c",width:80},{id:"testproject",label:"\u9879\u76ee",width:200,sort:!0},{id:"standardname",label:"\u68c0\u6d4b\u6807\u51c6",width:200,sort:!0},{id:"price",label:"\u6807\u51c6\u4ef7\u683c",width:200,sort:!0},{id:"realprice",label:"\u5b9e\u9645\u4ef7\u683c",width:200,sort:!0}],this.externprojectcolumns=[{id:"actions",label:"\u64cd\u4f5c",width:80},{id:"testproject",label:"\u68c0\u6d4b\u9879\u76ee",width:200,sort:!0}],this.process=[],this.processid=1,this.externprojectdata=[],this.qexternvisible=!1,this.externtotal=0,this.externprojecttotal=0,this.externprojectsize=20,this.externprojectindex=1,this.externprojectquery={filter:[]},this.qvisible=!1,this.samplemethod=[],this.showTableBoolean=!1,this.showdivBoolean=!1}quaconfirm(){for(var _a,tempdata=[],i=0;i<this.qualificationcomponent.selquali.length;i++)tempdata.push({id:src_share_utilclass__WEBPACK_IMPORTED_MODULE_3__.a.JsNewGuid(),sampleid:(null===(_a=this.currentsample)||void 0===_a?void 0:_a.id)+"",qualificationid:this.qualificationcomponent.selquali[i].id+"",testproject:this.qualificationcomponent.selquali[i].testproject,methodname:this.qualificationcomponent.selquali[i].methodname,price:this.qualificationcomponent.selquali[i].price,realprice:this.qualificationcomponent.selquali[i].price,testcount:this.qualificationcomponent.selquali[i].testcount,isextern:0});this.service.getsamplestandardprice(tempdata).subscribe(x=>{this.projectdata=[],this.currentsample.standardfee=x.price,x.formulars.map(y=>{var formularprice=eval(y.formular),limitprice=0==y.limitprice?formularprice:y.limitprice;this.currentsample.standardfee=this.currentsample.standardfee+(formularprice<=limitprice?formularprice:limitprice)}),tempdata.map(t=>this.projectdata.push(t))})}get formInvalid(){return!!this.methodInvalid||0==this.projectdata.length&&(this.invalidstring="\u6837\u54c1\u68c0\u6d4b\u9879\u76ee\u4e3a\u7a7a!",!0)}get methodInvalid(){return this.invalidstring="",null==this.inputsamplename||null!=this.inputsamplename.value&&""!=this.inputsamplename.value?null==this.inputsamplequality||null!=this.inputsamplequality.value&&""!=this.inputsamplequality.value?null==this.inputsamplequality||null==this.inputsamplequality.value||/^[0-9]{1,10}$/.test(this.inputsamplequality.value)?null==this.inputsampleprice||null!=this.inputsampleprice.value&&""!=this.inputsampleprice.value?(null!=this.inputsampleprice&&null!=this.inputsampleprice.value&&isNaN(this.inputsampleprice.value)||!(null==this.inputexternice||null==this.inputexternice.value||!isNaN(this.inputexternice.value)))&&(this.invalidstring="\u6837\u54c1\u4ef7\u683c\u53ea\u80fd\u662f\u6570\u5b57!",!0):(this.invalidstring="\u6837\u54c1\u4ef7\u683c\u4e3a\u7a7a!",!0):(this.invalidstring="\u6837\u54c1\u6570\u91cf\u53ea\u80fd\u662f\u6570\u5b57!",!0):(this.invalidstring="\u6837\u54c1\u6570\u91cf\u4e3a\u7a7a!",!0):(this.invalidstring="\u6837\u54c1\u540d\u79f0\u4e3a\u7a7a!",!0)}getproject(){var t,e;this.projectdata=[],this.externprojectdata=[],this.processid=null!=this.currentsample.process?Number(null===(t=this.currentsample.process)||void 0===t?void 0:t.id):2,null===(e=this.currentsample.testprojects)||void 0===e||e.map(t=>{0==t.isextern?this.projectdata.push(t):1==t.isextern&&this.externprojectdata.push(t)}),this.projecttotal=Number(this.projectdata.length),this.externtotal=Number(this.externprojectdata.length),this.projectdata=[...this.projectdata],this.externprojectdata=[...this.externprojectdata]}get disabled(){return"info"===this.type}exterquaconfirm(){var t;this.externprojectdata=[];for(var e=0;e<this.externselqual.selquali.length;e++)this.externprojectdata.push({id:src_share_utilclass__WEBPACK_IMPORTED_MODULE_3__.a.JsNewGuid(),sampleid:(null===(t=this.currentsample)||void 0===t?void 0:t.id)+"",qualificationid:this.externselqual.selquali[e].id+"",testproject:this.externselqual.selquali[e].testproject,isextern:1});this.externtotal=this.externprojectdata.length}externprojectaction(t,e){switch(this.externselqual.getData(!0),t){case"add":"add"!=this.type&&"edit"!=this.type||(this.qexternvisible=!0),this.externselqual.selquali=[],this.externprojectdata.forEach(t=>{this.externselqual.selquali.push({id:Number(t.qualificationid),testproject:t.testproject,testcount:t.testcount})}),this.externselqual.refreshdata();break;case"delete":this.deleteprojectmethod((null==e?void 0:e.id)+"",this.externprojectdata),this.externprojectdata=[...this.externprojectdata]}}ngDoCheck(){}projectaction(t,e){switch(this.qualificationcomponent.getData(!1),t){case"add":"add"!=this.type&&"edit"!=this.type||(this.qvisible=!0),this.qualificationcomponent.selquali=[],this.projectdata.forEach(t=>{this.qualificationcomponent.selquali.push({id:Number(t.qualificationid),testproject:t.testproject,testcount:t.testcount})}),this.qualificationcomponent.refreshdata();break;case"delete":this.deleteprojectmethod((null==e?void 0:e.id)+"",this.projectdata),this.projectdata=[...this.projectdata]}}deleteprojectmethod(t,e){var i=null==e?void 0:e.findIndex(e=>e.id===t);null==e||e.splice(Number(i),1)}setcurrent(t,e){this.currentsample=e,this.type=t,this.action(t),this.getproject()}ngOnInit(){this.domainservice.getList(1,20,{}).subscribe(t=>{this.domaindata=t.list,this.currentsample.domainid=Number(this.domaindata[0].id)}),setTimeout(()=>{this.showTableBoolean=!0},3e3),setTimeout(()=>{this.showdivBoolean=!0},0),this.commonservice.getsampleprocess().subscribe(t=>{this.process=t.list})}ngAfterViewInit(){}setsavedata(){this.currentsample.testproject="",this.currentsample.methodname="",this.currentsample.testprojects=[];for(var t=this.projectdata.concat(this.externprojectdata),e=0;e<t.length;e++)this.currentsample.testproject+=t[e].testproject,this.currentsample.methodname+=t[e].standardname,e!=t.length-1&&(this.currentsample.testproject+=",",this.currentsample.methodname+=","),this.currentsample.testprojects.push(t[e]);var i=this.process.findIndex(t=>t.id==this.processid);-1!=i&&(this.currentsample.process=this.process[i])}action(t){if(null!=this.currentsample)switch(t){case"info":this.getproject();break;case"edit":this.action("info");break;case"save":this.setsavedata(),"add"===this.type?this.sendaddsample.emit("add"):"edit"===this.type&&this.sendaddsample.emit("edit");break;case"cancel":this.sendaddsample.emit("cancel")}this.qvisible=!1}}return AddsampleComponent.\u0275fac=function(t){return new(t||AddsampleComponent)(_angular_core__WEBPACK_IMPORTED_MODULE_0__.Ib(src_services_sample_service__WEBPACK_IMPORTED_MODULE_1__.a),_angular_core__WEBPACK_IMPORTED_MODULE_0__.Ib(_businessproject_businessproject_service__WEBPACK_IMPORTED_MODULE_4__.c),_angular_core__WEBPACK_IMPORTED_MODULE_0__.Ib(_ng_nest_ui__WEBPACK_IMPORTED_MODULE_6__.c),_angular_core__WEBPACK_IMPORTED_MODULE_0__.Ib(src_main_qualification_qualification_service__WEBPACK_IMPORTED_MODULE_2__.d))},AddsampleComponent.\u0275cmp=_angular_core__WEBPACK_IMPORTED_MODULE_0__.Cb({type:AddsampleComponent,selectors:[["app-addsample"]],viewQuery:function(t,e){var i;1&t&&(_angular_core__WEBPACK_IMPORTED_MODULE_0__.Bc(_c0,!0),_angular_core__WEBPACK_IMPORTED_MODULE_0__.Bc(_c1,!0),_angular_core__WEBPACK_IMPORTED_MODULE_0__.Bc(_c2,!0),_angular_core__WEBPACK_IMPORTED_MODULE_0__.Bc(_c3,!0),_angular_core__WEBPACK_IMPORTED_MODULE_0__.Bc(_c4,!0),_angular_core__WEBPACK_IMPORTED_MODULE_0__.Bc(_c5,!0)),2&t&&(_angular_core__WEBPACK_IMPORTED_MODULE_0__.ic(i=_angular_core__WEBPACK_IMPORTED_MODULE_0__.Wb())&&(e.inputsamplename=i.first),_angular_core__WEBPACK_IMPORTED_MODULE_0__.ic(i=_angular_core__WEBPACK_IMPORTED_MODULE_0__.Wb())&&(e.inputsamplequality=i.first),_angular_core__WEBPACK_IMPORTED_MODULE_0__.ic(i=_angular_core__WEBPACK_IMPORTED_MODULE_0__.Wb())&&(e.inputsampleprice=i.first),_angular_core__WEBPACK_IMPORTED_MODULE_0__.ic(i=_angular_core__WEBPACK_IMPORTED_MODULE_0__.Wb())&&(e.inputexternice=i.first),_angular_core__WEBPACK_IMPORTED_MODULE_0__.ic(i=_angular_core__WEBPACK_IMPORTED_MODULE_0__.Wb())&&(e.qualificationcomponent=i.first),_angular_core__WEBPACK_IMPORTED_MODULE_0__.ic(i=_angular_core__WEBPACK_IMPORTED_MODULE_0__.Wb())&&(e.externselqual=i.first))},inputs:{currentsample:"currentsample",domaindisabled:"domaindisabled"},outputs:{sendaddsample:"sendaddsample"},decls:67,vars:47,consts:[["width","80%","height","50%","placement","top",3,"visible","backdropClose","hasBackdrop","visibleChange","confirm"],["dialogqulification",""],[2,"width","100%","height","100%",3,"tablespan","modify","treespan","producthidden","qualitreeheight"],["selqual",""],["width","35%","height","50%","placement","top",3,"visible","backdropClose","hasBackdrop","visibleChange","confirm"],["dialogexterqulification",""],[2,"width","100%","height","100%",3,"modify","tablespan","treespan"],["externselqual",""],[1,"au-inner","au-column"],["span","4"],["plain","","size","small","icon","fto-chevron-left",3,"click"],["icon","fto-save","type","primary","plain","","size","small",3,"disabled","click"],["span","16"],["id","displaytag",2,"color","crimson","font-size","10pt"],[2,"height","20px"],["span","8"],["label","\u6837\u54c1\u540d\u79f0","required","","direction","row",3,"disabled","ngModel","ngModelChange"],["inputsamplename",""],["span","2"],["span","6"],[3,"disabled","data","ngModel","ngModelChange"],["label","\u6837\u54c1\u5904\u7406","direction","row",3,"data","ngModel","ngModelChange"],["label","\u6837\u54c1\u4ef7\u683c","required","","direction","row",3,"disabled","ngModel","ngModelChange"],["inputsampleprice",""],["readonly","true","label","\u6807\u51c6\u68c0\u6d4b\u8d39","direction","row",3,"disabled","ngModel","ngModelChange"],["inputexternice",""],[2,"text-align","center","font-weight","bolder","font-size","12pt"],[2,"height","20"],["icon","ado-search","plain","","size","small","type","primary",3,"disabled","click"],["adaptionHeight","600","virtualScroll","","loading","",1,"x-table.x-pagination",3,"data","columns","index","size","total","query","bodyColumnTpl","indexChange","sizeChange"],["projecttable",""],["plain","","size","small","icon","ado-search","type","primary",3,"disabled","click"],["adaptionHeight","600","virtualScroll","","loading","",3,"data","columns","index","size","total","query","bodyColumnTpl","indexChange","sizeChange"],["projectTpl",""],["exprojectTpl",""],[1,"au-table-actions"],["icon","fto-trash-2","title","\u5220\u9664",3,"disabled","click"]],template:function(t,e){if(1&t&&(_angular_core__WEBPACK_IMPORTED_MODULE_0__.Ob(0,"x-dialog",0,1),_angular_core__WEBPACK_IMPORTED_MODULE_0__.Vb("visibleChange",(function(t){return e.qvisible=t}))("confirm",(function(){return e.quaconfirm()})),_angular_core__WEBPACK_IMPORTED_MODULE_0__.Jb(2,"app-qualification",2,3),_angular_core__WEBPACK_IMPORTED_MODULE_0__.Nb(),_angular_core__WEBPACK_IMPORTED_MODULE_0__.Ob(4,"x-dialog",4,5),_angular_core__WEBPACK_IMPORTED_MODULE_0__.Vb("visibleChange",(function(t){return e.qexternvisible=t}))("confirm",(function(){return e.exterquaconfirm()})),_angular_core__WEBPACK_IMPORTED_MODULE_0__.Jb(6,"app-qualification",6,7),_angular_core__WEBPACK_IMPORTED_MODULE_0__.Nb(),_angular_core__WEBPACK_IMPORTED_MODULE_0__.Ob(8,"x-inner",8),_angular_core__WEBPACK_IMPORTED_MODULE_0__.Ob(9,"x-row"),_angular_core__WEBPACK_IMPORTED_MODULE_0__.Ob(10,"x-col",9),_angular_core__WEBPACK_IMPORTED_MODULE_0__.Ob(11,"x-button",10),_angular_core__WEBPACK_IMPORTED_MODULE_0__.Vb("click",(function(){return e.action("cancel")})),_angular_core__WEBPACK_IMPORTED_MODULE_0__.wc(12,"\u8fd4\u56de"),_angular_core__WEBPACK_IMPORTED_MODULE_0__.Nb(),_angular_core__WEBPACK_IMPORTED_MODULE_0__.Nb(),_angular_core__WEBPACK_IMPORTED_MODULE_0__.Ob(13,"x-col",9),_angular_core__WEBPACK_IMPORTED_MODULE_0__.Ob(14,"x-button",11),_angular_core__WEBPACK_IMPORTED_MODULE_0__.Vb("click",(function(){return!e.formInvalid&&e.action("save")})),_angular_core__WEBPACK_IMPORTED_MODULE_0__.wc(15," \u4fdd\u5b58 "),_angular_core__WEBPACK_IMPORTED_MODULE_0__.Nb(),_angular_core__WEBPACK_IMPORTED_MODULE_0__.Nb(),_angular_core__WEBPACK_IMPORTED_MODULE_0__.Ob(16,"x-col",12),_angular_core__WEBPACK_IMPORTED_MODULE_0__.Ob(17,"div",13),_angular_core__WEBPACK_IMPORTED_MODULE_0__.wc(18),_angular_core__WEBPACK_IMPORTED_MODULE_0__.Nb(),_angular_core__WEBPACK_IMPORTED_MODULE_0__.Nb(),_angular_core__WEBPACK_IMPORTED_MODULE_0__.Nb(),_angular_core__WEBPACK_IMPORTED_MODULE_0__.Jb(19,"x-row",14),_angular_core__WEBPACK_IMPORTED_MODULE_0__.Ob(20,"x-row"),_angular_core__WEBPACK_IMPORTED_MODULE_0__.Ob(21,"x-col",15),_angular_core__WEBPACK_IMPORTED_MODULE_0__.Ob(22,"x-input",16,17),_angular_core__WEBPACK_IMPORTED_MODULE_0__.Vb("ngModelChange",(function(t){return e.currentsample.samplename=t})),_angular_core__WEBPACK_IMPORTED_MODULE_0__.Nb(),_angular_core__WEBPACK_IMPORTED_MODULE_0__.Nb(),_angular_core__WEBPACK_IMPORTED_MODULE_0__.Ob(24,"x-col",18),_angular_core__WEBPACK_IMPORTED_MODULE_0__.wc(25," \u9886\u57df "),_angular_core__WEBPACK_IMPORTED_MODULE_0__.Nb(),_angular_core__WEBPACK_IMPORTED_MODULE_0__.Ob(26,"x-col",19),_angular_core__WEBPACK_IMPORTED_MODULE_0__.Ob(27,"x-select",20),_angular_core__WEBPACK_IMPORTED_MODULE_0__.Vb("ngModelChange",(function(t){return e.currentsample.domainid=t})),_angular_core__WEBPACK_IMPORTED_MODULE_0__.Nb(),_angular_core__WEBPACK_IMPORTED_MODULE_0__.Nb(),_angular_core__WEBPACK_IMPORTED_MODULE_0__.Ob(28,"x-col",15),_angular_core__WEBPACK_IMPORTED_MODULE_0__.Ob(29,"x-select",21),_angular_core__WEBPACK_IMPORTED_MODULE_0__.Vb("ngModelChange",(function(t){return e.processid=t})),_angular_core__WEBPACK_IMPORTED_MODULE_0__.Nb(),_angular_core__WEBPACK_IMPORTED_MODULE_0__.Nb(),_angular_core__WEBPACK_IMPORTED_MODULE_0__.Nb(),_angular_core__WEBPACK_IMPORTED_MODULE_0__.Jb(30,"x-row",14),_angular_core__WEBPACK_IMPORTED_MODULE_0__.Ob(31,"x-row"),_angular_core__WEBPACK_IMPORTED_MODULE_0__.Ob(32,"x-col",15),_angular_core__WEBPACK_IMPORTED_MODULE_0__.Ob(33,"x-input",22,23),_angular_core__WEBPACK_IMPORTED_MODULE_0__.Vb("ngModelChange",(function(t){return e.currentsample.price=t})),_angular_core__WEBPACK_IMPORTED_MODULE_0__.Nb(),_angular_core__WEBPACK_IMPORTED_MODULE_0__.Nb(),_angular_core__WEBPACK_IMPORTED_MODULE_0__.Ob(35,"x-col",15),_angular_core__WEBPACK_IMPORTED_MODULE_0__.Ob(36,"x-input",24,25),_angular_core__WEBPACK_IMPORTED_MODULE_0__.Vb("ngModelChange",(function(t){return e.currentsample.standardfee=t})),_angular_core__WEBPACK_IMPORTED_MODULE_0__.Nb(),_angular_core__WEBPACK_IMPORTED_MODULE_0__.Nb(),_angular_core__WEBPACK_IMPORTED_MODULE_0__.Nb(),_angular_core__WEBPACK_IMPORTED_MODULE_0__.Jb(38,"x-row",14),_angular_core__WEBPACK_IMPORTED_MODULE_0__.Ob(39,"x-row"),_angular_core__WEBPACK_IMPORTED_MODULE_0__.Ob(40,"x-col",26),_angular_core__WEBPACK_IMPORTED_MODULE_0__.wc(41," \u68c0\u6d4b\u9879\u76ee\u4fe1\u606f "),_angular_core__WEBPACK_IMPORTED_MODULE_0__.Nb(),_angular_core__WEBPACK_IMPORTED_MODULE_0__.Nb(),_angular_core__WEBPACK_IMPORTED_MODULE_0__.Jb(42,"x-row",27),_angular_core__WEBPACK_IMPORTED_MODULE_0__.Ob(43,"x-row"),_angular_core__WEBPACK_IMPORTED_MODULE_0__.Ob(44,"x-col",9),_angular_core__WEBPACK_IMPORTED_MODULE_0__.Ob(45,"x-button",28),_angular_core__WEBPACK_IMPORTED_MODULE_0__.Vb("click",(function(){return!e.methodInvalid&&e.projectaction("add")})),_angular_core__WEBPACK_IMPORTED_MODULE_0__.wc(46," \u6dfb\u52a0 "),_angular_core__WEBPACK_IMPORTED_MODULE_0__.Nb(),_angular_core__WEBPACK_IMPORTED_MODULE_0__.Nb(),_angular_core__WEBPACK_IMPORTED_MODULE_0__.Nb(),_angular_core__WEBPACK_IMPORTED_MODULE_0__.Ob(47,"x-row"),_angular_core__WEBPACK_IMPORTED_MODULE_0__.Ob(48,"x-col"),_angular_core__WEBPACK_IMPORTED_MODULE_0__.Ob(49,"x-table",29,30),_angular_core__WEBPACK_IMPORTED_MODULE_0__.Vb("indexChange",(function(t){return e.projectindex=t}))("sizeChange",(function(t){return e.projectsize=t})),_angular_core__WEBPACK_IMPORTED_MODULE_0__.Nb(),_angular_core__WEBPACK_IMPORTED_MODULE_0__.Nb(),_angular_core__WEBPACK_IMPORTED_MODULE_0__.Nb(),_angular_core__WEBPACK_IMPORTED_MODULE_0__.Ob(51,"x-row"),_angular_core__WEBPACK_IMPORTED_MODULE_0__.Ob(52,"x-col",26),_angular_core__WEBPACK_IMPORTED_MODULE_0__.wc(53," \u5916\u5305\u9879\u76ee\u4fe1\u606f "),_angular_core__WEBPACK_IMPORTED_MODULE_0__.Nb(),_angular_core__WEBPACK_IMPORTED_MODULE_0__.Nb(),_angular_core__WEBPACK_IMPORTED_MODULE_0__.Jb(54,"x-row",27),_angular_core__WEBPACK_IMPORTED_MODULE_0__.Ob(55,"x-row"),_angular_core__WEBPACK_IMPORTED_MODULE_0__.Ob(56,"x-col",9),_angular_core__WEBPACK_IMPORTED_MODULE_0__.Ob(57,"x-button",31),_angular_core__WEBPACK_IMPORTED_MODULE_0__.Vb("click",(function(){return!e.methodInvalid&&e.externprojectaction("add")})),_angular_core__WEBPACK_IMPORTED_MODULE_0__.wc(58," \u6dfb\u52a0 "),_angular_core__WEBPACK_IMPORTED_MODULE_0__.Nb(),_angular_core__WEBPACK_IMPORTED_MODULE_0__.Nb(),_angular_core__WEBPACK_IMPORTED_MODULE_0__.Nb(),_angular_core__WEBPACK_IMPORTED_MODULE_0__.Ob(59,"x-row"),_angular_core__WEBPACK_IMPORTED_MODULE_0__.Ob(60,"x-col"),_angular_core__WEBPACK_IMPORTED_MODULE_0__.Ob(61,"x-table",32,30),_angular_core__WEBPACK_IMPORTED_MODULE_0__.Vb("indexChange",(function(t){return e.externprojectindex=t}))("sizeChange",(function(t){return e.externprojectsize=t})),_angular_core__WEBPACK_IMPORTED_MODULE_0__.Nb(),_angular_core__WEBPACK_IMPORTED_MODULE_0__.Nb(),_angular_core__WEBPACK_IMPORTED_MODULE_0__.Nb(),_angular_core__WEBPACK_IMPORTED_MODULE_0__.Nb(),_angular_core__WEBPACK_IMPORTED_MODULE_0__.uc(63,AddsampleComponent_ng_template_63_Template,2,1,"ng-template",null,33,_angular_core__WEBPACK_IMPORTED_MODULE_0__.vc),_angular_core__WEBPACK_IMPORTED_MODULE_0__.uc(65,AddsampleComponent_ng_template_65_Template,2,1,"ng-template",null,34,_angular_core__WEBPACK_IMPORTED_MODULE_0__.vc)),2&t){const t=_angular_core__WEBPACK_IMPORTED_MODULE_0__.jc(64),i=_angular_core__WEBPACK_IMPORTED_MODULE_0__.jc(66);_angular_core__WEBPACK_IMPORTED_MODULE_0__.ec("visible",e.qvisible)("backdropClose",!1)("hasBackdrop",!1),_angular_core__WEBPACK_IMPORTED_MODULE_0__.yb(2),_angular_core__WEBPACK_IMPORTED_MODULE_0__.ec("tablespan",15)("modify",1)("treespan",5)("producthidden",e.producthidden)("qualitreeheight",e.qualitreeheight),_angular_core__WEBPACK_IMPORTED_MODULE_0__.yb(2),_angular_core__WEBPACK_IMPORTED_MODULE_0__.ec("visible",e.qexternvisible)("backdropClose",!1)("hasBackdrop",!1),_angular_core__WEBPACK_IMPORTED_MODULE_0__.yb(2),_angular_core__WEBPACK_IMPORTED_MODULE_0__.ec("modify",1)("tablespan",10)("treespan",10),_angular_core__WEBPACK_IMPORTED_MODULE_0__.yb(8),_angular_core__WEBPACK_IMPORTED_MODULE_0__.ec("disabled",e.formInvalid||e.disabled),_angular_core__WEBPACK_IMPORTED_MODULE_0__.yb(4),_angular_core__WEBPACK_IMPORTED_MODULE_0__.xc(e.invalidstring),_angular_core__WEBPACK_IMPORTED_MODULE_0__.yb(4),_angular_core__WEBPACK_IMPORTED_MODULE_0__.ec("disabled",e.disabled)("ngModel",e.currentsample.samplename),_angular_core__WEBPACK_IMPORTED_MODULE_0__.yb(5),_angular_core__WEBPACK_IMPORTED_MODULE_0__.ec("disabled",e.domaindisabled||e.disabled)("data",e.domaindata)("ngModel",e.currentsample.domainid),_angular_core__WEBPACK_IMPORTED_MODULE_0__.yb(2),_angular_core__WEBPACK_IMPORTED_MODULE_0__.ec("data",e.process)("ngModel",e.processid),_angular_core__WEBPACK_IMPORTED_MODULE_0__.yb(4),_angular_core__WEBPACK_IMPORTED_MODULE_0__.ec("disabled",e.disabled)("ngModel",e.currentsample.price),_angular_core__WEBPACK_IMPORTED_MODULE_0__.yb(3),_angular_core__WEBPACK_IMPORTED_MODULE_0__.ec("disabled",e.disabled)("ngModel",e.currentsample.standardfee),_angular_core__WEBPACK_IMPORTED_MODULE_0__.yb(9),_angular_core__WEBPACK_IMPORTED_MODULE_0__.ec("disabled",e.methodInvalid||e.disabled),_angular_core__WEBPACK_IMPORTED_MODULE_0__.yb(4),_angular_core__WEBPACK_IMPORTED_MODULE_0__.ec("data",e.projectdata)("columns",e.projectcolumns)("index",e.projectindex)("size",e.projectsize)("total",e.projecttotal)("query",e.projectquery)("bodyColumnTpl",_angular_core__WEBPACK_IMPORTED_MODULE_0__.gc(43,_c6,t)),_angular_core__WEBPACK_IMPORTED_MODULE_0__.yb(8),_angular_core__WEBPACK_IMPORTED_MODULE_0__.ec("disabled",e.methodInvalid||e.disabled),_angular_core__WEBPACK_IMPORTED_MODULE_0__.yb(4),_angular_core__WEBPACK_IMPORTED_MODULE_0__.ec("data",e.externprojectdata)("columns",e.externprojectcolumns)("index",e.externprojectindex)("size",e.externprojectsize)("total",e.externtotal)("query",e.externprojectquery)("bodyColumnTpl",_angular_core__WEBPACK_IMPORTED_MODULE_0__.gc(45,_c6,i))}},directives:[_ng_nest_ui__WEBPACK_IMPORTED_MODULE_7__.a,src_main_qualification_qualification_component__WEBPACK_IMPORTED_MODULE_5__.a,_ng_nest_ui_inner__WEBPACK_IMPORTED_MODULE_12__.a,_ng_nest_ui__WEBPACK_IMPORTED_MODULE_8__.c,_ng_nest_ui__WEBPACK_IMPORTED_MODULE_8__.a,_ng_nest_ui__WEBPACK_IMPORTED_MODULE_9__.a,_ng_nest_ui__WEBPACK_IMPORTED_MODULE_10__.a,_angular_forms__WEBPACK_IMPORTED_MODULE_13__.B,_angular_forms__WEBPACK_IMPORTED_MODULE_13__.q,_angular_forms__WEBPACK_IMPORTED_MODULE_13__.t,_ng_nest_ui__WEBPACK_IMPORTED_MODULE_11__.a,_ng_nest_ui_table__WEBPACK_IMPORTED_MODULE_14__.a,_ng_nest_ui_link__WEBPACK_IMPORTED_MODULE_15__.a],styles:[":host x-table.x-pagination{padding-top:.875rem;display:none}"],encapsulation:3}),AddsampleComponent})()},jnZo:function(t,e,i){"use strict";i.r(e),i.d(e,"EvirmentheathModule",(function(){return Rt}));var a=i("tyNb"),s=i("3pM9"),c=i("HDdC"),n=i("LvDl"),r=i("fXoL");let o=(()=>{class t{constructor(){this.localdata=[]}setlocaldata(t){this.localdata=t}getList(t,e,i,a){return new c.a(e=>{let i=[];i=this.setFilter(t,(null==a?void 0:a.filterLogic)||"and",null==a?void 0:a.filter),e.complete()})}get(t){return new c.a}post(t){return new c.a}put(t){return new c.a}delete(t){return new c.a}setFilter(t,e,i){let a=t;return i&&i.length>0&&(a=t.filter(t=>{var a=!1;if("or"==e){for(var s=0;s<i.length;s++)if(t[i[s].field].indexOf(i[s].value)>=0){a=!0;break}}else if("and"==e)for(a=!0,s=0;s<i.length;s++)if(-1==t[i[s].field].indexOf(i[s].value)){a=!1;break}return a})),a}setGroup(t,e){return Object(n.map)(Object(s.L)(t,e),(t,i)=>{let a={id:i,count:t.length};return a[e]=i,a})}setSort(t,e){return Object(n.orderBy)(t,Object(n.map)(e,t=>t.field),Object(n.map)(e,t=>t.value))}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275prov=r.Eb({token:t,factory:t.\u0275fac}),t})();var l=i("wTjX"),_=i("K7LP"),d=i("LZRM"),u=i("BzWU"),h=i("wd/R"),b=i("TPaT"),p=i("eIN6"),m=i("x2e1"),g=i("x6Xy"),E=i("qMpK"),O=i("SfH5"),f=i("GvSL"),v=i("yO6f"),M=i("kXfN");const C=["contacttable"];function P(t,e){if(1&t){const t=r.Pb();r.Ob(0,"div",5),r.Ob(1,"x-link",6),r.Vb("click",(function(){r.lc(t);const i=e.$row,a=r.Yb();return!a.submitdisable(i)&&a.auth.delete&&a.cotactaction("delete",i)})),r.Nb(),r.Ob(2,"x-link",7),r.Vb("click",(function(){r.lc(t);const i=e.$row,a=r.Yb();return!a.submitdisable(i)&&a.auth.submit&&a.cotactaction("submit",i)})),r.Nb(),r.Nb()}if(2&t){const t=e.$row,i=r.Yb();r.yb(1),r.ec("disabled",!i.auth.delete||i.submitdisable(t)),r.yb(1),r.ec("disabled",!i.auth.submit||i.submitdisable(t))}}const D=function(t){return{actions:t}};let x=(()=>{class t extends _.a{constructor(t,e,i,a,s,c,n){super(t),this.indexService=t,this.contactservice=e,this.msgBox=i,this.msg=a,this.flowservice=s,this.projectservice=c,this.rolediscountservice=n,this.contactChange=new r.n,this.contactdata=[],this.allcontactdata=[],this.contactcolumns=[{id:"index",label:"\u5e8f\u53f7",width:50,type:"index"},{id:"actions",label:"\u64cd\u4f5c",width:50},{id:"id",label:"\u5408\u540c\u7f16\u53f7",width:80,sort:!0},{id:"totalfee",label:"\u603b\u8d39\u7528",width:80,sort:!0},{id:"testfee",label:"\u68c0\u6d4b\u8d39",width:80,sort:!0},{id:"standardfee",label:"\u6807\u51c6\u68c0\u6d4b\u8d39",width:100,sort:!0},{id:"discount",label:"\u6298\u6263",width:80},{id:"ugency",label:"\u52a0\u6025\u7c7b\u578b",width:80,sort:!0},{id:"signdate",label:"\u7b7e\u8ba2\u65e5\u671f",width:100,sort:!0}],this.activeid="",this.contactindex=1,this.contactsize=20,this.contacttotal=0,this.contactquery={filter:[]},this.auth={}}ngOnInit(){}setActive(t){this.activeid=t}cotactaction(t,e){switch(t){case"add":if(null==this.customer||null==this.customer.id||""==this.customer.id)this.msgBox.alert("\u8fd8\u6ca1\u6709\u9009\u62e9\u5ba2\u6237");else{var i=h().format("YYYY-MM-DD");this.currentContact={id:u.a.GetRandomStr(!0,5,16),customerid:this.customer.id,signdate:i},console.log(i),this.currentContact.userid=this.indexService.auth.user.id+"",this.contactservice.post(this.currentContact).subscribe(t=>{this.currentContact=t,this.contactdata.push(t),this.contactdata=this.contactdata.map(t=>t),this.contacttotal=this.contactdata.length,this.contacttable.activatedRow=t,null!=this.contactchange&&this.contactChange.emit(t)})}break;case"delete":this.msgBox.confirm({title:"\u63d0\u793a",content:`\u6b64\u64cd\u4f5c\u5c06\u6c38\u4e45\u5220\u9664\u6b64\u6761\u6570\u636e\uff1a${e.id}\uff0c\u662f\u5426\u7ee7\u7eed\uff1f`,type:"warning",callback:t=>{"confirm"===t&&this.contactservice.delete(e.id||"").subscribe(t=>{var i=u.a.setafterdelete(e.id,this.contactdata);this.msg.success("\u5220\u9664\u6210\u529f"),this.contactdata=this.contactdata.map(t=>t),this.contacttotal=this.contactdata.length,i>0?this.currentContact=this.contactdata[i-1]:0==i&&this.contacttotal>0&&(this.currentContact=this.contactdata[i+1]),this.contacttable.activatedRow=this.currentContact,null!=this.contactchange&&this.contactChange.emit(this.currentContact)})}});break;case"submit":var a=e.contactcustomers.find(t=>1==t.customertype);null!=a&&null!=a.area&&this.rolediscountservice.getrolediscountvaluebyid(a.area,this.indexService.auth.user.roles).subscribe(t=>{this.flowservice.startflow({customername:a.customername,userid:this.indexService.auth.user.id+"",username:this.indexService.auth.user.name,contactid:e.id,instanceKey:"LimsTestProcess"}).subscribe(i=>{this.projectservice.getprojects(e.id).subscribe(a=>{this.flowservice.excutetask(i.TaskId,{userid:this.indexService.auth.user.id+"",username:this.indexService.auth.user.name,contactid:e.id,limitdiscount:t.discount,ugencytype:e.service.id}).subscribe(t=>{this.msg.success("\u63d0\u4ea4\u6210\u529f"),this.currentContact.contactstatus=1})})})})}}getcontactdata(t=!0){this.contactquery={filter:[{field:"id",value:""+this.customer.id,operation:"="},{field:"userid",value:""+this.indexService.auth.user.id,operation:"="}]},this.contactservice.getList(this.contactindex,this.contactsize,this.contactquery).subscribe(e=>{if([this.contactdata,this.contacttotal]=[e.list,Number(e.total)],console.log(e.list),this.contactdata.length>0){if(t)if(""!=this.activeid){var i=this.contactdata.findIndex(t=>t.id==this.activeid);this.currentContact=-1!=i?this.contactdata[i]:this.contactdata[0]}else this.currentContact=this.contactdata[0];this.contacttable.activatedRow=this.currentContact}this.contactChange.emit(this.currentContact)})}refreshdata(){this.contactdata=[...this.contactdata]}contactchange(t){this.currentContact=t,this.contactChange.emit(t)}copaycotactaction(){null!=this.currentContact&&null!=this.currentContact&&null!=this.currentContact.id&&this.contactservice.getcontactproject(this.currentContact.id+"").subscribe(t=>{var e,i=t.contact;i.id=u.a.GetRandomStr(!0,6,10),null===(e=i.contactcustomers)||void 0===e||e.map(t=>{t.contactid=i.id+""});var a=t.projects,s=1;a.map(t=>{var e;t.contactid=i.id+"",t.id=u.a.JsNewGuid(),t.projectnumber="\u4e34\u65f6\u9879\u76ee"+s,s+=1,t.projectstatus=0,null===(e=t.samples)||void 0===e||e.map(e=>{var i;e.projectid=t.id+"",e.id=u.a.JsNewGuid(),null===(i=e.testprojects)||void 0===i||i.map(t=>{t.sampleid=e.id+""})})}),this.contactservice.addcontactproject({contact:i,projects:a}).subscribe(()=>{this.currentContact=i,this.contactdata.push(i),this.contactdata=[...this.contactdata],null!=this.contactChange&&this.contactChange.emit(i)})})}contactIndexChange(t){this.contactindex=t}submitdisable(t){return 1==t.contactstatus}}return t.\u0275fac=function(e){return new(e||t)(r.Ib(l.a),r.Ib(d.a),r.Ib(g.c),r.Ib(E.c),r.Ib(b.a),r.Ib(m.a),r.Ib(p.a))},t.\u0275cmp=r.Cb({type:t,selectors:[["app-contact"]],viewQuery:function(t,e){var i;1&t&&r.Bc(C,!0),2&t&&r.ic(i=r.Wb())&&(e.contacttable=i.first)},inputs:{auth:"auth"},outputs:{contactChange:"contactChange"},features:[r.vb],decls:13,vars:12,consts:[["span","3"],["icon","fto-plus","plain","",3,"disabled","click"],["virtualScroll","","loading","",3,"data","columns","index","size","total","query","adaptionHeight","bodyColumnTpl","indexChange","sizeChange","activatedRowChange"],["contacttable",""],["contactTpl",""],[1,"au-table-actions"],["icon","fto-trash-2","title","\u5220\u9664",3,"disabled","click"],["icon","fto-check","type","success","title","\u63d0\u4ea4",3,"disabled","click"]],template:function(t,e){if(1&t&&(r.Ob(0,"x-row"),r.Ob(1,"x-col",0),r.Ob(2,"x-button",1),r.Vb("click",(function(){return e.auth.add&&e.cotactaction("add")})),r.wc(3," \u65b0\u589e "),r.Nb(),r.Nb(),r.Ob(4,"x-col",0),r.Ob(5,"x-button",1),r.Vb("click",(function(){return e.auth.add&&e.copaycotactaction()})),r.wc(6," \u590d\u5236\u65b0\u589e "),r.Nb(),r.Nb(),r.Nb(),r.Ob(7,"x-row"),r.Ob(8,"x-col"),r.Ob(9,"x-table",2,3),r.Vb("indexChange",(function(t){return e.contactindex=t}))("sizeChange",(function(t){return e.contactsize=t}))("activatedRowChange",(function(t){return e.contactchange(t)}))("indexChange",(function(t){return e.contactIndexChange(t)})),r.Nb(),r.Nb(),r.Nb(),r.uc(11,P,3,2,"ng-template",null,4,r.vc)),2&t){const t=r.jc(12);r.yb(2),r.ec("disabled",!e.auth.add),r.yb(3),r.ec("disabled",!e.auth.add),r.yb(4),r.ec("data",e.contactdata)("columns",e.contactcolumns)("index",e.contactindex)("size",e.contactsize)("total",e.contacttotal)("query",e.contactquery)("adaptionHeight",470)("bodyColumnTpl",r.gc(10,D,t))}},directives:[O.c,O.a,f.a,v.a,M.a],styles:[""]}),t})();var w=i("M3sX"),I=i("bRdP"),y=i("NtM8");let B=(()=>{class t extends I.a{constructor(t){super(t,{controller:{name:"customers",servicetype:"businessprocess"}}),this.http=t}}return t.\u0275fac=function(e){return new(e||t)(r.Sb(y.a))},t.\u0275prov=r.Eb({token:t,factory:t.\u0275fac,providedIn:"root"}),t})();var j=i("lJxs");let T=(()=>{class t extends s.z{constructor(){super(...arguments),this.users=[{id:1,label:"\u5317\u4eac\u5e02"},{id:2,label:"\u4e0a\u6d77\u5e02"},{id:3,label:"\u5929\u6d25\u5e02"},{id:4,label:"\u91cd\u5e86\u5e02"},{id:5,label:"\u5e7f\u4e1c\u7701"},{id:6,label:"\u6c5f\u82cf\u7701"},{id:7,label:"\u5c71\u4e1c\u7701"},{id:8,label:"\u6d59\u6c5f\u7701"},{id:9,label:"\u6cb3\u5357\u7701"},{id:10,label:"\u53f0\u6e7e\u7701"},{id:11,label:"\u6e56\u5317\u7701"},{id:12,label:"\u6e56\u5357\u7701"},{id:13,label:"\u56db\u5ddd\u7701"},{id:14,label:"\u7518\u8083\u7701"},{id:15,label:"\u9655\u897f\u7701"},{id:16,label:"\u5c71\u897f\u7701"},{id:17,label:"\u6c5f\u897f\u7701"},{id:18,label:"\u798f\u5efa\u7701"},{id:19,label:"\u8d35\u5dde\u7701"},{id:20,label:"\u8fbd\u5b81\u7701"},{id:21,label:"\u5409\u6797\u7701"},{id:22,label:"\u9ed1\u9f99\u6c5f\u7701"},{id:23,label:"\u5b89\u5fbd\u7701"},{id:24,label:"\u5185\u8499\u53e4\u81ea\u6cbb\u533a"},{id:25,label:"\u65b0\u7586\u7ef4\u543e\u5c14\u81ea\u6cbb\u533a"},{id:26,label:"\u897f\u85cf\u81ea\u6cbb\u533a"},{id:27,label:"\u6d77\u5357\u7701"},{id:28,label:"\u5b81\u590f\u56de\u65cf\u81ea\u6cbb\u533a"},{id:29,label:"\u5e7f\u897f\u58ee\u65cf\u81ea\u6cbb\u533a"},{id:30,label:"\u6cb3\u5317\u7701"},{id:31,label:"\u9999\u6e2f\u7279\u522b\u884c\u653f\u533a"},{id:32,label:"\u6fb3\u95e8\u7279\u522b\u884c\u653f\u533a"}]}getList(t,e,i){return new c.a(a=>{let c=[];c=this.setFilter(this.users,null==i?void 0:i.filter),(null==i?void 0:i.group)&&(c=this.setGroup(c,i.group)),(null==i?void 0:i.sort)&&(c=this.setSort(c,i.sort));let n=Object(s.J)(c,e);a.next(t<=n.length?{total:c.length,list:n[t-1]}:{total:c.length,list:[]}),a.complete()})}getidbyname(t){return this.users.find(e=>e.label==t)}get(t){return new c.a}post(t){return new c.a}put(t){return new c.a}delete(t){return new c.a}setFilter(t,e){let i=t;return e&&e.length>0&&e.forEach(t=>{i=i.filter(e=>e[t.field].indexOf(t.value)>=0)}),i}setGroup(t,e){return Object(n.map)(Object(s.L)(t,e),(t,i)=>{let a={id:i,count:t.length};return a[e]=i,a})}setSort(t,e){return Object(n.orderBy)(t,Object(n.map)(e,t=>t.field),Object(n.map)(e,t=>t.value))}}return t.\u0275fac=function(e){return R(e||t)},t.\u0275prov=r.Eb({token:t,factory:t.\u0275fac}),t})();const R=r.Qb(T);var W=i("1uEr"),A=i("ZQZ3"),L=i("MOn6"),N=i("hMyc");const K=["form"];let U=(()=>{class t{constructor(t,e,i,a){this.message=t,this.cdr=e,this.service=i,this.provservice=a,this.config={labelWidth:"6rem"},this.sendmessage=new r.n,this.controls=[{control:"input",id:"customername",label:"\u5ba2\u6237\u540d\u79f0",required:!0,maxlength:50,pattern:/[\u4e00-\u9fa5_a-zA-Z0-9_]/},{control:"input",id:"customeraddress",label:"\u5355\u4f4d\u5730\u5740",required:!0,maxlength:50,pattern:/[\u4e00-\u9fa5_a-zA-Z0-9_]/},{control:"find",id:"customertype",label:"\u5ba2\u6237\u7c7b\u578b",required:!0,multiple:!1,treeData:()=>[{id:"1",label:"\u5927\u5ba2\u6237"},{id:"2",label:"\u666e\u901a\u5ba2\u6237"}]},{control:"find",id:"area",label:"\u7701\u4efd",required:!0,multiple:!1,treeData:()=>this.provservice.getList(1,50).pipe(Object(j.a)(t=>t.list))},{control:"input",id:"contacter",label:"\u8054\u7cfb\u4eba\u59d3\u540d",required:!0},{control:"input",id:"phone",label:"\u8054\u7cfb\u4eba\u7535\u8bdd",required:!0},{control:"input",id:"fax",label:"\u4f20\u771f"},{control:"input",id:"email",label:"\u90ae\u7bb1"},{control:"input",id:"postcode",label:"\u90ae\u7f16"}]}get formInvalid(){var t,e;return null===(e=null===(t=this.form)||void 0===t?void 0:t.formGroup)||void 0===e?void 0:e.invalid}get disabled(){return"info"===this.type}ngDoCheck(){}setinitcustomer(t){var e,i,a,s;this.id=t.id+"",console.log(t),this.form.formGroup.setValue({customername:t.customername,contacter:t.contacter,customeraddress:t.customeraddress,phone:t.phone,email:t.email,customertype:{id:null===(e=t.customertype)||void 0===e?void 0:e.id,label:null===(i=t.customertype)||void 0===i?void 0:i.customertype},fax:t.fax,postcode:t.postcode,area:null==t.area?1:this.provservice.getidbyname(t.area)}),this.selectedprovince=this.provservice.getidbyname(t.area+""),this.selected={id:null==(null===(a=t.customertype)||void 0===a?void 0:a.id)?2:t.customertype.id,label:null==(null===(s=t.customertype)||void 0===s?void 0:s.customertype)?"\u666e\u901a\u5ba2\u6237":t.customertype.customertype},console.log(this.form.formGroup),this.selected.id&&(this.controls.find(t=>"customertype"===t.id).value=[this.selected]),null!=this.selectedprovince&&this.selectedprovince.id&&(this.controls.find(t=>"area"===t.id).value=[this.selectedprovince])}setcurrent(t,e,i){this.userid=e,this.currentcustomer=i,this.type=t,null!=i?this.setinitcustomer(i):this.form.formGroup.setValue({customername:"",contacter:"",customeraddress:"",phone:"",email:"",customertype:{id:2,label:"\u666e\u901a\u5ba2\u6237"},fax:"",area:{id:1,label:"\u5317\u4eac"},postcode:""})}ngOnInit(){}ngAfterViewInit(){this.cdr.detectChanges()}action(t){switch(t){case"info":case"edit":break;case"save":this.form.formGroup.value.area=this.form.formGroup.value.area.label,this.form.formGroup.value.userid=this.userid,"add"===this.type?this.service.post(this.form.formGroup.value).subscribe(t=>{this.currentcustomer=t,console.log(t.id),this.message.success("\u65b0\u589e\u6210\u529f\uff01"),this.sendmessage.emit("add")}):"edit"===this.type&&(this.form.formGroup.value.id=this.id,this.currentcustomer=this.form.formGroup.value,this.service.put(this.form.formGroup.value).subscribe(t=>{this.message.success("\u4fee\u6539\u6210\u529f\uff01"),this.sendmessage.emit("edit")}));break;case"cancel":this.sendmessage.emit("cancel")}}}return t.\u0275fac=function(e){return new(e||t)(r.Ib(E.c),r.Ib(r.h),r.Ib(B),r.Ib(T))},t.\u0275cmp=r.Cb({type:t,selectors:[["app-addcustomers"]],viewQuery:function(t,e){var i;1&t&&r.Bc(K,!0),2&t&&r.ic(i=r.Wb())&&(e.form=i.first)},outputs:{sendmessage:"sendmessage"},features:[r.xb([T])],decls:9,vars:5,consts:[[1,"au-inner","au-column"],["au-adaption","","direction","row","labelSuffix",":","labelWidth","6rem","width","24rem","labelAlign","end","span","20","space","2",1,"au-panel","au-overflow-auto",3,"outerHeight","disabled","controls"],["form",""],["bottom",""],[3,"space"],["icon","fto-chevron-left",3,"click"],["icon","fto-save","type","primary",3,"disabled","click"]],template:function(t,e){1&t&&(r.Ob(0,"x-inner",0),r.Jb(1,"x-form",1,2),r.Ob(3,"au-tool",3),r.Ob(4,"x-buttons",4),r.Ob(5,"x-button",5),r.Vb("click",(function(){return e.action("cancel")})),r.wc(6,"\u8fd4\u56de"),r.Nb(),r.Ob(7,"x-button",6),r.Vb("click",(function(){return!e.formInvalid&&e.action("save")})),r.wc(8," \u4fdd\u5b58 "),r.Nb(),r.Nb(),r.Nb(),r.Nb()),2&t&&(r.yb(1),r.ec("outerHeight",100)("disabled",e.disabled)("controls",e.controls),r.yb(3),r.ec("space",.5),r.yb(3),r.ec("disabled",e.formInvalid||e.disabled))},directives:[W.a,A.b,L.a,N.a,f.c,f.a],styles:[""]}),t})();var k=i("l5Yv"),q=i("P0lq");const V=["customtable"],z=["customercomponent"],J=["searchcustom"];function S(t,e){if(1&t){const t=r.Pb();r.Ob(0,"div",15),r.Ob(1,"x-link",16),r.Vb("click",(function(){r.lc(t);const i=e.$row,a=r.Yb();return a.auth.info&&a.action("info",i)})),r.Nb(),r.Ob(2,"x-link",17),r.Vb("click",(function(){r.lc(t);const i=e.$row,a=r.Yb();return a.auth.edit&&a.action("edit",i)})),r.Nb(),r.Ob(3,"x-link",18),r.Vb("click",(function(){r.lc(t);const i=e.$row,a=r.Yb();return a.auth.delete&&a.action("delete",i)})),r.Nb(),r.Nb()}if(2&t){const t=r.Yb();r.yb(1),r.ec("disabled",!t.auth.info),r.yb(1),r.ec("disabled",!t.auth.edit),r.yb(1),r.ec("disabled",!t.auth.delete)}}const G=function(t){return{actions:t}};let Y=(()=>{class t{constructor(t,e,i,a,s){this.service=t,this.cdr=e,this.indexService=i,this.msgBox=a,this.msg=s,this.ChangeCustomer=new r.n,this.hidebutton="inline",this.customeradaption=500,this.auth={},this.multiple=!1,this.seldata=[],this.data=[],this.alldata=[],this.columns=[{id:"index",label:"\u5e8f\u53f7",width:100,left:0,type:"index"},{id:"actions",label:"\u64cd\u4f5c",width:100,left:80},{id:"customername",label:"\u5ba2\u6237\u540d\u79f0",width:200,sort:!0},{id:"area",label:"\u533a\u57df",width:300,sort:!0},{id:"customeraddress",label:"\u5355\u4f4d\u5730\u5740",width:300,sort:!0},{id:"email",label:"\u90ae\u7bb1",width:300},{id:"phone",label:"\u7535\u8bdd",width:300},{id:"contacter",label:"\u8054\u7cfb\u4eba",width:300,flex:1,sort:!0},{id:"postcode",label:"\u90ae\u7f16",width:300,flex:1},{id:"remark",label:"\u5907\u6ce8",width:700,flex:1}],this.size=50,this.index=1,this.query={filter:[]},this.total=0,this.visible=!1}ngAfterViewInit(){this.getalldata(this.indexService.auth.user.id+""),this.getData()}setActive(t){var e=this.data.findIndex(e=>e.id==t);-1!=e&&(this.customtable.activatedRow=this.data[e],this.currentCustomer=this.data[e])}customerchange(t){if(this.currentCustomer=t,null!=this.ChangeCustomer&&this.ChangeCustomer.emit(t),this.multiple){var e=this.seldata.findIndex(e=>e.id==t.id);-1==e&&t.sel?this.seldata.push(t):!t.sel&&e>=0&&this.seldata.splice(e,1)}}setselect(t=!0){this.getalldata(this.indexService.auth.user.id+""),this.getData(),this.multiple=t,t?this.columns=[{id:"sel",label:"\u9009\u62e9",width:100,left:0,type:"checkbox"},{id:"customername",label:"\u5ba2\u6237\u540d\u79f0",width:200,sort:!0},{id:"area",label:"\u533a\u57df",width:300,sort:!0},{id:"customeraddress",label:"\u5355\u4f4d\u5730\u5740",width:300,sort:!0},{id:"email",label:"\u90ae\u7bb1",width:300},{id:"phone",label:"\u7535\u8bdd",width:300},{id:"contacter",label:"\u8054\u7cfb\u4eba",width:300,flex:1,sort:!0},{id:"postcode",label:"\u90ae\u7f16",width:300,flex:1},{id:"remark",label:"\u5907\u6ce8",width:700,flex:1}]:(this.columns=[{id:"customername",label:"\u5ba2\u6237\u540d\u79f0",width:200,sort:!0},{id:"area",label:"\u533a\u57df",width:300,sort:!0},{id:"customeraddress",label:"\u5355\u4f4d\u5730\u5740",width:300,sort:!0},{id:"email",label:"\u90ae\u7bb1",width:300},{id:"phone",label:"\u7535\u8bdd",width:300},{id:"contacter",label:"\u8054\u7cfb\u4eba",width:300,flex:1,sort:!0},{id:"postcode",label:"\u90ae\u7f16",width:300,flex:1},{id:"remark",label:"\u5907\u6ce8",width:700,flex:1}],this.seldata.length>0&&(this.customtable.activatedRow=this.data.find(t=>t.id==this.seldata[0].id))),this.data.map(t=>{t.sel=-1!=this.seldata.findIndex(e=>e.id==t.id)})}searchkeydown(){""!=this.searchcustom.value?(this.query.filterLogic="or",this.query.filter=[{field:"customername",value:this.searchcustom.value,operation:"%"},{field:"customeraddress",value:this.searchcustom.value,operation:"%"}]):(this.query.filter=[],this.total=this.alldata.length),this.getData()}ngOnInit(){}getData(){this.service.gethandledata(this.alldata,this.index,this.size,this.query).subscribe(t=>{[this.data,this.total]=[t.list,Number(t.total)],this.total>0&&(this.multiple&&this.data.map(t=>{-1!=this.seldata.findIndex(e=>e.id==t.id)&&(t.sel=!0)}),this.currentCustomer=this.data[0],this.customtable.activatedRow=this.data[0],null!=this.ChangeCustomer&&this.ChangeCustomer.emit(this.data[0]))})}getalldata(t){this.query={filter:[{field:"userid",value:t,operation:"="}]},this.service.getList(this.index,this.size,this.query).subscribe(t=>{[this.alldata,this.total]=[t.list,Number(t.total)],this.getData(),this.cdr.detectChanges()})}indexChange(t){this.index=t,this.getData()}sortChange(t){this.query.sort=t,this.getData()}handlecustomerchange(t){if(this.index=1,this.size=50,this.total=0,null!=this.AddcustomersComponent.currentcustomer)switch(this.currentCustomer=this.AddcustomersComponent.currentcustomer,t){case"add":this.data.push(this.currentCustomer),this.data=this.data.map(t=>t),this.customtable.activatedRow=this.currentCustomer,null!=this.ChangeCustomer&&this.ChangeCustomer.emit(this.currentCustomer);break;case"edit":this.data=this.data.map(t=>t.id==this.currentCustomer.id?this.currentCustomer:t)}this.visible=!1}action(t,e){"delete"!=t?(this.AddcustomersComponent.setcurrent(t,this.indexService.auth.user.id+"",e),this.visible=!0):this.msgBox.confirm({title:"\u63d0\u793a",content:`\u6b64\u64cd\u4f5c\u5c06\u6c38\u4e45\u5220\u9664\u6b64\u6761\u6570\u636e\uff1a${e.customername}\uff0c\u662f\u5426\u7ee7\u7eed\uff1f`,type:"warning",callback:t=>{"confirm"===t&&this.service.delete(e.id).subscribe(t=>{var i=u.a.setafterdelete(e.id,this.data);this.data=this.data.map(t=>t),this.total=this.data.length,this.msg.success("\u5220\u9664\u6210\u529f"),i>0&&(this.currentCustomer=this.data[i-1]),this.customtable.activatedRow=this.currentCustomer,null!=this.ChangeCustomer&&this.ChangeCustomer.emit(this.currentCustomer)})}})}}return t.\u0275fac=function(e){return new(e||t)(r.Ib(B),r.Ib(r.h),r.Ib(l.a),r.Ib(g.c),r.Ib(E.c))},t.\u0275cmp=r.Cb({type:t,selectors:[["app-customer"]],viewQuery:function(t,e){var i;1&t&&(r.Bc(V,!0),r.Bc(z,!0),r.Bc(J,!0)),2&t&&(r.ic(i=r.Wb())&&(e.customtable=i.first),r.ic(i=r.Wb())&&(e.AddcustomersComponent=i.first),r.ic(i=r.Wb())&&(e.searchcustom=i.first))},inputs:{hidebutton:"hidebutton",customeradaption:"customeradaption",auth:"auth"},outputs:{ChangeCustomer:"ChangeCustomer"},decls:19,vars:18,consts:[["width","30%","height","70%",3,"visible","showConfirm","showCancel","backdropClose","hasBackdrop","visibleChange"],["dialogcustomer",""],[2,"width","100%","height","100%",3,"sendmessage"],["customercomponent",""],["span","3"],["id","buttonpanel"],["icon","fto-plus","plain","",3,"disabled","click"],["span","4"],["placeholder","\u8bf7\u8f93\u5165\u5185\u5bb9","icon","ado-search",3,"keyup"],["searchcustom",""],["span","24"],["customerd",""],["virtualScroll","","loading","",3,"columns","data","index","size","query","total","adaptionHeight","bodyColumnTpl","indexChange","sizeChange","queryChange","activatedRowChange","sortChange"],["customtable",""],["actionsTpl",""],[1,"au-table-actions"],["icon","fto-eye","title","\u67e5\u770b",3,"disabled","click"],["icon","fto-edit","title","\u4fee\u6539",3,"disabled","click"],["icon","fto-trash-2","title","\u5220\u9664",3,"disabled","click"]],template:function(t,e){if(1&t&&(r.Ob(0,"x-dialog",0,1),r.Vb("visibleChange",(function(t){return e.visible=t})),r.Ob(2,"app-addcustomers",2,3),r.Vb("sendmessage",(function(t){return e.handlecustomerchange(t)})),r.Nb(),r.Nb(),r.Ob(4,"x-row"),r.Ob(5,"x-col",4),r.Ob(6,"div",5),r.Ob(7,"x-button",6),r.Vb("click",(function(){return e.auth.add&&e.action("add")})),r.wc(8," \u65b0\u589e "),r.Nb(),r.Nb(),r.Nb(),r.Ob(9,"x-col",7),r.Ob(10,"x-input",8,9),r.Vb("keyup",(function(){return e.searchkeydown()})),r.Nb(),r.Nb(),r.Nb(),r.Ob(12,"x-row"),r.Ob(13,"x-col",10,11),r.Ob(15,"x-table",12,13),r.Vb("indexChange",(function(t){return e.index=t}))("sizeChange",(function(t){return e.size=t}))("queryChange",(function(t){return e.query=t}))("activatedRowChange",(function(t){return e.customerchange(t)}))("indexChange",(function(t){return e.indexChange(t)}))("sortChange",(function(t){return e.sortChange(t)})),r.Nb(),r.Nb(),r.Nb(),r.uc(17,S,4,3,"ng-template",null,14,r.vc)),2&t){const t=r.jc(18);r.ec("visible",e.visible)("showConfirm",!1)("showCancel",!1)("backdropClose",!1)("hasBackdrop",!1),r.yb(6),r.rc("display",e.hidebutton),r.yb(1),r.ec("disabled",!e.auth.add),r.yb(8),r.ec("columns",e.columns)("data",e.data)("index",e.index)("size",e.size)("query",e.query)("total",e.total)("adaptionHeight",e.customeradaption)("bodyColumnTpl",r.gc(16,G,t))}},directives:[k.a,U,O.c,O.a,f.a,q.a,v.a,M.a],styles:[""]}),t})();var $=i("bwiJ");const H=["samplecomponent"],F=["sampletable"];function Q(t,e){if(1&t){const t=r.Pb();r.Ob(0,"div",9),r.Ob(1,"x-link",10),r.Vb("click",(function(){r.lc(t);const i=e.$row;return r.Yb().sampleaction("info",i)})),r.Nb(),r.Ob(2,"x-link",11),r.Vb("click",(function(){r.lc(t);const i=e.$row,a=r.Yb();return!a.disabled&&a.sampleaction("edit",i)})),r.Nb(),r.Ob(3,"x-link",12),r.Vb("click",(function(){r.lc(t);const i=e.$row,a=r.Yb();return!a.disabled&&a.sampleaction("delete",i)})),r.Nb(),r.Nb()}if(2&t){const t=r.Yb();r.yb(2),r.ec("disabled",t.disabled),r.yb(1),r.ec("disabled",t.disabled)}}const X=function(t){return{actions:t}};let Z=(()=>{class t extends _.a{constructor(t,e,i){super(t),this.indexService=t,this.msgBox=e,this.msg=i,this.samplevisible=!1,this.samplesize=20,this.sampleindex=1,this.samplequery={filter:[]},this.sampletotal=0,this.samplecolumns=[{id:"index",label:"\u5e8f\u53f7",width:100,left:0,type:"index"},{id:"actions",label:"\u64cd\u4f5c",width:100,left:100},{id:"samplename",label:"\u6837\u54c1\u540d\u79f0",width:200,sort:!0},{id:"price",label:"\u6837\u54c1\u4ef7\u683c",width:200,sort:!0},{id:"testproject",label:"\u68c0\u6d4b\u9879\u76ee",width:200,sort:!0},{id:"methodname",label:"\u68c0\u6d4b\u65b9\u6cd5",width:200,sort:!0}],this.domaindisabled=!1}ngDoCheck(){}ngOnInit(){this.currentsample=this.getnewsample()}getnewsample(){return{projectid:null!=this.currentproject?this.currentproject.id:void 0,id:u.a.JsNewGuid(),samplename:"",samplequality:"1",price:0,externprice:0,testprojects:[]}}setcopy(t){var e=u.a.deepClone(t);e.id=u.a.JsNewGuid(),this.sampledata.push(e),this.sampledata=[...this.sampledata]}sampleaction(t,e){if("copyadd"==t)return console.log(this.currentsample),void(null!=this.sampletable.activatedRow?this.setcopy(this.sampletable.activatedRow):this.msgBox.alert("\u6ca1\u6709\u590d\u5236\u5bf9\u8c61"));if(this.samplecomponent.type=t,"delete"!=t){var i=-1;null==e?(this.currentsample=this.getnewsample(),this.samplecomponent.currentsample=this.currentsample):(this.currentsample=e,i=this.sampledata.findIndex(t=>t.id==e.id),this.samplecomponent.currentsample=e),0==this.currentproject.mergereport&&this.sampledata.length>0&&0!=i?(this.domaindisabled=!0,this.currentsample.domainid=this.sampledata[0].domainid):this.domaindisabled=!1,this.samplecomponent.getproject(),this.samplevisible=!0}else this.msgBox.confirm({title:"\u63d0\u793a",content:`\u6b64\u64cd\u4f5c\u5c06\u6c38\u4e45\u5220\u9664\u6b64\u6761\u6570\u636e\uff1a${null==e?void 0:e.samplename}\uff0c\u662f\u5426\u7ee7\u7eed\uff1f`,type:"warning",callback:t=>{if("confirm"===t&&null!=e){var i=u.a.setafterdelete(e.id+"",this.sampledata);this.sampledata=[...this.sampledata],this.sampletotal=this.sampledata.length,i>0&&(this.currentsample=this.sampledata[i-1],this.sampletable.activatedRow=this.currentsample)}}})}get disabled(){return"info"==this.type}activechange(t){this.currentsample=t}setsampledata(t){this.sampledata=[],this.sampledata=t,this.currentsample={},this.sampletable.activatedRow=void 0,this.sampledata.length>0&&(this.currentsample=this.sampledata[0],this.sampletable.activatedRow=this.currentsample)}handlesamplechange(t){switch(null!=this.samplecomponent.currentsample&&(this.currentsample=this.samplecomponent.currentsample),t){case"add":this.sampledata.push(this.currentsample),this.sampledata=[...this.sampledata];break;case"edit":var e=this.sampledata[0].domainid;this.sampledata=this.sampledata.map(t=>(0==this.currentproject.mergereport&&(t.domainid=e),t.id==this.currentsample.id?this.currentsample:t))}this.samplevisible=!1}}return t.\u0275fac=function(e){return new(e||t)(r.Ib(l.a),r.Ib(g.c),r.Ib(E.c))},t.\u0275cmp=r.Cb({type:t,selectors:[["app-sample"]],viewQuery:function(t,e){var i;1&t&&(r.Bc(H,!0),r.Bc(F,!0)),2&t&&(r.ic(i=r.Wb())&&(e.samplecomponent=i.first),r.ic(i=r.Wb())&&(e.sampletable=i.first))},features:[r.vb],decls:17,vars:17,consts:[["width","50%","height","60%","placement","top",3,"visible","showConfirm","showCancel","backdropClose","hasBackdrop","visibleChange"],["dialogsample",""],[2,"width","100%","height","100%",3,"currentsample","domaindisabled","sendaddsample"],["samplecomponent",""],["span","2"],["icon","fto-plus","plain","","size","small","type","primary",3,"disabled","click"],["adaptionHeight","520","virtualScroll","","loading","",3,"data","columns","index","size","total","bodyColumnTpl","indexChange","sizeChange","activatedRowChange"],["sampletable",""],["sampleTpl",""],[1,"au-table-actions"],["icon","fto-eye","title","\u67e5\u770b",3,"click"],["icon","fto-edit","title","\u4fee\u6539",3,"disabled","click"],["icon","fto-trash-2","title","\u5220\u9664",3,"disabled","click"]],template:function(t,e){if(1&t&&(r.Ob(0,"x-dialog",0,1),r.Vb("visibleChange",(function(t){return e.samplevisible=t})),r.Ob(2,"app-addsample",2,3),r.Vb("sendaddsample",(function(t){return e.handlesamplechange(t)})),r.Nb(),r.Nb(),r.Ob(4,"x-row"),r.Ob(5,"x-col",4),r.Ob(6,"x-button",5),r.Vb("click",(function(){return!e.disabled&&e.sampleaction("add")})),r.wc(7," \u65b0\u589e "),r.Nb(),r.Nb(),r.Ob(8,"x-col",4),r.Ob(9,"x-button",5),r.Vb("click",(function(){return!e.disabled&&e.sampleaction("copyadd")})),r.wc(10," \u590d\u5236\u65b0\u589e "),r.Nb(),r.Nb(),r.Nb(),r.Ob(11,"x-row"),r.Ob(12,"x-col"),r.Ob(13,"x-table",6,7),r.Vb("indexChange",(function(t){return e.sampleindex=t}))("sizeChange",(function(t){return e.samplesize=t}))("activatedRowChange",(function(t){return e.activechange(t)})),r.Nb(),r.Nb(),r.Nb(),r.uc(15,Q,4,2,"ng-template",null,8,r.vc)),2&t){const t=r.jc(16);r.ec("visible",e.samplevisible)("showConfirm",!1)("showCancel",!1)("backdropClose",!1)("hasBackdrop",!1),r.yb(2),r.ec("currentsample",e.currentsample)("domaindisabled",e.domaindisabled),r.yb(4),r.ec("disabled",e.disabled),r.yb(3),r.ec("disabled",e.disabled),r.yb(4),r.ec("data",e.sampledata)("columns",e.samplecolumns)("index",e.sampleindex)("size",e.samplesize)("total",e.sampletotal)("bodyColumnTpl",r.gc(15,X,t))}},directives:[k.a,$.a,O.c,O.a,f.a,v.a,M.a],styles:[""]}),t})();var tt=i("Prn+"),et=i("4h90"),it=i("ofXK"),at=i("5IKz"),st=i("3Pt+");const ct=["selcustomer"],nt=["sampledata"],rt=["invalidcollectionfee"],ot=["invalidbusinessfee"],lt=["invalidreportcount"],_t=["invalidexternfee"];function dt(t,e){if(1&t&&(r.Ob(0,"div",30),r.wc(1),r.Nb()),2&t){const t=r.Yb();r.yb(1),r.xc(t.invalidinfo)}}function ut(t,e){if(1&t){const t=r.Pb();r.Ob(0,"x-tag",31),r.Vb("close",(function(){r.lc(t);const i=e.$implicit,a=r.Yb();return!a.contactdisabled&&!a.disabled&&a.tagclose(i,"delegate")})),r.wc(1),r.Nb()}if(2&t){const t=e.$implicit,i=r.Yb();r.ec("disabled",i.disabled||i.contactdisabled),r.yb(1),r.xc(t.customername)}}function ht(t,e){if(1&t){const t=r.Pb();r.Ob(0,"x-tag",31),r.Vb("close",(function(){r.lc(t);const i=e.$implicit,a=r.Yb();return!a.contactdisabled&&!a.disabled&&a.tagclose(i,"pay")})),r.wc(1),r.Nb()}if(2&t){const t=e.$implicit,i=r.Yb();r.ec("disabled",i.disabled||i.contactdisabled),r.yb(1),r.xc(t.customername)}}function bt(t,e){if(1&t){const t=r.Pb();r.Ob(0,"x-tag",31),r.Vb("close",(function(){r.lc(t);const i=e.$implicit,a=r.Yb();return!a.contactdisabled&&!a.disabled&&a.tagclose(i,"inspect")})),r.wc(1),r.Nb()}if(2&t){const t=e.$implicit,i=r.Yb();r.ec("disabled",i.disabled||i.contactdisabled),r.yb(1),r.xc(t.customername)}}let pt=(()=>{class t{constructor(t,e,i,a,s,c){this.receiveservice=t,this.sealService=e,this.service=i,this.projectservicetype=a,this.domainservice=s,this.Msg=c,this.projectchange=new r.n,this.currentprojectcount=0,this.currentcontactdisabled=!1,this.multiplereportdata=[{id:0,label:"\u5408\u51fa\u62a5\u544a"},{id:1,label:"\u5206\u51fa\u62a5\u544a"}],this.multiplereport=0,this.judgedata=[{id:1,label:"\u662f"},{id:0,label:"\u5426"}],this.externdata=[{id:1,label:"\u662f"},{id:0,label:"\u5426"}],this.domaindata=[],this.domain=1,this.sealdata=[],this.seal=[],this.ugencyservice=!1,this.standardservice=!0,this.customertype="",this.delegates=[],this.inspects=[],this.pays=[],this.servicetype=1,this.selvisible=!1,this.customeradaption=240,this.hidebutton="none",this.invalidinfo="",this.showTableBoolean=!1,this.currentcontact={},this.disablecls="x-radio x-flex x-justify-start x-align-start x-direction-column",this.samplesourcedata=[],this.samplesource=1}ngOnInit(){this.receiveservice.getList(1,20,{}).subscribe(t=>{this.samplesourcedata=t.list}),this.sealService.getList(1,20,{}).subscribe(t=>{this.sealdata=t.list}),this.projectservicetype.getList(1,20,{}).subscribe(t=>{this.servicetypedata=t.list}),this.domainservice.getList(1,20,{}).subscribe(t=>{this.domaindata=t.list}),setTimeout(()=>{this.showTableBoolean=!0},0)}setinit(t){if(this.currentprojectcount=t,null!=this.currentproject.samples&&(this.sampledata.type=this.type,this.sampledata.currentproject=this.currentproject,this.sampledata.setsampledata(this.currentproject.samples)),this.delegates=[],this.pays=[],this.inspects=[],null!=this.currentcontact){if(null!=this.currentcontact.contactcustomers&&0!=this.currentcontact.contactcustomers.length&&this.currentcontact.contactcustomers.map(t=>{1==t.customertype&&this.delegates.push({id:t.customerid+"",customername:t.customername}),2==t.customertype&&this.pays.push({id:t.customerid+"",customername:t.customername}),3==t.customertype&&this.inspects.push({id:t.customerid+"",customername:t.customername})}),null!=this.currentcontact.seal){this.seal=[];for(var e=0;e<this.currentcontact.seal.length;e++)this.seal.push(Number(this.currentcontact.seal[e].id))}null!=this.currentcontact.service&&(this.servicetype=Number(this.currentcontact.service.id)),null!=this.currentcontact.samplesource&&(this.samplesource=Number(this.currentcontact.samplesource.id))}}set contactdisabled(t){this.currentcontactdisabled=t}get contactdisabled(){return this.currentcontactdisabled}selconfirm(){switch(this.customertype){case"delegate":this.delegates=this.selcustomer.seldata;break;case"pay":this.pays=[this.selcustomer.customtable.activatedRow];break;case"inspect":this.inspects=[this.selcustomer.customtable.activatedRow]}}tagclose(t,e){switch(e){case"delegate":this.deletetag(this.delegates,t.id+"");break;case"pay":this.deletetag(this.pays,t.id+"");break;case"inspect":this.deletetag(this.inspects,t.id+"")}}deletetag(t,e){var i=t.findIndex(t=>t.id==e);-1!=i&&t.splice(i,1)}get formInvalid(){var t,e,i;return this.invalidinfo="",null!=this.delegates&&0==this.delegates.length?(this.invalidinfo="\u5ba2\u6237\u4e0d\u80fd\u4e3a\u7a7a",!0):null!=this.invalidcollectionfee&&null!=this.invalidcollectionfee.value&&isNaN(this.invalidcollectionfee.value)?(this.invalidinfo="\u91c7\u6837\u8d39\u4e0d\u662f\u6570\u5b57",!0):null!=this.invalidbusinessfee&&null!=this.invalidbusinessfee.value&&isNaN(this.invalidbusinessfee.value)?(this.invalidinfo="\u4e1a\u52a1\u8d39\u4e0d\u662f\u6570\u5b57",!0):null==this.invalidreportcount||null==this.invalidreportcount.value||/^[0-9]{1,10}$/.test(this.invalidreportcount.value)?null!=this.invalidexternfee&&null!=this.invalidexternfee.value&&isNaN(this.invalidexternfee.value)?(this.invalidinfo="\u5916\u5305\u8d39\u4e0d\u662f\u6570\u5b57",!0):null!=this.sampledata&&null!=(null===(t=this.sampledata)||void 0===t?void 0:t.sampledata)&&0==(null===(i=null===(e=this.sampledata)||void 0===e?void 0:e.sampledata)||void 0===i?void 0:i.length)&&(this.invalidinfo="\u6837\u54c1\u4e0d\u80fd\u4e3a\u7a7a",!0):(this.invalidinfo="\u62a5\u544a\u4efd\u6570\u4e0d\u662f\u6570\u5b57",!0)}get disabled(){return"info"==this.type}setproject(){var t,e,i;if(!this.contactdisabled&&null!=this.currentcontact){null!=this.currentcontact.contactcustomers&&(this.currentcontact.contactcustomers=[],this.delegates.map(t=>{null!=this.currentcontact.contactcustomers&&this.currentcontact.contactcustomers.push({contactid:this.currentcontact.id+"",customerid:t.id,customername:t.customername,customertype:1})}),this.pays.length>0&&this.currentcontact.contactcustomers.push({contactid:this.currentcontact.id+"",customerid:this.pays[0].id,customername:this.pays[0].customername,customertype:2}),this.inspects.length>0&&this.currentcontact.contactcustomers.push({contactid:this.currentcontact.id+"",customerid:this.inspects[0].id,customername:this.inspects[0].customername,customertype:3})),this.currentcontact.samplesource=this.getpr(this.samplesource+"",this.samplesourcedata),this.currentcontact.seal=[];for(var a=0;a<this.seal.length;a++)console.log(null===(t=this.currentcontact.seal)||void 0===t?void 0:t.findIndex(t=>t.id==this.seal[a].id)),-1==(null===(e=this.currentcontact.seal)||void 0===e?void 0:e.findIndex(t=>t.id==this.seal[a].id))&&(null===(i=this.currentcontact.seal)||void 0===i||i.push(this.getpr(this.seal[a]+"",this.sealdata)));this.currentcontact.service=this.getpr(this.servicetype+"",this.servicetypedata)}null!=this.currentproject&&this.sampledata.sampledata.length>0&&(this.currentproject.domain=this.getpr(this.sampledata.sampledata[0].domainid+"",this.domaindata),this.currentproject.samples=this.sampledata.sampledata)}getpr(t,e){var i=e.find(e=>e.id==t);return null!=i?i:{}}setmultiproject(t){if(1==this.currentproject.mergereport){if(null!=this.currentproject.samples)for(var e=0;e<this.currentproject.samples.length;e++){var i={};for(var a in this.currentproject)i[a]=this.currentproject[a];i.samples=[],i.id=u.a.JsNewGuid();var s={};for(var a in this.currentproject.samples[e])s[a]=this.currentproject.samples[e][a];s.projectid=i.id,i.samples.push(s);var c=this.domaindata.find(t=>t.id==s.domainid);null!=c&&(i.domain=c),i.projectnumber=i.projectnumber+""+(this.currentprojectcount+e+1),t.push(i)}}else 0==this.currentproject.projectstatus&&(this.currentproject.projectnumber="\u4e34\u65f6\u9879\u76ee"+(this.currentprojectcount+1)),t.push(this.currentproject)}action(t){switch(t){case"save":this.setproject();var e=[];this.setmultiproject(e),"add"==this.type?this.service.post({id:u.a.JsNewGuid(),projects:e}).subscribe(t=>{this.projectchange.emit(t.projects),this.Msg.success("\u6dfb\u52a0\u6210\u529f")}):"edit"==this.type&&(1==e.length?this.service.put({id:u.a.JsNewGuid(),projects:e}).subscribe(t=>{this.projectchange.emit(t.projects),this.Msg.success("\u4fee\u6539\u6210\u529f")}):this.service.delete(this.currentproject.id+"").subscribe(t=>{this.service.post({id:u.a.JsNewGuid(),projects:e}).subscribe(t=>{this.projectchange.emit(t.projects)})}));break;case"cancel":this.projectchange.emit(void 0)}}addcustomer(t){switch(this.selvisible=!0,this.customertype=t,t){case"delegate":this.selcustomer.seldata=this.delegates,this.selcustomer.setselect();break;case"pay":this.selcustomer.seldata=this.pays,this.selcustomer.setselect(!1);break;case"inspect":this.selcustomer.seldata=this.inspects,this.selcustomer.setselect(!1)}}}return t.\u0275fac=function(e){return new(e||t)(r.Ib(m.b),r.Ib(m.c),r.Ib(m.a),r.Ib(m.d),r.Ib(w.d),r.Ib(E.c))},t.\u0275cmp=r.Cb({type:t,selectors:[["app-addbusinessproject"]],viewQuery:function(t,e){var i;1&t&&(r.Bc(ct,!0),r.Bc(nt,!0),r.Bc(rt,!0),r.Bc(ot,!0),r.Bc(lt,!0),r.Bc(_t,!0)),2&t&&(r.ic(i=r.Wb())&&(e.selcustomer=i.first),r.ic(i=r.Wb())&&(e.sampledata=i.first),r.ic(i=r.Wb())&&(e.invalidcollectionfee=i.first),r.ic(i=r.Wb())&&(e.invalidbusinessfee=i.first),r.ic(i=r.Wb())&&(e.invalidreportcount=i.first),r.ic(i=r.Wb())&&(e.invalidexternfee=i.first))},inputs:{currentproject:"currentproject"},outputs:{projectchange:"projectchange"},decls:89,vars:37,consts:[["width","50%","height","30%","placement","top",3,"visible","visibleChange","confirm"],["Seldialog",""],[2,"width","100%","height","100%",3,"customeradaption","hidebutton"],["selcustomer",""],[1,"au-inner","au-column"],["id","displaytag","style","color: crimson;font-size: 10pt;",4,"ngIf"],["plain","","icon","fto-plus","size","small",2,"flex","1",3,"disabled","click"],[1,"row"],["type","info","style","flex:1;","closable","",3,"disabled","close",4,"ngFor","ngForOf"],["plain","","size","small","icon","fto-plus",2,"flex","1",3,"disabled","click"],[2,"height","20px"],["span","2"],["span","7"],[3,"disabled","data","ngModel","ngModelChange"],["span","5"],["span","2",1,"x-radio-label"],["span","4"],["span","1",1,"x-radio-label"],[3,"disabled","ngModel","ngModelChange"],["invalidcollectionfee",""],["invalidbusinessfee",""],["invalidexternfee",""],["span","1"],["invalidreportcount",""],[2,"height","30px"],["sampledata",""],[2,"width","90%"],[2,"width","5%"],["plain","","icon","fto-chevron-left",3,"click"],["icon","fto-save","type","primary","plain","",3,"disabled","click"],["id","displaytag",2,"color","crimson","font-size","10pt"],["type","info","closable","",2,"flex","1",3,"disabled","close"]],template:function(t,e){1&t&&(r.Ob(0,"x-dialog",0,1),r.Vb("visibleChange",(function(t){return e.selvisible=t}))("confirm",(function(){return e.selconfirm()})),r.Jb(2,"app-customer",2,3),r.Nb(),r.Ob(4,"x-inner",4),r.uc(5,dt,2,1,"div",5),r.Ob(6,"x-row"),r.Ob(7,"table"),r.Ob(8,"tr"),r.Ob(9,"td"),r.Ob(10,"x-button",6),r.Vb("click",(function(){return!e.contactdisabled&&!e.disabled&&e.addcustomer("delegate")})),r.wc(11,"\u6dfb\u52a0\u59d4\u6258\u5ba2\u6237"),r.Nb(),r.Nb(),r.Ob(12,"td"),r.Ob(13,"div",7),r.uc(14,ut,2,2,"x-tag",8),r.Nb(),r.Nb(),r.Ob(15,"td"),r.Ob(16,"x-button",6),r.Vb("click",(function(){return!e.contactdisabled&&!e.disabled&&e.addcustomer("pay")})),r.wc(17,"\u6dfb\u52a0\u4ed8\u6b3e\u5355\u4f4d"),r.Nb(),r.Nb(),r.Ob(18,"td"),r.uc(19,ht,2,2,"x-tag",8),r.Nb(),r.Ob(20,"td"),r.Ob(21,"x-button",9),r.Vb("click",(function(){return!e.contactdisabled&&!e.disabled&&e.addcustomer("inspect")})),r.wc(22,"\u6dfb\u52a0\u53d7\u68c0\u5355\u4f4d"),r.Nb(),r.Nb(),r.Ob(23,"td"),r.uc(24,bt,2,2,"x-tag",8),r.Nb(),r.Nb(),r.Nb(),r.Nb(),r.Jb(25,"x-row",10),r.Ob(26,"x-row"),r.Ob(27,"x-col",11),r.wc(28,"\u6837\u54c1\u6765\u6e90"),r.Nb(),r.Ob(29,"x-col",12),r.Ob(30,"x-radio",13),r.Vb("ngModelChange",(function(t){return e.samplesource=t})),r.Nb(),r.Nb(),r.Ob(31,"x-col",11),r.wc(32,"\u662f\u5426\u5224\u5b9a"),r.Nb(),r.Ob(33,"x-col",14),r.Ob(34,"x-radio",13),r.Vb("ngModelChange",(function(t){return e.currentcontact.isjudgement=t})),r.Nb(),r.Nb(),r.Ob(35,"x-col",11),r.wc(36,"\u662f\u5426\u5916\u5305"),r.Nb(),r.Ob(37,"x-col",14),r.Ob(38,"x-radio",13),r.Vb("ngModelChange",(function(t){return e.currentcontact.isextern=t})),r.Nb(),r.Nb(),r.Nb(),r.Jb(39,"x-row",10),r.Ob(40,"x-row"),r.Ob(41,"x-col",11),r.wc(42,"\u8d44\u8d28\u76d6\u7ae0"),r.Nb(),r.Ob(43,"x-col",12),r.Ob(44,"x-checkbox",13),r.Vb("ngModelChange",(function(t){return e.seal=t})),r.Nb(),r.Nb(),r.Ob(45,"x-col",11),r.wc(46,"\u670d\u52a1\u7c7b\u578b"),r.Nb(),r.Ob(47,"x-col",14),r.Ob(48,"x-radio",13),r.Vb("ngModelChange",(function(t){return e.servicetype=t})),r.Nb(),r.Nb(),r.Nb(),r.Jb(49,"x-row",10),r.Ob(50,"x-row"),r.Ob(51,"x-col",15),r.wc(52,"\u62a5\u544a\u5f62\u5f0f"),r.Nb(),r.Ob(53,"x-col",16),r.Ob(54,"x-radio",13),r.Vb("ngModelChange",(function(t){return e.currentproject.mergereport=t})),r.Nb(),r.Nb(),r.Ob(55,"x-col",17),r.wc(56,"\u91c7\u6837\u8d39"),r.Nb(),r.Ob(57,"x-col",11),r.Ob(58,"x-input",18,19),r.Vb("ngModelChange",(function(t){return e.currentcontact.collectionfee=t})),r.Nb(),r.Nb(),r.Ob(60,"x-col",17),r.wc(61,"\u4e1a\u52a1\u8d39"),r.Nb(),r.Ob(62,"x-col",11),r.Ob(63,"x-input",18,20),r.Vb("ngModelChange",(function(t){return e.currentcontact.businessfee=t})),r.Nb(),r.Nb(),r.Ob(65,"x-col",17),r.wc(66,"\u5916\u5305\u8d39"),r.Nb(),r.Ob(67,"x-col",11),r.Ob(68,"x-input",18,21),r.Vb("ngModelChange",(function(t){return e.currentcontact.externfee=t})),r.Nb(),r.Nb(),r.Ob(70,"x-col",11),r.wc(71,"\u62a5\u544a\u4efd\u6570"),r.Nb(),r.Ob(72,"x-col",22),r.Ob(73,"x-input",18,23),r.Vb("ngModelChange",(function(t){return e.currentproject.reportcount=t})),r.Nb(),r.Nb(),r.Nb(),r.Jb(75,"x-row",24),r.Ob(76,"x-row"),r.Jb(77,"app-sample",null,25),r.Nb(),r.Ob(79,"x-row"),r.Ob(80,"table"),r.Ob(81,"tr"),r.Jb(82,"td",26),r.Ob(83,"td",27),r.Ob(84,"x-button",28),r.Vb("click",(function(){return e.action("cancel")})),r.wc(85,"\u8fd4\u56de"),r.Nb(),r.Nb(),r.Ob(86,"td",27),r.Ob(87,"x-button",29),r.Vb("click",(function(){return!e.disabled&&!e.formInvalid&&e.action("save")})),r.wc(88," \u4fdd\u5b58 "),r.Nb(),r.Nb(),r.Nb(),r.Nb(),r.Nb(),r.Nb()),2&t&&(r.ec("visible",e.selvisible),r.yb(2),r.ec("customeradaption",e.customeradaption)("hidebutton",e.hidebutton),r.yb(3),r.ec("ngIf",e.showTableBoolean),r.yb(5),r.ec("disabled",e.disabled||e.contactdisabled),r.yb(4),r.ec("ngForOf",e.delegates),r.yb(2),r.ec("disabled",e.disabled||e.contactdisabled),r.yb(3),r.ec("ngForOf",e.pays),r.yb(2),r.ec("disabled",e.disabled||e.contactdisabled),r.yb(3),r.ec("ngForOf",e.inspects),r.yb(6),r.ec("disabled",e.disabled||e.contactdisabled)("data",e.samplesourcedata)("ngModel",e.samplesource),r.yb(4),r.ec("disabled",e.disabled||e.contactdisabled)("data",e.judgedata)("ngModel",e.currentcontact.isjudgement),r.yb(4),r.ec("disabled",e.disabled||e.contactdisabled)("data",e.externdata)("ngModel",e.currentcontact.isextern),r.yb(6),r.ec("disabled",e.disabled||e.contactdisabled)("data",e.sealdata)("ngModel",e.seal),r.yb(4),r.ec("disabled",e.disabled||e.contactdisabled)("data",e.servicetypedata)("ngModel",e.servicetype),r.yb(6),r.ec("disabled",e.disabled)("data",e.multiplereportdata)("ngModel",e.currentproject.mergereport),r.yb(4),r.ec("disabled",e.disabled||e.contactdisabled)("ngModel",e.currentcontact.collectionfee),r.yb(5),r.ec("disabled",e.disabled||e.contactdisabled)("ngModel",e.currentcontact.businessfee),r.yb(5),r.ec("disabled",e.disabled||e.contactdisabled)("ngModel",e.currentcontact.externfee),r.yb(5),r.ec("disabled",e.disabled)("ngModel",e.currentproject.reportcount),r.yb(14),r.ec("disabled",e.formInvalid||e.disabled))},directives:[k.a,Y,W.a,it.t,O.c,f.a,it.s,O.a,at.a,st.q,st.t,tt.a,q.a,Z,et.a],styles:[""]}),t})();const mt=["projectlist"],gt=["addbusiness"];function Et(t,e){if(1&t){const t=r.Pb();r.Ob(0,"div",10),r.Ob(1,"x-link",11),r.Vb("click",(function(){r.lc(t);const i=e.$row,a=r.Yb();return a.auth.info&&a.action("info",i)})),r.Nb(),r.Ob(2,"x-link",12),r.Vb("click",(function(){r.lc(t);const i=e.$row,a=r.Yb();return!a.disabled(i)&&a.auth.edit&&a.action("edit",i)})),r.Nb(),r.Ob(3,"x-link",13),r.Vb("click",(function(){r.lc(t);const i=e.$row,a=r.Yb();return!a.disabled(i)&&a.auth.delete&&a.action("delete",i)})),r.Nb(),r.Nb()}if(2&t){const t=e.$row,i=r.Yb();r.yb(1),r.ec("disabled",!i.auth.info),r.yb(1),r.ec("disabled",!i.auth.edit||i.disabled(t)),r.yb(1),r.ec("disabled",!i.auth.delete||i.disabled(t))}}const Ot=function(t){return{actions:t}};let ft=(()=>{class t extends _.a{constructor(t,e,i,a){super(t),this.indexService=t,this.service=e,this.msgBox=i,this.msg=a,this.ProjectsChange=new r.n,this.type="add",this.visible=!1,this.columns=[{id:"actions",label:"\u64cd\u4f5c",width:100},{id:"projectnumber",label:"\u9879\u76ee\u7f16\u53f7",width:150,sort:!0},{id:"domainlabel",label:"\u9886\u57df",width:150,sort:!0}],this.size=20,this.index=1,this.query={filter:[]},this.total=0,this.activeprojectid="",this.currentproject={mergereport:1,reportcount:2},this.contactdisabled=!1,this.auth={}}ngOnInit(){}setproject(t){var e;null!=t&&(t.domainlabel=null===(e=t.domain)||void 0===e?void 0:e.label)}projectchange(t){if(this.visible=!1,null!=t){var e=t.findIndex(t=>t.id==this.currentproject.id),i=this.data.findIndex(t=>t.id==this.currentproject.id);-1==e&&-1!=i&&this.data.splice(i,1);for(var a=0;a<t.length;a++){this.setproject(t[a]);var s=this.data.findIndex(e=>e.id==t[a].id);-1==s?this.data.push(t[a]):this.data.splice(s,1,t[a])}this.data=[...this.data],null!=this.ProjectsChange&&this.ProjectsChange.emit(this.data)}}copayaction(t){if(null!=this.projectlist.activatedRow){var e=u.a.deepClone(this.currentproject);console.log(e),e.id=u.a.JsNewGuid(),e.projectstatus=0,e.samples.map(t=>{t.projectid=e.id,t.id=u.a.JsNewGuid(),t.testprojects.map(e=>{e.sampleid=t.id})}),e.projectnumber=e.projectnumber+"\u590d\u4ef6",this.service.post({id:u.a.JsNewGuid(),projects:[e]}).subscribe(t=>{this.data.push(e),this.data=[...this.data],this.projectlist.activatedRow=e,this.currentproject=e,null!=this.ProjectsChange&&this.ProjectsChange.emit(this.data)})}}activechange(t){this.currentproject=t}getproject(){var t=u.a.JsNewGuid();return{contactid:this.currentcontact.id+"",id:t,projectnumber:"\u4e34\u65f6\u9879\u76ee",reportcount:2,domain:{id:1},mergereport:0,samples:[]}}setswitch(t,e){this.visible=!0,this.addbusiness.type=t,this.addbusiness.currentproject=e,this.currentproject=e,this.addbusiness.currentcontact=this.currentcontact,this.addbusiness.setinit(this.data.length)}action(t,e){switch(this.addbusiness.contactdisabled=!1,this.contactdisabled=!1,t){case"add":null!=this.currentcontact&&null!=this.currentcontact.id&&(this.data.length>0&&(this.addbusiness.contactdisabled=!0,this.contactdisabled=!0),this.setswitch(t,this.getproject()));break;case"info":e.mergereport=0,this.setswitch(t,e);break;case"edit":e.mergereport=0,this.data.findIndex(t=>t.id==e.id)>0&&(this.addbusiness.contactdisabled=!0,this.contactdisabled=!0),this.setswitch(t,e);break;case"delete":this.msgBox.confirm({title:"\u63d0\u793a",content:`\u6b64\u64cd\u4f5c\u5c06\u6c38\u4e45\u5220\u9664\u6b64\u6761\u6570\u636e\uff1a${e.id}\uff0c\u662f\u5426\u7ee7\u7eed\uff1f`,type:"warning",callback:t=>{"confirm"===t&&this.service.delete(e.id).subscribe(t=>{var i=this.data.findIndex(t=>t.id==e.id);-1!=i&&(this.data.splice(i,1),this.msg.success("\u5220\u9664\u6210\u529f"),this.data=[...this.data],0!=i?this.projectlist.activatedRow=this.data[i-1]:0==i&&this.data.length>0&&(this.projectlist.activatedRow=this.data[0]))})}})}}disabled(t){return!(null==t||!t.submit)}IndexChange(t){}getdata(){this.data=[],this.currentproject={},this.projectlist.activatedRow=void 0,this.total=0,null!=this.currentcontact&&null!=this.currentcontact.id&&(this.query={filter:[{field:"contactid",value:this.currentcontact.id+"",operation:"="}]},this.service.getList(this.index,this.size,this.query).subscribe(t=>{if([this.data,this.total]=[t.list,Number(t.total)],this.data.map(t=>{this.setproject(t)}),""!=this.activeprojectid){var e=this.data.findIndex(t=>t.id==this.activeprojectid);this.currentproject=-1!=e?this.data[e]:this.data[0]}else this.data.length>0&&(this.currentproject=this.data[0]);this.projectlist.activatedRow=this.currentproject}))}}return t.\u0275fac=function(e){return new(e||t)(r.Ib(l.a),r.Ib(m.a),r.Ib(g.c),r.Ib(E.c))},t.\u0275cmp=r.Cb({type:t,selectors:[["app-businessproject"]],viewQuery:function(t,e){var i;1&t&&(r.Bc(mt,!0),r.Bc(gt,!0)),2&t&&(r.ic(i=r.Wb())&&(e.projectlist=i.first),r.ic(i=r.Wb())&&(e.addbusiness=i.first))},inputs:{auth:"auth"},outputs:{ProjectsChange:"ProjectsChange"},features:[r.vb],decls:17,vars:18,consts:[["width","70%","height","80%","placement","top",3,"visible","showConfirm","showCancel","backdropClose","hasBackdrop","visibleChange"],["dialogcustomer",""],[2,"width","100%","height","100%",3,"currentproject","projectchange"],["addbusiness",""],["span","6"],["icon","fto-plus","plain","",3,"disabled","click"],["span","5"],["virtualScroll","","loading","",3,"data","columns","index","size","total","query","adaptionHeight","bodyColumnTpl","indexChange","sizeChange","activatedRowChange"],["projectlist",""],["contactTpl",""],[1,"au-table-actions"],["icon","fto-eye","title","\u67e5\u770b",3,"disabled","click"],["icon","fto-edit","title","\u4fee\u6539",3,"disabled","click"],["icon","fto-trash-2","title","\u5220\u9664",3,"disabled","click"]],template:function(t,e){if(1&t&&(r.Ob(0,"x-dialog",0,1),r.Vb("visibleChange",(function(t){return e.visible=t})),r.Ob(2,"app-addbusinessproject",2,3),r.Vb("projectchange",(function(t){return e.projectchange(t)})),r.Nb(),r.Nb(),r.Ob(4,"x-row"),r.Ob(5,"x-col",4),r.Ob(6,"x-button",5),r.Vb("click",(function(){return e.auth.add&&e.action("add")})),r.wc(7," \u65b0\u589e "),r.Nb(),r.Nb(),r.Ob(8,"x-col",6),r.Ob(9,"x-button",5),r.Vb("click",(function(){return e.auth.add&&e.copayaction("add")})),r.wc(10," \u590d\u5236\u65b0\u589e "),r.Nb(),r.Nb(),r.Nb(),r.Ob(11,"x-row"),r.Ob(12,"x-col"),r.Ob(13,"x-table",7,8),r.Vb("indexChange",(function(t){return e.index=t}))("sizeChange",(function(t){return e.size=t}))("activatedRowChange",(function(t){return e.activechange(t)}))("indexChange",(function(t){return e.IndexChange(t)})),r.Nb(),r.Nb(),r.Nb(),r.uc(15,Et,4,3,"ng-template",null,9,r.vc)),2&t){const t=r.jc(16);r.ec("visible",e.visible)("showConfirm",!1)("showCancel",!1)("backdropClose",!1)("hasBackdrop",!1),r.yb(2),r.ec("currentproject",e.currentproject),r.yb(4),r.ec("disabled",!e.auth.add),r.yb(3),r.ec("disabled",!e.auth.add),r.yb(4),r.ec("data",e.data)("columns",e.columns)("index",e.index)("size",e.size)("total",e.total)("query",e.query)("adaptionHeight",124)("bodyColumnTpl",r.gc(16,Ot,t))}},directives:[k.a,pt,O.c,O.a,f.a,v.a,M.a],styles:[""]}),t})();const vt=["contactlist"],Mt=["businessprojectlist"],Ct=["customerlist"],Pt=[{path:"",component:(()=>{class t extends _.a{constructor(t,e,i,a){super(t),this.indexService=t,this.contactService=e,this.activatedRoute=i,this.flowservice=a,this.collectionform=[{id:1,label:"\u91c7\u6837"},{id:2,label:"\u9001\u6837"},{id:3,label:"\u90ae\u5bc4"}],this.collectionmodel=1,this.weituomodel=1,this.standprice=2300.45,this.discountprice=1800.97,this.styleset="display:none",this.showTableBoolean=!1,this.showTableBooleancon=!1,this.showTableBooleanpr=!1,this.taskprojectid="",this.taskcustomerid=0,this.taskcontactid="",this.activatedRoute.params.subscribe(t=>{null!=t.projectid?this.flowservice.getcontactbyproject(t.contactid).subscribe(t=>{this.taskprojectid=t.projectid,this.taskcustomerid=t.customerid,this.taskcontactid=t.contactid}):this.taskcustomerid=-1})}changeCustomer(t){null!=this.taskcustomerid&&-1!=this.taskcustomerid&&this.customerlist.setActive(this.taskcustomerid),this.contactlist.activeid="",-1!=this.taskcustomerid&&(this.contactlist.activeid=this.taskcontactid),this.contactlist.customer=this.customerlist.currentCustomer,this.contactlist.getcontactdata(!0)}contactChange(t){var e;if(0==this.contactlist.contactdata.length)this.businessprojectlist.currentcontact={},this.businessprojectlist.currentproject={};else{var i=null===(e=t.contactcustomers)||void 0===e?void 0:e.findIndex(t=>null!=t.customertype&&1==t.customertype);console.log(t),-1!=i&&null!=i||(console.log("32"),t.contactcustomers=[{contactid:t.id+"",customername:this.contactlist.customer.customername,customerid:this.contactlist.customer.id,customertype:1},{contactid:t.id+"",customername:this.contactlist.customer.customername,customerid:this.contactlist.customer.id,customertype:2},{contactid:t.id+"",customername:this.contactlist.customer.customername,customerid:this.contactlist.customer.id,customertype:3}],t.isjudgement=0,t.judgement="",t.judgementstandard="",t.service={id:1},t.samplesource={id:1},t.seal=[{id:1}],t.collectionfee=0,t.externfee=0,t.businessfee=0),this.businessprojectlist.currentcontact=t}this.businessprojectlist.getdata(),null!=this.taskprojectid&&""!=this.taskprojectid&&(this.businessprojectlist.activeprojectid=this.taskprojectid)}setdis(){this.styleset="display:inline"}ProjectsChange(t){var e,i,a;this.contactlist.currentContact.testfee=0,this.contactlist.currentContact.standardfee=0;var s=0;t.map(t=>{var e;s+=50*(Number(t.reportcount)-2),null===(e=t.samples)||void 0===e||e.map(t=>{this.contactlist.currentContact.testfee=Number(this.contactlist.currentContact.testfee)+Number(t.price),this.contactlist.currentContact.standardfee=Number(this.contactlist.currentContact.standardfee)+Number(t.standardfee)})}),2==(null===(e=this.contactlist.currentContact.service)||void 0===e?void 0:e.id)&&(this.contactlist.currentContact.standardfee=2*Number(this.contactlist.currentContact.standardfee)),3==(null===(i=this.contactlist.currentContact.service)||void 0===i?void 0:i.id)&&(this.contactlist.currentContact.standardfee=1.5*Number(this.contactlist.currentContact.standardfee)),0!=this.contactlist.currentContact.standardfee&&(this.contactlist.currentContact.discount=Object(n.round)(Number(this.contactlist.currentContact.testfee)/Number(this.contactlist.currentContact.standardfee)*100)/100),this.contactlist.currentContact.totalfee=Object(n.round)(100*(Number(this.contactlist.currentContact.testfee)+Number(this.contactlist.currentContact.businessfee)+Number(this.contactlist.currentContact.collectionfee)+s+Number(this.contactlist.currentContact.externfee)))/100,this.contactlist.currentContact.ugency=null===(a=this.contactlist.currentContact.service)||void 0===a?void 0:a.label,this.businessprojectlist.contactdisabled||this.contactService.updatecontactinfo(this.contactlist.currentContact).subscribe(t=>console.log(t)),this.contactlist.refreshdata()}ngDoCheck(){}setweituodanname(){}ngAfterContentInit(){}ngOnInit(){setTimeout(()=>{this.showTableBoolean=!0},0),setTimeout(()=>{this.showTableBooleancon=!0},0),setTimeout(()=>{this.showTableBooleanpr=!0},0)}}return t.\u0275fac=function(e){return new(e||t)(r.Ib(l.a),r.Ib(d.a),r.Ib(a.a),r.Ib(b.a))},t.\u0275cmp=r.Cb({type:t,selectors:[["app-evirmentheath"]],viewQuery:function(t,e){var i;1&t&&(r.Bc(vt,!0),r.Bc(Mt,!0),r.Bc(Ct,!0)),2&t&&(r.ic(i=r.Wb())&&(e.contactlist=i.first),r.ic(i=r.Wb())&&(e.businessprojectlist=i.first),r.ic(i=r.Wb())&&(e.customerlist=i.first))},features:[r.xb([o]),r.vb],decls:23,vars:5,consts:[["span","16"],["au-adaption","",1,"au-panel","au-content",3,"outerHeight"],[2,"text-align","center","font-weight","bolder","font-size","12pt"],[3,"auth","ChangeCustomer"],["customerlist",""],[3,"auth","contactChange"],["contactlist",""],["span","8"],[3,"auth","ProjectsChange"],["businessprojectlist",""]],template:function(t,e){1&t&&(r.Ob(0,"x-row"),r.Ob(1,"x-col",0),r.Ob(2,"div",1),r.Ob(3,"x-row"),r.Ob(4,"x-col",2),r.wc(5,"\u5ba2\u6237\u4fe1\u606f"),r.Nb(),r.Nb(),r.Ob(6,"x-row"),r.Ob(7,"app-customer",3,4),r.Vb("ChangeCustomer",(function(t){return e.changeCustomer(t)})),r.Nb(),r.Nb(),r.Ob(9,"x-row"),r.Ob(10,"x-col",2),r.wc(11," \u5ba2\u6237\u5408\u540c\u5217\u8868 "),r.Nb(),r.Nb(),r.Ob(12,"x-row"),r.Ob(13,"app-contact",5,6),r.Vb("contactChange",(function(t){return e.contactChange(t)})),r.Nb(),r.Nb(),r.Nb(),r.Nb(),r.Ob(15,"x-col",7),r.Ob(16,"div",1),r.Ob(17,"x-row"),r.Ob(18,"x-col",2),r.wc(19," \u59d4\u6258\u5355\u57fa\u672c\u4fe1\u606f "),r.Nb(),r.Nb(),r.Ob(20,"x-row"),r.Ob(21,"app-businessproject",8,9),r.Vb("ProjectsChange",(function(t){return e.ProjectsChange(t)})),r.Nb(),r.Nb(),r.Nb(),r.Nb(),r.Nb()),2&t&&(r.yb(2),r.ec("outerHeight",0),r.yb(5),r.ec("auth",e.auth),r.yb(6),r.ec("auth",e.auth),r.yb(3),r.ec("outerHeight",0),r.yb(5),r.ec("auth",e.auth))},directives:[O.c,O.a,L.a,Y,x,ft],encapsulation:2}),t})()}];let Dt=(()=>{class t{}return t.\u0275mod=r.Gb({type:t}),t.\u0275inj=r.Fb({factory:function(e){return new(e||t)},imports:[[a.i.forChild(Pt)],a.i]}),t})();var xt=i("gjGi"),wt=i("hHlV"),It=i("873N"),yt=i("iaau"),Bt=i("Z77y"),jt=i("oJeN"),Tt=i("aMyR");let Rt=(()=>{class t{}return t.\u0275mod=r.Gb({type:t}),t.\u0275inj=r.Fb({factory:function(e){return new(e||t)},imports:[[it.c,Dt,Tt.a,wt.a,jt.b,f.b,q.b,tt.b,xt.a,yt.a,v.b,q.b,It.a,at.b,Bt.b,k.b,et.b]]}),t})()}}]);
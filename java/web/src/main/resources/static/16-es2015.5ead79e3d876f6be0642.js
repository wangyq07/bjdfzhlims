(window.webpackJsonp=window.webpackJsonp||[]).push([[16],{"873N":function(e,t,i){"use strict";i.d(t,"a",(function(){return n}));var s=i("ofXK"),r=i("fXoL");let n=(()=>{class e{}return e.\u0275mod=r.Gb({type:e}),e.\u0275inj=r.Fb({factory:function(t){return new(t||e)},imports:[[s.c]]}),e})()},K7LP:function(e,t,i){"use strict";i.d(t,"a",(function(){return s}));class s{constructor(e){this.indexService=e,this.auth={};let t=this.indexService.menuChange.subscribe(e=>{this.baseInit(),t.unsubscribe()})}baseInit(){var e,t,i,s,r;this.menu=null===(t=null===(e=this.indexService.auth.user.permissions)||void 0===e?void 0:e.menus)||void 0===t?void 0:t.find(e=>e.router==this.indexService.session.activatedPage),this.actions=null===(s=null===(i=this.indexService.auth.user.permissions)||void 0===i?void 0:i.actions)||void 0===s?void 0:s.filter(e=>{var t;return e.menuId==(null===(t=this.menu)||void 0===t?void 0:t.id)}),null===(r=this.actions)||void 0===r||r.forEach(e=>this.auth[e.code]=!0)}unAuth(e){return!this.auth[e]}}},MMwC:function(e,t,i){"use strict";i.r(t),i.d(t,"FlownodeModule",(function(){return M}));var s=i("ofXK"),r=i("tyNb"),n=i("vkgz"),o=i("lJxs"),a=i("wTjX"),c=i("bRdP"),l=i("NtM8"),d=i("fXoL");let u=(()=>{class e extends c.a{constructor(e){super(e,{controller:{name:"flownodes",servicetype:"flowprocess"}}),this.http=e}}return e.\u0275fac=function(t){return new(t||e)(d.Sb(l.a))},e.\u0275prov=d.Eb({token:e,factory:e.\u0275fac,providedIn:"root"}),e})();var b=i("K7LP"),h=i("M9h8"),f=i("OUFp"),p=i("r3AK"),v=i("TPaT"),m=i("qMpK"),g=i("x6Xy"),w=i("GvSL"),y=i("1uEr"),x=i("Atug"),O=i("kXfN"),k=i("/pOC"),I=i("MOn6"),j=i("hMyc"),N=i("ZQZ3");const G=["treeCom"],S=["form"],A=[{path:"",component:(()=>{class e extends b.a{constructor(e,t,i,s,r,a,c,l,d){super(s),this.service=e,this.menuservice=t,this.processservice=i,this.indexService=s,this.message=r,this.msgBox=a,this.roleservice=c,this.organization=l,this.cd=d,this.type="info",this.treeLoading=!0,this.data=()=>this.processservice.getallProcesses().pipe(Object(n.a)(()=>this.treeLoading=!1),Object(o.a)(e=>e)),this.treeActions=[{id:"edit",label:"\u4fee\u6539",icon:"fto-edit",handler:e=>{this.action("edit",e)}}],this.controls=[{control:"input",id:"flowid",label:"\u5f53\u524dflowid",hidden:!0},{control:"input",id:"tasknodeid",label:"\u5f53\u524dflowid",hidden:!0},{control:"input",id:"processkey",label:"\u5f53\u524dflowid",hidden:!0},{control:"input",id:"label",label:"\u8282\u70b9\u540d\u79f0",required:!0,readonly:!0,maxlength:20},{control:"find",id:"menu",label:"\u529f\u80fd\u8fde\u63a5",required:!0,multiple:!1,treeData:()=>this.menuservice.getList(1,Number.MAX_SAFE_INTEGER,{sort:[{field:"pid",value:"asc"},{field:"sort",value:"asc"}]}).pipe(Object(n.a)(()=>this.treeLoading=!1),Object(o.a)(e=>e.list))},{control:"find",id:"roles",label:"\u89d2\u8272",required:!0,multiple:!0,treeData:()=>this.organization.getList(1,Number.MAX_SAFE_INTEGER).pipe(Object(o.a)(e=>e.list)),tableData:(e,t,i)=>this.roleservice.getList(e,t,i).pipe(Object(o.a)(e=>{var t;return e.list=null===(t=e.list)||void 0===t?void 0:t.map(e=>(e.label=e.name,e)),e})),tableColumns:[{id:"index",label:"\u5e8f\u53f7",width:80,left:0,type:"index"},{id:"name",label:"\u89d2\u8272\u540d\u79f0",flex:1,sort:!0}],tableRowHeight:35,treeTableConnect:"organizationId"}]}get disabled(){return!["edit","add","add-root"].includes(this.type)}addflow(){this.processservice.deployDiagram("LimsTestProcess").subscribe(e=>{console.log(e),this.processservice.getallProcesses().subscribe(e=>{this.data=e})})}ngAfterViewInit(){this.cd.detectChanges(),this.processservice.getallProcesses()}setformvalue(e){this.service.getList(1,100,{filter:[{field:"id",value:e.tasknodeid+"",operation:"="},{field:"flowid",value:e.pid+"",operation:"="}]}).subscribe(t=>{var i,s=t;null!=s?(null===(i=s.roles)||void 0===i||i.map(e=>{e.label=e.name}),this.form.formGroup.patchValue(s)):this.form.formGroup.setValue({tasknodeid:e.tasknodeid,label:e.label,flowid:null==e.pid?"":e.pid,processkey:e.processkey,menu:null,roles:[]})})}ngOnInit(){this.treeActions=this.treeActions.filter(e=>this.auth[e.id])}action(e,t){switch(this.cd.detectChanges(),e){case"info":this.type=e,this.selected=t,this.setformvalue(t);break;case"edit":if(null==t.pid){this.action("info",t);break}this.type=e,this.setformvalue(t);break;case"delete":this.msgBox.confirm({title:"\u63d0\u793a",content:`\u6b64\u64cd\u4f5c\u5c06\u6c38\u4e45\u5220\u9664\u6b64\u6761\u6570\u636e\uff1a${t.label}\uff0c\u662f\u5426\u7ee7\u7eed\uff1f`,type:"warning",callback:e=>{"confirm"===e&&this.service.delete(t.id).subscribe(e=>{this.treeCom.removeNode(t),this.form.formGroup.reset(),this.message.success("\u5220\u9664\u6210\u529f\uff01")})}});break;case"save":this.service.post(this.form.formGroup.value).subscribe(e=>{this.type="info",this.message.success("\u4fee\u6539\u6210\u529f\uff01")}),console.log(this.form.formGroup.value);break;case"cancel":this.type="info",this.form.formGroup.reset()}}}return e.\u0275fac=function(t){return new(t||e)(d.Ib(u),d.Ib(h.b),d.Ib(v.a),d.Ib(a.a),d.Ib(m.c),d.Ib(g.c),d.Ib(f.a),d.Ib(p.a),d.Ib(d.h))},e.\u0275cmp=d.Cb({type:e,selectors:[["app-flownode"]],viewQuery:function(e,t){var i;1&e&&(d.Cc(G,!0),d.Cc(S,!0)),2&e&&(d.jc(i=d.Wb())&&(t.treeCom=i.first),d.jc(i=d.Wb())&&(t.form=i.first))},features:[d.vb],decls:15,vars:11,consts:[[1,"au-inner"],[1,"au-panel","au-tree-left",2,"width","22rem",3,"x-loading"],["icon","fto-plus","title","\u66f4\u65b0\u6d41\u7a0b",3,"click"],["au-adaption","","expandedLevel","0",3,"outerHeight","data","activatedId","nodeHeight","actions","activatedChange"],["treeCom",""],[1,"au-form-right"],["top",""],[3,"space"],["icon","fto-save","type","primary","plian","",3,"disabled","click"],["au-adaption","","direction","row","labelSuffix",":","labelWidth","6rem","width","24rem","labelAlign","end","span","20","space","2",1,"au-panel","au-overflow-auto",3,"outerHeight","disabled","controls"],["form",""]],template:function(e,t){if(1&e){const e=d.Pb();d.Ob(0,"x-inner",0),d.Ob(1,"div",1),d.Ob(2,"h4"),d.Ob(3,"span"),d.xc(4,"\u6d41\u7a0b"),d.Nb(),d.Ob(5,"x-link",2),d.Vb("click",(function(){return t.addflow()})),d.Nb(),d.Nb(),d.Ob(6,"x-tree",3,4),d.Vb("activatedChange",(function(e){return t.action("info",e)})),d.Nb(),d.Nb(),d.Ob(8,"div",5),d.Ob(9,"au-tool",6),d.Ob(10,"x-buttons",7),d.Ob(11,"x-button",8),d.Vb("click",(function(){return d.mc(e),!d.kc(14).formGroup.invalid&&!t.disabled&&t.action("save",t.selected)})),d.xc(12," \u4fdd\u5b58 "),d.Nb(),d.Nb(),d.Nb(),d.Jb(13,"x-form",9,10),d.Nb(),d.Nb()}if(2&e){const e=d.kc(14);d.yb(1),d.ec("x-loading",t.treeLoading),d.yb(5),d.ec("outerHeight",131)("data",t.data)("activatedId",t.activatedId)("nodeHeight",1.875)("actions",t.treeActions),d.yb(4),d.ec("space",.5),d.yb(1),d.ec("disabled",e.formGroup.invalid||t.disabled),d.yb(2),d.ec("outerHeight",86)("disabled",t.disabled)("controls",t.controls)}},directives:[y.a,x.a,O.a,k.a,I.a,j.a,w.c,w.a,N.b],styles:[""]}),e})()}];let C=(()=>{class e{}return e.\u0275mod=d.Gb({type:e}),e.\u0275inj=d.Fb({factory:function(t){return new(t||e)},imports:[[r.i.forChild(A)],r.i]}),e})();var L=i("gjGi"),H=i("873N"),X=i("iaau"),E=i("hHlV");let M=(()=>{class e{}return e.\u0275mod=d.Gb({type:e}),e.\u0275inj=d.Fb({factory:function(t){return new(t||e)},imports:[[s.c,C,L.a,H.a,X.a,E.a]]}),e})()},MOn6:function(e,t,i){"use strict";i.d(t,"a",(function(){return c}));var s=i("XNiG"),r=i("3pM9"),n=i("1G5W"),o=i("ofXK"),a=i("fXoL");let c=(()=>{class e{constructor(e,t,i){this.elementRef=e,this.renderer=t,this.doc=i,this.outerHeight=0,this._unSubject=new s.a}ngAfterViewInit(){this.setSubject()}ngOnDestroy(){var e;this._unSubject.next(),this._unSubject.unsubscribe(),null===(e=this._resizeObserver)||void 0===e||e.disconnect()}setSubject(){Object(r.A)(this.container,this.doc.documentElement).pipe(Object(n.a)(this._unSubject)).subscribe(e=>{this._resizeObserver=e.resizeObserver,this.setAdaptionHeight()})}setAdaptionHeight(){this.renderer.setStyle(this.elementRef.nativeElement,"height",this.doc.documentElement.clientHeight-this.outerHeight+"px")}}return e.\u0275fac=function(t){return new(t||e)(a.Ib(a.l),a.Ib(a.D),a.Ib(o.e))},e.\u0275dir=a.Db({type:e,selectors:[["","au-adaption",""]],inputs:{outerHeight:"outerHeight",container:"container"}}),e})()},iaau:function(e,t,i){"use strict";i.d(t,"a",(function(){return r}));var s=i("fXoL");let r=(()=>{class e{}return e.\u0275mod=s.Gb({type:e}),e.\u0275inj=s.Fb({factory:function(t){return new(t||e)}}),e})()}}]);
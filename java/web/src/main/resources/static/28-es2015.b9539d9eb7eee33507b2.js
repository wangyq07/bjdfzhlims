(window.webpackJsonp=window.webpackJsonp||[]).push([[28],{K7LP:function(t,e,i){"use strict";i.d(e,"a",(function(){return n}));class n{constructor(t){this.indexService=t,this.auth={};let e=this.indexService.menuChange.subscribe(t=>{this.baseInit(),e.unsubscribe()})}baseInit(){var t,e,i,n,a;this.menu=null===(e=null===(t=this.indexService.auth.user.permissions)||void 0===t?void 0:t.menus)||void 0===e?void 0:e.find(t=>t.router==this.indexService.session.activatedPage),this.actions=null===(n=null===(i=this.indexService.auth.user.permissions)||void 0===i?void 0:i.actions)||void 0===n?void 0:n.filter(t=>{var e;return t.menuId==(null===(e=this.menu)||void 0===e?void 0:e.id)}),null===(a=this.actions)||void 0===a||a.forEach(t=>this.auth[t.code]=!0)}unAuth(t){return!this.auth[t]}}},OewA:function(t,e,i){"use strict";i.r(e),i.d(e,"InputproductModule",(function(){return A}));var n=i("ofXK"),a=i("tyNb"),s=i("vkgz"),o=i("lJxs"),d=i("wTjX"),c=i("OROO"),r=i("K7LP"),l=i("BzWU"),u=i("K7Nf"),b=i("fXoL"),h=i("qMpK"),p=i("x6Xy"),v=i("l5Yv"),f=i("SfH5"),m=i("GvSL"),g=i("P0lq"),N=i("1uEr"),y=i("Atug"),x=i("kXfN"),w=i("/pOC"),q=i("MOn6"),O=i("hMyc"),C=i("3Pt+"),k=i("yO6f");const j=["tableCom"],S=["selqual"],I=["treeCom"];function M(t,e){if(1&t){const t=b.Pb();b.Ob(0,"div",21),b.Ob(1,"x-link",22),b.Vb("click",(function(){b.lc(t);const i=e.$row,n=b.Yb();return!n.disabled&&n.auth.delete&&n.action("delete",i)})),b.Nb(),b.Nb()}if(2&t){const t=b.Yb();b.yb(1),b.ec("disabled",!t.auth.delete||t.disabled)}}const H=function(t){return{actions:t}},V=[{path:"",component:(()=>{class t extends r.a{constructor(t,e,i,n){super(t),this.indexService=t,this.productService=e,this.message=i,this.msgBox=n,this.index=1,this.query={filter:[]},this.data=[],this.activatedId="",this.treeLoading=!0,this.treeData=()=>this.productService.getproduct().pipe(Object(s.a)(()=>this.treeLoading=!1),Object(o.a)(t=>t.list)),this.inputtestcount="none",this.columns=[{id:"index",label:"\u5e8f\u53f7",width:80,type:"index"},{id:"actions",label:"\u64cd\u4f5c",width:100},{id:"testprojectname",label:"\u9879\u76ee",width:100,sort:!0},{id:"standardname",label:"\u6807\u51c6"},{id:"methodname",label:"\u65b9\u6cd5"}],this.total=0,this.qvisible=!1,this.type="info",this.currentNode={},this.treeActions=[{id:"edit",label:"\u4fee\u6539",icon:"fto-edit",handler:t=>{this.treeaction("edit",t)}},{id:"delete",label:"\u5220\u9664",icon:"fto-trash-2",handler:t=>{this.treeaction("delete",t)}}],this.invalidstring="",this.invalidvisible="none"}quaconfirm(){for(var t=[],e=0;e<this.qualificationcomponent.selquali.length;e++)t.push({id:l.a.JsNewGuid(),productid:this.currentNode.id+"",qualificationid:this.qualificationcomponent.selquali[e].id+"",testprojectname:this.qualificationcomponent.selquali[e].testproject,methodname:this.qualificationcomponent.selquali[e].methodname,standardprice:this.qualificationcomponent.selquali[e].price,standardname:this.qualificationcomponent.selquali[e].standardname});this.data=[],this.currentNode.testprojects=[],t.map(t=>{var e;null===(e=this.currentNode.testprojects)||void 0===e||e.push(t),this.data.push(t)}),this.total=this.data.length}treeaction(t,e){switch(t){case"info":this.type=t,null!=e&&(this.selected=e,this.currentNode=e,this.data=null!=e.testprojects?e.testprojects:[]);break;case"add-root":this.type=t,this.data=[],this.currentNode={id:l.a.JsNewGuid(),pid:void 0,label:"",testprojects:this.data};break;case"edit":this.treeaction("info",e),this.type=t;break;case"delete":this.msgBox.confirm({title:"\u63d0\u793a",content:`\u6b64\u64cd\u4f5c\u5c06\u6c38\u4e45\u5220\u9664\u6b64\u6761\u6570\u636e\uff1a${null==e?void 0:e.label}\uff0c\u662f\u5426\u7ee7\u7eed\uff1f`,type:"warning",callback:t=>{"confirm"===t&&null!=e&&this.productService.deleteproduct(e.id).subscribe(t=>{null!=e&&(this.treeCom.removeNode(e),this.message.success("\u5220\u9664\u6210\u529f\uff01"))})}});break;case"save":"add-root"===this.type?this.productService.addproduct(this.currentNode).subscribe(t=>{this.type="info",this.treeCom.addNode(t),this.message.success("\u65b0\u589e\u6210\u529f\uff01")}):"edit"===this.type&&this.productService.updateproduct(this.currentNode).subscribe(t=>{this.type="info",this.treeCom.updateNode(this.currentNode,this.currentNode),this.message.success("\u4fee\u6539\u6210\u529f\uff01")});break;case"cancel":this.type="info"}}action(t,e){switch(t){case"add":this.qvisible=!0,this.qualificationcomponent.selquali=[],this.data.forEach(t=>{this.qualificationcomponent.selquali.push({id:Number(t.qualificationid),testproject:t.testprojectname,testcount:1})}),this.qualificationcomponent.refreshdata();break;case"delete":this.deleteprojectmethod((null==e?void 0:e.id)+"",this.data),this.data=[...this.data]}}deleteprojectmethod(t,e){var i=null==e?void 0:e.findIndex(e=>e.id===t);null==e||e.splice(Number(i),1)}get disabled(){return"info"==this.type}get invalidsave(){return this.invalidvisible="none",this.invalidstring="",null==this.currentNode||null==this.currentNode.label||""==this.currentNode.label?(this.invalidvisible="inline",this.invalidstring="\u540d\u79f0\u4e3a\u7a7a",!0):(null==this.currentNode||null==this.currentNode.testprojects||this.currentNode.testprojects.length<=1)&&(this.invalidvisible="inline",this.invalidstring="\u68c0\u6d4b\u9879\u76ee\u4e3a\u7a7a",!0)}}return t.\u0275fac=function(e){return new(e||t)(b.Ib(d.a),b.Ib(u.a),b.Ib(h.c),b.Ib(p.c))},t.\u0275cmp=b.Cb({type:t,selectors:[["app-inputproduct"]],viewQuery:function(t,e){var i;1&t&&(b.Bc(j,!0),b.Bc(S,!0),b.Bc(I,!0)),2&t&&(b.ic(i=b.Wb())&&(e.tableCom=i.first),b.ic(i=b.Wb())&&(e.qualificationcomponent=i.first),b.ic(i=b.Wb())&&(e.treeCom=i.first))},features:[b.vb],decls:37,vars:34,consts:[["width","80%","height","50%","placement","top",3,"visible","backdropClose","hasBackdrop","visibleChange","confirm"],["dialogqulification",""],[2,"width","100%","height","100%",3,"modify","tablespan","treespan","inputtestcount"],["selqual",""],[1,"au-inner"],[1,"au-panel","au-tree-left",2,"width","22rem",3,"x-loading"],["icon","fto-plus","title","\u589e\u52a0\u6839\u8282\u70b9",3,"click"],["au-adaption","","expandedLevel","0",3,"outerHeight","data","activatedId","nodeHeight","actions","activatedChange"],["treeCom",""],[1,"au-table-right"],["top",""],["span","4"],["type","primary","icon","fto-plus","plain","",3,"disabled","click"],["type","primary","icon","fto-save","plain","",3,"disabled","click"],[2,"color","crimson","font-size","10pt"],[2,"height","20px"],["label","\u4ea7\u54c1\u540d\u79f0","direction","row",3,"readonly","ngModel","ngModelChange"],["label","\u6253\u5305\u4ef7","direction","row",3,"readonly","ngModel","ngModelChange"],["virtualScroll","","loading","",3,"columns","rowHeight","data","total","size","index","query","bodyHeight","bodyColumnTpl","adaptionHeight","indexChange"],["tableCom",""],["actionsTpl",""],[1,"au-table-actions"],["icon","fto-trash-2","title","\u5220\u9664",3,"disabled","click"]],template:function(t,e){if(1&t&&(b.Ob(0,"x-dialog",0,1),b.Vb("visibleChange",(function(t){return e.qvisible=t}))("confirm",(function(){return e.quaconfirm()})),b.Jb(2,"app-qualification",2,3),b.Nb(),b.Ob(4,"x-inner",4),b.Ob(5,"div",5),b.Ob(6,"h4"),b.Ob(7,"span"),b.wc(8,"\u4ea7\u54c1\u6811"),b.Nb(),b.Ob(9,"x-link",6),b.Vb("click",(function(){return e.treeaction("add-root",e.selected)})),b.Nb(),b.Nb(),b.Ob(10,"x-tree",7,8),b.Vb("activatedChange",(function(t){return e.treeaction("info",t)})),b.Nb(),b.Nb(),b.Ob(12,"div",9),b.Ob(13,"x-row"),b.Ob(14,"au-tool",10),b.Ob(15,"x-row"),b.Ob(16,"x-col",11),b.Ob(17,"x-button",12),b.Vb("click",(function(){return!e.disabled&&e.auth.add&&e.action("add")})),b.wc(18,"\u6dfb\u52a0\u9879\u76ee"),b.Nb(),b.Nb(),b.Ob(19,"x-col",11),b.Ob(20,"x-button",13),b.Vb("click",(function(){return!e.invalidsave&&!e.disabled&&e.auth.add&&e.treeaction("save")})),b.wc(21,"\u4fdd\u5b58"),b.Nb(),b.Nb(),b.Ob(22,"x-col",11),b.Ob(23,"div",14),b.wc(24),b.Nb(),b.Nb(),b.Nb(),b.Nb(),b.Nb(),b.Jb(25,"x-row",15),b.Ob(26,"x-row"),b.Ob(27,"x-col",11),b.Ob(28,"x-input",16),b.Vb("ngModelChange",(function(t){return e.currentNode.label=t})),b.Nb(),b.Nb(),b.Ob(29,"x-col",11),b.Ob(30,"x-input",17),b.Vb("ngModelChange",(function(t){return e.currentNode.price=t})),b.Nb(),b.Nb(),b.Nb(),b.Jb(31,"x-row",15),b.Ob(32,"x-row"),b.Ob(33,"x-table",18,19),b.Vb("indexChange",(function(t){return e.index=t})),b.Nb(),b.Nb(),b.Nb(),b.Nb(),b.uc(35,M,2,1,"ng-template",null,20,b.vc)),2&t){const t=b.jc(36);b.ec("visible",e.qvisible)("backdropClose",!1)("hasBackdrop",!1),b.yb(2),b.ec("modify",1)("tablespan",15)("treespan",5)("inputtestcount",e.inputtestcount),b.yb(3),b.ec("x-loading",e.treeLoading),b.yb(5),b.ec("outerHeight",131)("data",e.treeData)("activatedId",e.activatedId)("nodeHeight",1.875)("actions",e.treeActions),b.yb(7),b.ec("disabled",!e.auth.add||e.disabled),b.yb(3),b.ec("disabled",!e.auth.add||e.disabled||e.invalidsave),b.yb(3),b.rc("display",e.invalidvisible),b.yb(1),b.xc(e.invalidstring),b.yb(4),b.ec("readonly",e.disabled)("ngModel",e.currentNode.label),b.yb(2),b.ec("readonly",e.disabled)("ngModel",e.currentNode.price),b.yb(3),b.ec("columns",e.columns)("rowHeight",35)("data",e.data)("total",e.total)("size",20)("index",e.index)("query",e.query)("bodyHeight",100)("bodyColumnTpl",b.gc(32,H,t))("adaptionHeight",138)}},directives:[v.a,c.a,N.a,y.a,x.a,w.a,q.a,f.c,O.a,f.a,m.a,g.a,C.q,C.t,k.a],styles:[""]}),t})()}];let B=(()=>{class t{}return t.\u0275mod=b.Gb({type:t}),t.\u0275inj=b.Fb({factory:function(e){return new(e||t)},imports:[[a.i.forChild(V)],a.i]}),t})();var J=i("gjGi"),L=i("hHlV"),G=i("aMyR"),P=i("873N"),z=i("iaau");let A=(()=>{class t{}return t.\u0275mod=b.Gb({type:t}),t.\u0275inj=b.Fb({factory:function(e){return new(e||t)},imports:[[n.c,J.a,L.a,G.a,P.a,z.a,f.b,g.b,w.b,m.b,k.b,v.b,B]]}),t})()}}]);